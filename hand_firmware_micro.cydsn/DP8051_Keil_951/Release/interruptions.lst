C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE INTERRUPTIONS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Release\interruptions.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\4.2\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -interruptions.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(NDEBUG) WL(2) PR(.\DP8051
                    -_Keil_951\Release/interruptions.lst) CD OT(8,SPEED) OJ(.\DP8051_Keil_951\Release\interruptions.obj)

line level    source

*** MESSAGE C286 IN LINE 0 OF (null): license limits optimization to level 5
   1          // ----------------------------------------------------------------------------
   2          // BSD 3-Clause License
   3          
   4          // Copyright (c) 2016, qbrobotics
   5          // Copyright (c) 2017, Centro "E.Piaggio"
   6          // All rights reserved.
   7          
   8          // Redistribution and use in source and binary forms, with or without
   9          // modification, are permitted provided that the following conditions are met:
  10          
  11          // * Redistributions of source code must retain the above copyright notice, this
  12          //   list of conditions and the following disclaimer.
  13          
  14          // * Redistributions in binary form must reproduce the above copyright notice,
  15          //   this list of conditions and the following disclaimer in the documentation
  16          //   and/or other materials provided with the distribution.
  17          
  18          // * Neither the name of the copyright holder nor the names of its
  19          //   contributors may be used to endorse or promote products derived from
  20          //   this software without specific prior written permission.
  21          
  22          // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  23          // AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  24          // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  25          // DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  26          // FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  27          // DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  28          // SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  29          // CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  30          // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  31          // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  32          // POSSIBILITY OF SUCH DAMAGE.
  33          // ----------------------------------------------------------------------------
  34          
  35          /**
  36          * \file         interruptions.c
  37          *
  38          * \brief        Interruption handling and firmware core functions
  39          * \date         October 01, 2017
  40          * \author       _Centro "E.Piaggio"_
  41          * \copyright    (C) 2012-2016 qbrobotics. All rights reserved.
  42          * \copyright    (C) 2017 Centro "E.Piaggio". All rights reserved.
  43          */
  44          
  45          
  46          //=================================================================     includes
  47          #include <interruptions.h>
  48          #include <command_processing.h>
  49          #include <globals.h>
  50          #include <utils.h>
  51          
  52          
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 2   

  53          //==============================================================================
  54          //                                                            RS485 RX INTERRUPT
  55          //==============================================================================
  56          // Processing RS-485 data frame:
  57          //
  58          // - 0:     Waits for beggining characters
  59          // - 1:     Waits for ID;
  60          // - 2:     Data length;
  61          // - 3:     Receive all bytes;
  62          // - 4:     Wait for another device end of transmission;
  63          //
  64          //==============================================================================
  65          
  66          // PWM values needed to obtain 11.5 V given a certain input tension
  67          // Numbers are sperimentally calculated //[index] (millivolts)
  68          static const uint8 pwm_preload_values[29] = {100,    //0 (11500)
  69                                                        83,
  70                                                        78,
  71                                                        76,
  72                                                        74,
  73                                                        72,    //5 (14000)
  74                                                        70,
  75                                                        68,
  76                                                        67,
  77                                                        65,
  78                                                        64,    //10 (16500)
  79                                                        63,
  80                                                        62,
  81                                                        61,
  82                                                        60,
  83                                                        59,    //15 (19000)
  84                                                        58,
  85                                                        57,
  86                                                        56,
  87                                                        56,
  88                                                        55,    //20 (21500)
  89                                                        54,
  90                                                        54,
  91                                                        53,
  92                                                        52,
  93                                                        52,    //25 (24000)
  94                                                        52,
  95                                                        51,
  96                                                        51};   //28 (25500)
  97          
  98          //==============================================================================
  99          //                                                            WATCHDOG INTERRUPT
 100          //==============================================================================
 101          
 102          CY_ISR(ISR_WATCHDOG_Handler){
 103   1      
 104   1          // Set WDT flag
 105   1          
 106   1          watchdog_flag = TRUE;
 107   1      
 108   1      }
 109          
 110          //==============================================================================
 111          //                                                            RS485 RX INTERRUPT
 112          //==============================================================================
 113          
 114          CY_ISR(ISR_RS485_RX_ExInterrupt) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 3   

 115   1      
 116   1          // Set RS485 flag
 117   1          
 118   1          interrupt_flag = TRUE;
 119   1           
 120   1      }
 121          
 122          //==============================================================================
 123          //                                                             INTERRUPT MANAGER
 124          //==============================================================================
 125          // Manage interrupt from RS485 
 126          //==============================================================================
 127          // Processing RS-485 data frame:
 128          //
 129          // - WAIT_START:    Waits for beginning characters;
 130          // - WAIT_ID:       Waits for ID;
 131          // - WAIT_LENGTH:   Data length;
 132          // - RECEIVE:       Receive all bytes;
 133          // - UNLOAD:        Wait for another device end of transmission;
 134          //
 135          //==============================================================================
 136          
 137          void interrupt_manager(){
 138   1      
 139   1          
 140   1          //===========================================     local variables definition
 141   1      
 142   1          static uint8 CYDATA state = WAIT_START;                      // state
 143   1          
 144   1          //------------------------------------------------- local data packet
 145   1          static uint8 CYDATA data_packet_index;
 146   1          static uint8 CYDATA data_packet_length;
 147   1          static uint8 data_packet_buffer[128];                     
 148   1          static uint8 CYDATA rx_queue[3];                    // last 2 bytes received
 149   1          //-------------------------------------------------
 150   1      
 151   1          uint8 CYDATA    rx_data;                            // RS485 UART rx data
 152   1          CYBIT           rx_data_type;                       // my id?
 153   1          uint8 CYDATA    package_count = 0;                     
 154   1      
 155   1          //======================================================     receive routine
 156   1          
 157   1          // Get data until buffer is not empty 
 158   1          
 159   1          while(UART_RS485_GetRxBufferSize() && (package_count < 6)){  
 160   2              // 6 - estimated maximum number of packets we can read without blocking firmware execution
 161   2              
 162   2              // Get next char
 163   2              rx_data = UART_RS485_GetChar();
 164   2              
 165   2              switch (state) {
 166   3                  //-----     wait for frame start     -------------------------------
 167   3                  case WAIT_START:
 168   3                  
 169   3                      rx_queue[0] = rx_queue[1];
 170   3                      rx_queue[1] = rx_queue[2];
 171   3                      rx_queue[2] = rx_data;
 172   3                      
 173   3                      // Check for header configuration package
 174   3                      if ((rx_queue[1] == 58) && (rx_queue[2] == 58)) {
 175   4                          rx_queue[0] = 0;
 176   4                          rx_queue[1] = 0;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 4   

 177   4                          rx_queue[2] = 0;
 178   4                          state       = WAIT_ID;                    
 179   4                      }else
 180   3                          if ((rx_queue[0] == 63) &&      //ASCII - ?
 181   3                              (rx_queue[1] == 13) &&      //ASCII - CR
 182   3                              (rx_queue[2] == 10))        //ASCII - LF)
 183   3                              infoGet(INFO_ALL);
 184   3                      break;
 185   3      
 186   3                  //-----     wait for id     ----------------------------------------
 187   3                  case  WAIT_ID:
 188   3      
 189   3                      // packet is for my ID or is broadcast
 190   3                      if (rx_data == c_mem.id || rx_data == 0 || rx_data == c_mem.SH_ID)
 191   3                          rx_data_type = FALSE;
 192   3                      else                //packet is for others
 193   3                          rx_data_type = TRUE;
 194   3                      
 195   3                      data_packet_length = 0;
 196   3                      state = WAIT_LENGTH;
 197   3                      break;
 198   3      
 199   3                  //-----     wait for length     ------------------------------------
 200   3                  case  WAIT_LENGTH:
 201   3      
 202   3       
 203   3                      data_packet_length = rx_data;
 204   3                      // check validity of pack length
 205   3                      if (data_packet_length <= 1) {
 206   4                          data_packet_length = 0;
 207   4                          state = WAIT_START;
 208   4                      } else if (data_packet_length > 128) {
 209   4                          data_packet_length = 0;
 210   4                          state = WAIT_START;
 211   4                      } else {
 212   4                          data_packet_index = 0;
 213   4                          
 214   4                          if(rx_data_type == FALSE)
 215   4                              state = RECEIVE;          // packet for me or broadcast
 216   4                          else
 217   4                              state = UNLOAD;           // packet for others
 218   4                      }
 219   3                      break;
 220   3      
 221   3                  //-----     receiving     -------------------------------------------
 222   3                  case RECEIVE:
 223   3      
 224   3                      data_packet_buffer[data_packet_index] = rx_data;
 225   3                      data_packet_index++;
 226   3                      
 227   3                      // check end of transmission
 228   3                      if (data_packet_index >= data_packet_length) {
 229   4                          // verify if frame ID corresponded to the device ID
 230   4                          if (rx_data_type == FALSE) {
 231   5                              // copying data from buffer to global packet
 232   5                              memcpy(g_rx.buffer, data_packet_buffer, data_packet_length);
 233   5                              g_rx.length = data_packet_length;
 234   5                              g_rx.ready  = 1;
 235   5                      
 236   5                              commProcess();
 237   5                          }
 238   4                          
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 5   

 239   4                          data_packet_index  = 0;
 240   4                          data_packet_length = 0;
 241   4                          state = WAIT_START;
 242   4                          package_count++;
 243   4                      
 244   4                      }
 245   3                      break;
 246   3      
 247   3                  //-----     other device is receving     ---------------------------
 248   3                  case UNLOAD:
 249   3                      if (!(--data_packet_length)) {
 250   4                          data_packet_index  = 0;
 251   4                          data_packet_length = 0;
 252   4                          RS485_CTS_Write(1);
 253   4                          RS485_CTS_Write(0);
 254   4                          state              = WAIT_START;
 255   4                          package_count++;
 256   4                      }
 257   3                      break;
 258   3              }
 259   2          }
 260   1      }
 261          //==============================================================================
 262          //                                                            FUNCTION SCHEDULER
 263          //==============================================================================
 264          // Call all the function with the right frequency
 265          //==============================================================================
 266          // Base frequency 1000 Hz
 267          //==============================================================================
 268          
 269          void function_scheduler(void) {
 270   1       
 271   1          static uint16 counter_calibration = DIV_INIT_VALUE;
 272   1      
 273   1          timer_value0 = (uint32)MY_TIMER_ReadCounter();
 274   1      
 275   1          // Start ADC Conversion, SOC = 1
 276   1      
 277   1          ADC_SOC_Write(0x01); 
 278   1          
 279   1          // Check Interrupt 
 280   1      
 281   1          if (interrupt_flag){
 282   2              interrupt_flag = FALSE;
 283   2              interrupt_manager();
 284   2          }
 285   1        
 286   1          //---------------------------------- Get Encoders
 287   1      
 288   1          encoder_reading(0); 
 289   1          
 290   1          // Check Interrupt     
 291   1          
 292   1          if (interrupt_flag){
 293   2              interrupt_flag = FALSE;
 294   2              interrupt_manager();
 295   2          }   
 296   1          
 297   1          encoder_reading(1);
 298   1          
 299   1          // Check Interrupt 
 300   1          
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 6   

 301   1          if (interrupt_flag){
 302   2              interrupt_flag = FALSE;
 303   2              interrupt_manager();
 304   2          }
 305   1          
 306   1          encoder_reading(2);
 307   1          
 308   1          // Check Interrupt 
 309   1          
 310   1          if (interrupt_flag){
 311   2              interrupt_flag = FALSE;
 312   2              interrupt_manager();
 313   2          }
 314   1      
 315   1          //---------------------------------- Control Motor
 316   1         
 317   1          motor_control();
 318   1      
 319   1          // Check Interrupt 
 320   1      
 321   1          if (interrupt_flag){
 322   2              interrupt_flag = FALSE;
 323   2              interrupt_manager();
 324   2          }
 325   1      
 326   1          //---------------------------------- Read conversion buffer - LOCK function
 327   1      
 328   1          analog_read_end();
 329   1      
 330   1          if (interrupt_flag){
 331   2              interrupt_flag = FALSE;
 332   2              interrupt_manager();
 333   2          }
 334   1      
 335   1          //---------------------------------- Control Overcurrent
 336   1      
 337   1          overcurrent_control();
 338   1          
 339   1          // Check Interrupt 
 340   1          
 341   1          if (interrupt_flag){
 342   2              interrupt_flag = FALSE;
 343   2              interrupt_manager();
 344   2          }
 345   1          
 346   1          //---------------------------------- Master Mode
 347   1            
 348   1          if(master_mode){
 349   2              
 350   2              if (c_mem.is_myo2_master){
 351   3                  
 352   3                  // Rest position check (only if Master mode is enabled)
 353   3                  if (c_mem.rest_position_flag == TRUE){
 354   4                      if (counter_calibration == CALIBRATION_DIV) {
 355   5                          
 356   5                              // Read Measure (valid since this routine is enabled only in Master mode)
 357   5                              if (c_mem.is_force_fb_present || c_mem.is_proprio_fb_present){
 358   6                                  curr_pos_res = SH_current_position;
 359   6                              } 
 360   5                              else {
 361   6                                  curr_pos_res = (int32)commReadMeasFromSH();
 362   6                              }
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 7   

 363   5                                  
 364   5      
 365   5                              check_rest_position();
 366   5                              counter_calibration = 0;
 367   5                      }
 368   4                      counter_calibration++;
 369   4      
 370   4                      // Check Interrupt     
 371   4                      if (interrupt_flag){
 372   5                          interrupt_flag = FALSE;
 373   5                          interrupt_manager();
 374   5                      }
 375   4                  }
 376   3                  
 377   3                  drive_SH();  
 378   3                  
 379   3                  // Check Interrupt     
 380   3                  if (interrupt_flag){
 381   4                      interrupt_flag = FALSE;
 382   4                      interrupt_manager();
 383   4                  }
 384   3              }
 385   2                      
 386   2              if (c_mem.is_force_fb_present){
 387   3                  drive_force_fb(); 
 388   3                  
 389   3                  // Check Interrupt     
 390   3                  if (interrupt_flag){
 391   4                      interrupt_flag = FALSE;
 392   4                      interrupt_manager();
 393   4                  }
 394   3                  
 395   3              }
 396   2              
 397   2              if (c_mem.is_proprio_fb_present){
 398   3                  drive_proprio_fb();
 399   3                  
 400   3                  // Check Interrupt     
 401   3                  if (interrupt_flag){
 402   4                      interrupt_flag = FALSE;
 403   4                      interrupt_manager();
 404   4                  }
 405   3              }
 406   2              
 407   2          }
 408   1                  
 409   1          // Check Interrupt 
 410   1          
 411   1          if (interrupt_flag){
 412   2              interrupt_flag = FALSE;
 413   2              interrupt_manager();
 414   2          }
 415   1      
 416   1          //---------------------------------- Calibration 
 417   1      
 418   1          // Divider 10, freq = 500 Hz
 419   1          if (calib.enabled == TRUE) {
 420   2              if (counter_calibration == CALIBRATION_DIV) {
 421   3                  calibration();
 422   3                  counter_calibration = 0;
 423   3              }
 424   2              counter_calibration++;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 8   

 425   2          }
 426   1      
 427   1          // Check Interrupt 
 428   1          
 429   1          if (interrupt_flag){
 430   2              interrupt_flag = FALSE;
 431   2              interrupt_manager();
 432   2          }
 433   1          
 434   1          
 435   1          //---------------------------------- Update States
 436   1          
 437   1          // Load k-1 state
 438   1          memcpy( &g_measOld, &g_meas, sizeof(g_meas) );
 439   1          memcpy( &g_refOld, &g_ref, sizeof(g_ref) );
 440   1      
 441   1          // Load k+1 state
 442   1          memcpy( &g_ref, &g_refNew, sizeof(g_ref) );
 443   1      
 444   1          if (interrupt_flag){
 445   2              interrupt_flag = FALSE;
 446   2              interrupt_manager();
 447   2          }
 448   1      
 449   1          timer_value = (uint32)MY_TIMER_ReadCounter();
 450   1          MY_TIMER_WriteCounter(5000000);
 451   1      
 452   1      }
 453          
 454          //==============================================================================
 455          //                                                                MOTORS CONTROL
 456          //==============================================================================
 457          
 458          void motor_control() {
 459   1      
 460   1          int32 CYDATA pwm_input = 0;
 461   1      
 462   1          int32 CYDATA pos_error;         // position error
 463   1          int32 CYDATA curr_error;        // current error
 464   1      
 465   1          int32 CYDATA i_ref;             // current reference
 466   1          int32 CYDATA handle_value;
 467   1      
 468   1          int32 CYDATA err_emg_1, err_emg_2;
 469   1          float CYDATA joy_perc;
 470   1              
 471   1          int32 CYDATA k_p = c_mem.k_p;  
 472   1          int32 CYDATA k_i = c_mem.k_i; 
 473   1          int32 CYDATA k_d = c_mem.k_d; 
 474   1      
 475   1          int32 CYDATA k_p_c = c_mem.k_p_c;  
 476   1          int32 CYDATA k_i_c = c_mem.k_i_c; 
 477   1          int32 CYDATA k_d_c = c_mem.k_d_c;   
 478   1      
 479   1          int32 CYDATA k_p_dl = c_mem.k_p_dl;  
 480   1          int32 CYDATA k_i_dl = c_mem.k_i_dl; 
 481   1          int32 CYDATA k_d_dl = c_mem.k_d_dl;
 482   1          
 483   1          int32 CYDATA k_p_c_dl = c_mem.k_p_c_dl;  
 484   1          int32 CYDATA k_i_c_dl = c_mem.k_i_c_dl; 
 485   1          int32 CYDATA k_d_c_dl = c_mem.k_d_c_dl;   
 486   1      
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 9   

 487   1          // Static Variables
 488   1      
 489   1          static int32 pos_error_sum;     // position error sum for integral
 490   1          static int32 curr_error_sum;    // current error sum for integral
 491   1          
 492   1          static int32 prev_pos_err;      // previous position error for deriv. control
 493   1          static int32 prev_curr_err;     // previous current error for deriv. control
 494   1      
 495   1          static CYBIT motor_dir = FALSE;
 496   1      
 497   1          static uint8 current_emg = 0;   // 0 NONE
 498   1                                          // 1 EMG 1
 499   1                                          // 2 EMG 2
 500   1                                          // wait for both to get down
 501   1      
 502   1          err_emg_1 = g_meas.emg[0] - c_mem.emg_threshold[0];
 503   1          err_emg_2 = g_meas.emg[1] - c_mem.emg_threshold[1];
 504   1          
 505   1          // =========================== POSITION INPUT ==============================
 506   1          switch(c_mem.input_mode) {
 507   2      
 508   2              case INPUT_MODE_ENCODER3:
 509   2      
 510   2                  if (master_mode) {
 511   3                      // The only attached encoder is the handle lever
 512   3                      handle_value = g_meas.pos[0] * c_mem.motor_handle_ratio;
 513   3                  }
 514   2                  else {
 515   3                      // Like other firmwares working
 516   3                      // Calculate handle value based on position of handle in the
 517   3                      // sensor chain and multiplication factor between handle and motor position
 518   3                      if (c_mem.double_encoder_on_off) 
 519   3                          handle_value = g_meas.pos[2] * c_mem.motor_handle_ratio;
 520   3                      else
 521   3                          handle_value = g_meas.pos[1] * c_mem.motor_handle_ratio;
 522   3                  }
 523   2      
 524   2                  // Read handle and use it as reference for the motor
 525   2                  if (((handle_value - g_ref.pos[0]) > c_mem.max_step_pos) && (c_mem.max_step_pos != 0))
 526   2                      g_ref.pos[0] += c_mem.max_step_pos;
 527   2                  else {
 528   3                      if (((handle_value - g_ref.pos[0]) < c_mem.max_step_neg) && (c_mem.max_step_neg != 0))
 529   3                          g_ref.pos[0] += c_mem.max_step_neg;
 530   3                      else
 531   3                          g_ref.pos[0] = handle_value;
 532   3                  }
 533   2                  break;
 534   2      
 535   2              case INPUT_MODE_EMG_PROPORTIONAL:
 536   2                  if (err_emg_1 > 0)
 537   2                      g_ref.pos[0] = (err_emg_1 * g_mem.pos_lim_sup[0]) / (1024 - c_mem.emg_threshold[0]);
 538   2                  else
 539   2                      g_ref.pos[0] = 0;
 540   2                  break;
 541   2      
 542   2              case INPUT_MODE_EMG_INTEGRAL:
 543   2                  g_ref.pos[0] = g_refOld.pos[0];
 544   2                  if (err_emg_1 > 0) {
 545   3                      g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * (int)g_mem.emg_speed * 2) / (1024 - c_mem.em
             -g_threshold[0]);
 546   3                  }
 547   2                  if (err_emg_2 > 0) {
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 10  

 548   3                      g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * (int)g_mem.emg_speed * 2) / (1024 - c_mem.em
             -g_threshold[1]);
 549   3                  }
 550   2                  break;
 551   2      
 552   2              case INPUT_MODE_EMG_FCFS:
 553   2                  g_ref.pos[0] = g_refOld.pos[0];
 554   2                  switch (current_emg) {
 555   3                      case 0:
 556   3                          // Look for the first EMG passing the threshold
 557   3                          if (err_emg_1 > 0) {
 558   4                              current_emg = 1;
 559   4                              break;
 560   4                          }
 561   3                          if (err_emg_2 > 0) {
 562   4                              current_emg = 2;
 563   4                              break;
 564   4                          }
 565   3                          break;
 566   3      
 567   3                      case 1:
 568   3                          // EMG 1 is first
 569   3                          if (err_emg_1 < 0) {
 570   4                              current_emg = 0;
 571   4                              break;
 572   4                          }
 573   3                          g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * g_mem.emg_speed * 2) / (1024 - c_mem.emg
             -_threshold[0]);
 574   3                          break;
 575   3      
 576   3                      case 2:
 577   3                          // EMG 2 is first
 578   3                          if (err_emg_2 < 0) {
 579   4                              current_emg = 0;
 580   4                              break;
 581   4                          }
 582   3                          g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * g_mem.emg_speed * 2) / (1024 - c_mem.emg
             -_threshold[1]);
 583   3                          break;
 584   3      
 585   3                      default:
 586   3                          break;
 587   3                  }
 588   2      
 589   2                  break;
 590   2      
 591   2              case INPUT_MODE_EMG_FCFS_ADV:
 592   2                  g_ref.pos[0] = g_refOld.pos[0];
 593   2                  switch (current_emg) {
 594   3                      // Look for the first EMG passing the threshold
 595   3                      case 0:
 596   3                          if (err_emg_1 > 0) {
 597   4                              current_emg = 1;
 598   4                              break;
 599   4                          }
 600   3                          if (err_emg_2 > 0) {
 601   4                              current_emg = 2;
 602   4                              break;
 603   4                          }
 604   3                          break;
 605   3      
 606   3                      // EMG 1 is first
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 11  

 607   3                      case 1:
 608   3                          // If both signals are under threshold go back to status 0
 609   3                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 610   4                              current_emg = 0;
 611   4                              break;
 612   4                          }
 613   3                          // but if the current signal come back over threshold, continue using it
 614   3                          if (err_emg_1 > 0) 
 615   3                              g_ref.pos[0] = g_refOld.pos[0] + (err_emg_1 * g_mem.emg_speed << 2) / (1024 - c_me
             -m.emg_threshold[0]);
 616   3                          
 617   3                          break;
 618   3      
 619   3                      // EMG 2 is first
 620   3                      case 2:
 621   3                          // If both signals are under threshold go back to status 0
 622   3                          if ((err_emg_1 < 0) && (err_emg_2 < 0)) {
 623   4                              current_emg = 0;
 624   4                              break;
 625   4                          }
 626   3                          // but if the current signal come back over threshold, continue using it
 627   3                          if (err_emg_2 > 0) {
 628   4                              g_ref.pos[0] = g_refOld.pos[0] - (err_emg_2 * c_mem.emg_speed << 2) / (1024 - c_me
             -m.emg_threshold[1]);
 629   4                          }
 630   3                          break;
 631   3      
 632   3                      default:
 633   3                          break;
 634   3                  }
 635   2        
 636   2                  break;
 637   2                  
 638   2              case INPUT_MODE_JOYSTICK:
 639   2                  
 640   2                  joy_perc = (float)(g_meas.joystick[0])/((float)c_mem.joystick_gain/2);            
 641   2                  g_ref.pos[0] = g_refOld.pos[0] + c_mem.joystick_closure_speed * joy_perc;         
 642   2              
 643   2                  break;
 644   2              default:
 645   2                  break;
 646   2          }
 647   1      
 648   1          // Position limit saturation
 649   1          if (c_mem.pos_lim_flag) {
 650   2              if (g_ref.pos[0] < c_mem.pos_lim_inf[0]) 
 651   2                  g_ref.pos[0] = c_mem.pos_lim_inf[0];
 652   2              if (g_ref.pos[0] > c_mem.pos_lim_sup[0]) 
 653   2                  g_ref.pos[0] = c_mem.pos_lim_sup[0];
 654   2          }
 655   1      
 656   1          if (c_mem.rest_position_flag == TRUE) {
 657   2              if (rest_enabled == 1){
 658   3                  // Change position reference to drive motor to rest position smoothly
 659   3                  g_ref.pos[0] = rest_pos_curr_ref;
 660   3              }
 661   2              
 662   2              if (forced_open == 1) {
 663   3                  // Open the SoftHand as EMG PROPORTIONAL input mode 
 664   3                  if (err_emg_2 > 0)
 665   3                      g_ref.pos[0] = g_mem.rest_pos - (err_emg_2 * g_mem.rest_pos) / (1024 - c_mem.emg_threshold
             -[1]);
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 12  

 666   3                  else {
 667   4                      g_ref.pos[0] = g_mem.rest_pos;
 668   4                      forced_open = 0;
 669   4                  }
 670   3              }
 671   2          }
 672   1          
 673   1          switch(c_mem.control_mode) {
 674   2              // ======================= CURRENT AND POSITION CONTROL =======================
 675   2              case CURR_AND_POS_CONTROL:
 676   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 677   2      
 678   2                  pos_error_sum += pos_error;
 679   2      
 680   2                  // error_sum saturation
 681   2                  if (pos_error_sum > POS_INTEGRAL_SAT_LIMIT)
 682   2                      pos_error_sum = POS_INTEGRAL_SAT_LIMIT;
 683   2                  else {
 684   3                      if (pos_error_sum < -POS_INTEGRAL_SAT_LIMIT) 
 685   3                          pos_error_sum = -POS_INTEGRAL_SAT_LIMIT;
 686   3                  }
 687   2                  
 688   2                  // ------ position PID control ------
 689   2      
 690   2                  i_ref = 0;
 691   2                  
 692   2                  // Proportional
 693   2                  if (k_p_dl != 0)
 694   2                      i_ref += (int32)(k_p_dl * pos_error) >> 16;
 695   2      
 696   2                  // Integral
 697   2                  if (k_i_dl != 0)
 698   2                      i_ref += (int32)(k_i_dl * pos_error_sum) >> 16;
 699   2      
 700   2                  // Derivative
 701   2                  if (k_d_dl != 0)
 702   2                      i_ref += (int32)(k_d_dl * (pos_error - prev_pos_err)) >> 16;
 703   2                              
 704   2                  // Update previous position
 705   2                  prev_pos_err = pos_error;
 706   2      
 707   2                  // motor direction depends on i_ref
 708   2                  if (i_ref >= 0)
 709   2                      motor_dir = TRUE;
 710   2                  else
 711   2                      motor_dir = FALSE;
 712   2      
 713   2                  // saturate max current
 714   2                  if (i_ref > c_mem.current_limit)
 715   2                      i_ref = c_mem.current_limit;
 716   2                  else 
 717   2                      if (i_ref < -c_mem.current_limit)
 718   2                          i_ref = -c_mem.current_limit;
 719   2           
 720   2                  // current error and curr error sum
 721   2                  curr_error = i_ref - g_meas.curr[0];
 722   2                  curr_error_sum += curr_error;
 723   2                  
 724   2                  if (curr_error_sum > CURR_INTEGRAL_SAT_LIMIT)
 725   2                      curr_error_sum = CURR_INTEGRAL_SAT_LIMIT;
 726   2                  else {
 727   3                      if (curr_error_sum < -CURR_INTEGRAL_SAT_LIMIT)
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 13  

 728   3                          curr_error_sum = -CURR_INTEGRAL_SAT_LIMIT;
 729   3                  }
 730   2      
 731   2                  // ----- current PID control -----
 732   2      
 733   2                  pwm_input = 0;
 734   2      
 735   2                  // Proportional
 736   2                  if (k_p_c_dl != 0)
 737   2                      pwm_input += (int32)(k_p_c_dl * curr_error) >> 16;
 738   2      
 739   2                  // Integral
 740   2                  if (k_i_c_dl != 0)
 741   2                      pwm_input += (int32)(k_i_c_dl * curr_error_sum) >> 16;
 742   2      
 743   2                  // Derivative
 744   2                  if (k_d_c_dl != 0)
 745   2                      pwm_input += (int32)(k_d_c_dl * (curr_error - prev_curr_err)) >> 16;
 746   2      
 747   2                  // pwm_input saturation
 748   2                  if (pwm_input < -PWM_MAX_VALUE) 
 749   2                      pwm_input = -PWM_MAX_VALUE;
 750   2                  else {
 751   3                      if (pwm_input > PWM_MAX_VALUE)
 752   3                          pwm_input = PWM_MAX_VALUE;
 753   3                  }
 754   2      
 755   2                  // Update previous current
 756   2                  prev_curr_err = curr_error;
 757   2      
 758   2              break;
 759   2      
 760   2              // ============================== POSITION CONTROL =====================
 761   2              case CONTROL_ANGLE:
 762   2                  pos_error = g_ref.pos[0] - g_meas.pos[0];
 763   2      
 764   2                  pos_error_sum += pos_error;
 765   2      
 766   2                  // anti-windup (for integral control)
 767   2                  if (pos_error_sum > ANTI_WINDUP) {
 768   3                      pos_error_sum = ANTI_WINDUP;
 769   3                  } else if (pos_error_sum < -ANTI_WINDUP) {
 770   3                      pos_error_sum = -ANTI_WINDUP;
 771   3                  }
 772   2      
 773   2                  // Proportional
 774   2                  if (k_p != 0) 
 775   2                      pwm_input = (int32)(k_p * pos_error) >> 16;
 776   2                  
 777   2      
 778   2                  // Integral
 779   2                  if (k_i != 0) 
 780   2                      pwm_input += (int32)(k_i * pos_error_sum) >> 16;
 781   2                  
 782   2      
 783   2                  // Derivative
 784   2                  if (k_d != 0) 
 785   2                      pwm_input += (int32)(k_d * (pos_error - prev_pos_err)) >> 16;
 786   2                  
 787   2      
 788   2                  // Update measure
 789   2                  prev_pos_err = pos_error;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 14  

 790   2      
 791   2                  if (pwm_input > 0)
 792   2                      motor_dir = TRUE;
 793   2                  else
 794   2                      motor_dir = FALSE;
 795   2      
 796   2              break;
 797   2      
 798   2              // ========================== CURRENT CONTROL ==========================
 799   2              case CONTROL_CURRENT:
 800   2                  if(g_ref.onoff && tension_valid) {
 801   3                      
 802   3                      i_ref = g_ref.curr[0];
 803   3      
 804   3                      if (i_ref > c_mem.current_limit) 
 805   3                          i_ref = c_mem.current_limit;
 806   3                      else {
 807   4                          if (i_ref < -c_mem.current_limit)
 808   4                              i_ref = -c_mem.current_limit;
 809   4                      }
 810   3                      
 811   3                      // current error
 812   3                      curr_error = i_ref - g_meas.curr[0];            
 813   3                      curr_error_sum += curr_error;
 814   3                      
 815   3                      if (curr_error_sum > CURR_INTEGRAL_SAT_LIMIT)
 816   3                          curr_error_sum = CURR_INTEGRAL_SAT_LIMIT;
 817   3                      else {
 818   4                          if (curr_error_sum < -CURR_INTEGRAL_SAT_LIMIT) 
 819   4                              curr_error_sum = -CURR_INTEGRAL_SAT_LIMIT;
 820   4                      }
 821   3      
 822   3                      pwm_input = 0;
 823   3      
 824   3                      // Proportional
 825   3                      if (k_p_c != 0)
 826   3                          pwm_input += (int32)(k_p_c * curr_error) >> 16;
 827   3      
 828   3                      // Integral
 829   3                      if (k_i_c != 0)
 830   3                          pwm_input += (int32)(k_i_c * curr_error_sum) >> 16;
 831   3      
 832   3                      // Derivative
 833   3                      if (k_d_c != 0)
 834   3                          pwm_input += (int32)(k_d_c * (curr_error - prev_curr_err)) >> 16;
 835   3                      
 836   3                      prev_curr_err = curr_error;
 837   3                      
 838   3                      if (pwm_input >= 0) 
 839   3                          motor_dir = TRUE;
 840   3                      else
 841   3                          motor_dir = FALSE;
 842   3                  }
 843   2              break;
 844   2              
 845   2              // ================= DIRECT PWM CONTROL ================================
 846   2              case CONTROL_PWM:
 847   2      
 848   2                  pwm_input = g_ref.pwm[0];
 849   2      
 850   2                  if (pwm_input > 0) 
 851   2                      motor_dir = TRUE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 15  

 852   2                  else 
 853   2                      motor_dir = FALSE;
 854   2                  
 855   2      
 856   2                  // pwm_input saturation
 857   2                  if (pwm_input < -PWM_MAX_VALUE) 
 858   2                      pwm_input = -PWM_MAX_VALUE;
 859   2                   else if (pwm_input > PWM_MAX_VALUE) 
 860   2                      pwm_input = PWM_MAX_VALUE;
 861   2                  
 862   2      
 863   2              break;
 864   2      
 865   2          }
 866   1      
 867   1          ////////////////////////////////////////////////////////////////////////////
 868   1      
 869   1          if(pwm_input >  PWM_MAX_VALUE) 
 870   1              pwm_input =  PWM_MAX_VALUE;
 871   1          if(pwm_input < -PWM_MAX_VALUE) 
 872   1              pwm_input = -PWM_MAX_VALUE;
 873   1      
 874   1      
 875   1          if (c_mem.control_mode != CONTROL_PWM) 
 876   1              pwm_input = (((pwm_input << 10) / PWM_MAX_VALUE) * dev_pwm_limit) >> 10;
 877   1          
 878   1      
 879   1          pwm_sign = SIGN(pwm_input);
 880   1      
 881   1          if (motor_dir)
 882   1              MOTOR_DIR_Write(0x01);
 883   1          else
 884   1              MOTOR_DIR_Write(0x00);
 885   1      
 886   1          PWM_MOTORS_WriteCompare1(abs(pwm_input));
 887   1      }
 888          
 889          //==============================================================================
 890          //                                                                   ENCODER READING
 891          //==============================================================================
 892          
 893          void encoder_reading(const uint8 idx) {
 894   1      
 895   1          uint8 CYDATA index = idx;
 896   1          
 897   1          uint8 jj;
 898   1          
 899   1          uint32 data_encoder;
 900   1          int32 value_encoder;
 901   1          int32 speed_encoder;
 902   1          int32 accel_encoder;
 903   1          int32 aux;
 904   1      
 905   1          static int32 last_value_encoder[NUM_OF_SENSORS];
 906   1      
 907   1          static uint8 error[NUM_OF_SENSORS];
 908   1          
 909   1          static CYBIT only_first_time = TRUE;
 910   1      
 911   1          static uint8 one_time_execute = 0;
 912   1          static CYBIT pos_reconstruct = FALSE;
 913   1      
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 16  

 914   1          static int32 v_value[NUM_OF_SENSORS];   //last value for velocity
 915   1          static int32 vv_value[NUM_OF_SENSORS];  //last last value for velocity
 916   1          static int32 vvv_value[NUM_OF_SENSORS];  //last last last value for velocity
 917   1          
 918   1          static int32 a_value[NUM_OF_SENSORS];   //last value for acceleration
 919   1          static int32 aa_value[NUM_OF_SENSORS];  //last last value for acceleration
 920   1          static int32 aaa_value[NUM_OF_SENSORS];  //last last last value for acceleration
 921   1      
 922   1          if (index >= NUM_OF_SENSORS)
 923   1              return;
 924   1          
 925   1          if (reset_last_value_flag) {
 926   2              for (jj = NUM_OF_SENSORS; jj--;) 
 927   2                  last_value_encoder[jj] = 0;
 928   2              
 929   2              reset_last_value_flag = 0;
 930   2          }
 931   1      
 932   1          //======================================================     reading sensors
 933   1              // Shift 1 right to erase Dummy bit of chain
 934   1          if (index == 0)
 935   1                  data_encoder = (SHIFTREG_ENC_1_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 936   1          else {
 937   2              if (index == 1)
 938   2                  data_encoder = (SHIFTREG_ENC_2_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 939   2              else // index == 2
 940   2                  data_encoder = (SHIFTREG_ENC_3_ReadData() >> 1) & 0x3FFFF;  //0x0003FFFF reset first 14 bits
 941   2          }
 942   1             
 943   1      
 944   1          if (check_enc_data(&data_encoder)) {
 945   2      
 946   2              value_encoder = (int16) (((data_encoder & 0x3FFC0) - 0x20000) >> 2 ) + g_mem.m_off[index];
 947   2                                                          // reset last 6 bit 
 948   2                                                          // -> |:|:|id|dim|CMD|CHK|(data---
 949   2                                                          // subtract half of max value
 950   2                                                          // and shift to have 16 bit val
 951   2      
 952   2              // Initialize last_value_encoder
 953   2              if (only_first_time) {
 954   3                  last_value_encoder[index] = value_encoder;
 955   3                  if (index == 2)
 956   3                      only_first_time = 0;
 957   3              }
 958   2      
 959   2              // Take care of rotations
 960   2              aux = value_encoder - last_value_encoder[index];
 961   2      
 962   2              // ====================== 1 TURN ======================
 963   2              // -32768                    0                    32767 -32768                   0                
             -     32767
 964   2              // |-------------------------|-------------------------|-------------------------|----------------
             ----------|
 965   2              //              |                         |      |           |      |                         |
 966   2              //           -16384                     16383    |           |   -16384                     16383
 967   2              //                                               |           |
 968   2              //                                           24575           -24576
 969   2              //                                               |___________|
 970   2              //                                                   49152
 971   2      
 972   2              // if we are in the right interval, take care of rotation
 973   2              // and update the variable only if the difference between
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 17  

 974   2              // one measure and another is less than 1/4 of turn
 975   2      
 976   2              // Considering we are sampling at 1kHz, this means that our shaft needs
 977   2              // to go slower than 1/4 turn every ms -> 1 turn every 4ms
 978   2              // equal to 250 turn/s -> 15000 RPM
 979   2      
 980   2              if (aux > 49152)
 981   2                  g_meas.rot[index]--;
 982   2              else{ 
 983   3                  if (aux < -49152)
 984   3                      g_meas.rot[index]++;
 985   3                  else{
 986   4                      if (abs(aux) > 16384) { // if two measure are too far
 987   5                          error[index]++;
 988   5                          if (error[index] < 10)
 989   5                              // Discard
 990   5                              return;
 991   5                      }
 992   4                  }
 993   3              }
 994   2      
 995   2              error[index] = 0;
 996   2      
 997   2              last_value_encoder[index] = value_encoder;
 998   2      
 999   2              value_encoder += (int32)g_meas.rot[index] << 16;
1000   2      
1001   2              if (c_mem.m_mult[index] != 1.0) {
1002   3                  value_encoder *= c_mem.m_mult[index];
1003   3              }
1004   2      
1005   2              g_meas.pos[index] = value_encoder;
1006   2          }
1007   1          
1008   1          switch(index) {
1009   2              case 0: {
1010   3                  speed_encoder = (int16)filter_vel_1((3*value_encoder + v_value[0] - vv_value[0] - 3*vvv_value[
             -0])*10);
1011   3                  break;
1012   3              }
1013   2              case 1: {
1014   3                  speed_encoder = (int16)filter_vel_2((3*value_encoder + v_value[1] - vv_value[1] - 3*vvv_value[
             -1])*10);
1015   3                  break;
1016   3              }
1017   2              case 2: {
1018   3                  speed_encoder = (int16)filter_vel_3((3*value_encoder + v_value[2] - vv_value[2] - 3*vvv_value[
             -2])*10);
1019   3                  break;
1020   3              }
1021   2          }
1022   1          //Update current speed
1023   1          g_meas.vel[index] = speed_encoder;
1024   1          
1025   1          //Encoder rotational acceleration calculation
1026   1          switch(index) {
1027   2              case 0:
1028   2                  accel_encoder = (int16)filter_acc_1((3*speed_encoder + a_value[0] - aa_value[0] - 3*aaa_value[
             -0])*10);
1029   2                  break;
1030   2              
1031   2              case 1:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 18  

1032   2                  accel_encoder = (int16)filter_acc_2((3*speed_encoder + a_value[1] - aa_value[1] - 3*aaa_value[
             -1])*10);
1033   2                  break;
1034   2              
1035   2              case 2:
1036   2                  accel_encoder = (int16)filter_acc_3((3*speed_encoder + a_value[2] - aa_value[2] - 3*aaa_value[
             -2])*10);
1037   2                  break;
1038   2          }
1039   1          //Update current acceleration
1040   1          g_meas.acc[index] = accel_encoder;
1041   1      
1042   1          // update old velocity and acceleration values
1043   1          vvv_value[index] = vv_value[index];
1044   1          vv_value[index] = v_value[index];
1045   1          v_value[index] = value_encoder;
1046   1      
1047   1          aaa_value[index] = aa_value[index];
1048   1          aa_value[index] = a_value[index];
1049   1          a_value[index] = speed_encoder;
1050   1      
1051   1      
1052   1          // wait at least 3 * max_num_of_error (10) + 5 = 35 cycles to reconstruct the right turn
1053   1          if (pos_reconstruct == FALSE){
1054   2              if (one_time_execute < 34) 
1055   2                  one_time_execute++;
1056   2              else {
1057   3                  //Double encoder translation
1058   3                  if (c_mem.double_encoder_on_off)
1059   3                      g_meas.rot[0] = calc_turns_fcn(g_meas.pos[0], g_meas.pos[1]);
1060   3      
1061   3                  g_meas.pos[0] += (int32) g_meas.rot[0] << 16;
1062   3      
1063   3                  // If necessary activate motors
1064   3                  g_refNew.pos[0] = g_meas.pos[0];
1065   3      
1066   3                  MOTOR_ON_OFF_Write(g_ref.onoff);
1067   3                  
1068   3                  pos_reconstruct = TRUE;
1069   3              }
1070   2          }
1071   1      }
1072          
1073          //==============================================================================
1074          //                                                           ANALOG MEASUREMENTS
1075          //==============================================================================
1076          
1077          void analog_read_end() {
1078   1      
1079   1          /* =========================================================================
1080   1          /   Ideal formulation to calculate tension and current
1081   1          /
1082   1          /   tension = ((read_value_mV - offset) * 101) / gain -> [mV]
1083   1          /   current = ((read_value_mV - offset) * 375) / (gain * resistor) -> [mA]
1084   1          /
1085   1          /   Definition:
1086   1          /   read_value_mV = counts_read / 0.819 -> conversion from counts to mV
1087   1          /   offset = 2000 -> hardware amplifier bias in mV
1088   1          /   gain = 8.086 -> amplifier gain
1089   1          /   resistor = 18 -> resistor of voltage divider in KOhm 
1090   1          /
1091   1          /   Real formulation: tradeoff in good performance and accurancy, ADC_buf[] 
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 19  

1092   1          /   and offset unit of measurment is counts, instead dev_tension and
1093   1          /   g_meas.curr[] are converted in properly unit.
1094   1          /  =========================================================================
1095   1          */
1096   1      
1097   1          int32 CYDATA i_aux;
1098   1      
1099   1          static emg_status CYDATA emg_1_status = RESET; 
1100   1          static emg_status CYDATA emg_2_status = RESET;                                             
1101   1          
1102   1          static joystick_status CYDATA UD_status = RESET;
1103   1          static joystick_status CYDATA LR_status = RESET;                                          
1104   1      
1105   1          static uint16 CYDATA UD_counter = 0;
1106   1          static uint16 CYDATA LR_counter = 0;
1107   1          
1108   1          static int32 CYDATA UD_mean_value;
1109   1          static int32 CYDATA LR_mean_value;
1110   1              
1111   1          static uint16 emg_counter_1 = 0;
1112   1          static uint16 emg_counter_2 = 0;
1113   1          static uint8 count = 0;
1114   1          static uint32 count2 = 0;
1115   1          
1116   1        //  static uint8 first_tension_valid = TRUE;
1117   1      
1118   1          // Wait for conversion end
1119   1          
1120   1          while(!ADC_STATUS_Read()){
1121   2              if (interrupt_flag){
1122   3                  interrupt_flag = FALSE;
1123   3                  interrupt_manager();
1124   3              }
1125   2          }
1126   1          
1127   1          // Convert tension read
1128   1          dev_tension = ((int32)(ADC_buf[0] - 1638) * 1952) >> 7;
1129   1          
1130   1          if (interrupt_flag){
1131   2              interrupt_flag = FALSE;
1132   2              interrupt_manager();
1133   2          }
1134   1              
1135   1          if (first_tension_valid && tension_valid) {
1136   2              count = count + 1;
1137   2              
1138   2              if (count == 1000){
1139   3                  if (dev_tension < 9000) {   // 8 V case
1140   4                      pow_tension = 8000;
1141   4                  }
1142   3                  else {      // 12 V - 24 V cases
1143   4                      if (dev_tension < 13000) {
1144   5                          pow_tension = 12000;
1145   5                      }
1146   4                      else
1147   4                          pow_tension = 24000;
1148   4                  }
1149   3      
1150   3                  first_tension_valid = FALSE;
1151   3              }
1152   2          }
1153   1      
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 20  

1154   1          // Until there is no valid input tension repeat this measurement
1155   1          
1156   1          if (dev_tension > 7000) {       //at least > 7.36 V (92% of 8 V) that is minimum charge of smallest ba
             -ttery
1157   2              // Set tension valid bit to TRUE
1158   2      
1159   2              if (count2 == 1000){
1160   3                  tension_valid = TRUE;   
1161   3              }
1162   2              else {                      // wait for battery voltage stabilization
1163   3                  count2 = count2 + 1;
1164   3                  dev_tension_f = filter_voltage(dev_tension);
1165   3              }
1166   2      
1167   2              if(g_mem.activate_pwm_rescaling)        //pwm rescaling is activated
1168   2                  pwm_limit_search();                 //only for 12V motors
1169   2      
1170   2              // Filter and Set currents
1171   2              g_meas.curr[0] = filter_i1((int16) (((int32)(ADC_buf[1] - 1638) * 25771) >> 13) * pwm_sign);
1172   2              
1173   2              // Check Interrupt 
1174   2          
1175   2              if (interrupt_flag){
1176   3                  interrupt_flag = FALSE;
1177   3                  interrupt_manager();
1178   3              }
1179   2      
1180   2              // if calibration is not needed go to "normal execution"
1181   2              if (!g_mem.emg_calibration_flag){
1182   3                  emg_1_status = NORMAL; // normal execution
1183   3                  emg_2_status = NORMAL; // normal execution
1184   3              }
1185   2      
1186   2              // State machines for EMG or Joystick reading
1187   2              if (c_mem.input_mode == INPUT_MODE_JOYSTICK) {
1188   3                  // Read ADC_buf[2] and ADC_buf[3] as JOYSTICK analog inputs
1189   3                  
1190   3                  // Joystick UD    
1191   3                  switch (UD_status) {
1192   4                      case NORMAL:
1193   4                          i_aux = ADC_buf[2];
1194   4                          // Remap the analog reading from -1024 to 1024.  
1195   4                          i_aux = (int32) (((float) (i_aux - UD_mean_value) / UD_mean_value) * g_mem.joystick_ga
             -in); 
1196   4                          
1197   4                          if (interrupt_flag){
1198   5                              interrupt_flag = FALSE;
1199   5                              interrupt_manager();
1200   5                          }
1201   4      
1202   4                          //Saturation
1203   4                          if (i_aux < -1024) 
1204   4                              i_aux = -1024;
1205   4                          if (i_aux > 1024)
1206   4                              i_aux = 1024;
1207   4      
1208   4                          g_meas.joystick[1] = (int16) i_aux;
1209   4      
1210   4                          if (interrupt_flag){
1211   5                              interrupt_flag = FALSE;
1212   5                              interrupt_manager();
1213   5                          }
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 21  

1214   4      
1215   4                      break;
1216   4      
1217   4                      case RESET: // reset variables
1218   4                          UD_counter = 0;
1219   4                          UD_mean_value = 0;
1220   4                          UD_status = WAIT; // go to waiting status
1221   4      
1222   4                      break;
1223   4      
1224   4                      case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1225   4                          UD_counter++;
1226   4                          if (UD_counter == JOYSTICK_SAMPLE_TO_DISCARD) {
1227   5                              UD_counter = 0;                     // reset counter
1228   5      
1229   5                              if (interrupt_flag){
1230   6                                  interrupt_flag = FALSE;
1231   6                                  interrupt_manager();
1232   6                              }
1233   5      
1234   5                              UD_status = SUM_AND_MEAN;           // sum and mean status
1235   5                          }
1236   4      
1237   4                      break;
1238   4      
1239   4                      case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1240   4                          // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1241   4                          UD_counter++;
1242   4                          UD_mean_value += ADC_buf[2];
1243   4      
1244   4                          if (interrupt_flag){
1245   5                              interrupt_flag = FALSE;
1246   5                              interrupt_manager();
1247   5                          }
1248   4      
1249   4                          if (UD_counter == SAMPLES_FOR_JOYSTICK_MEAN) {
1250   5                              UD_mean_value = UD_mean_value / SAMPLES_FOR_JOYSTICK_MEAN; // calc mean
1251   5      
1252   5                              if (interrupt_flag){
1253   6                                  interrupt_flag = FALSE;
1254   6                                  interrupt_manager();
1255   6                              }
1256   5      
1257   5                              UD_counter = 0;          // reset counter
1258   5                              UD_status = NORMAL;           // goto normal execution
1259   5                          }
1260   4                      break;
1261   4      
1262   4                      case WAIT: // wait for both EMG calibrations to be done
1263   4                          if (emg_1_status == NORMAL && emg_2_status == NORMAL)
1264   4                              UD_status = DISCARD;           // goto discard sample
1265   4                      break;
1266   4                  }
1267   3                  
1268   3                  if (interrupt_flag){
1269   4                      interrupt_flag = FALSE;
1270   4                      interrupt_manager();
1271   4                  }
1272   3                  // Joystick LR
1273   3                  switch (LR_status) {
1274   4                      case NORMAL:
1275   4                          i_aux = ADC_buf[3];
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 22  

1276   4      
1277   4                          i_aux = (int32) (((float) (i_aux - LR_mean_value) / LR_mean_value) * g_mem.joystick_ga
             -in); 
1278   4                          
1279   4                          if (interrupt_flag){
1280   5                              interrupt_flag = FALSE;
1281   5                              interrupt_manager();
1282   5                          }
1283   4      
1284   4                          //Saturation
1285   4                          if (i_aux < -1024)
1286   4                              i_aux = -1024;
1287   4                          if (i_aux > 1024)
1288   4                              i_aux = 1024;
1289   4      
1290   4                          if (interrupt_flag){
1291   5                              interrupt_flag = FALSE;
1292   5                              interrupt_manager();
1293   5                          }
1294   4      
1295   4                          g_meas.joystick[0] = (int16) i_aux;
1296   4      
1297   4                      break;
1298   4      
1299   4                      case RESET: // reset variables
1300   4                          LR_counter = 0;
1301   4                          LR_mean_value = 0;
1302   4                          LR_status = WAIT; // goes waiting for all conversions to be done
1303   4                      break;
1304   4      
1305   4                      case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples8
1306   4                          LR_counter++;
1307   4                          if (LR_counter == JOYSTICK_SAMPLE_TO_DISCARD) {
1308   5                              LR_counter = 0;                     // reset counter
1309   5      
1310   5                              if (interrupt_flag){
1311   6                                  interrupt_flag = FALSE;
1312   6                                  interrupt_manager();
1313   6                              }
1314   5      
1315   5                              LR_status = SUM_AND_MEAN;           // sum and mean status
1316   5                          }
1317   4                      break;
1318   4      
1319   4                      case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1320   4                          // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1321   4                          LR_counter++;
1322   4                          LR_mean_value += ADC_buf[3];
1323   4                          if (LR_counter == SAMPLES_FOR_JOYSTICK_MEAN) {
1324   5                              LR_mean_value = LR_mean_value / SAMPLES_FOR_JOYSTICK_MEAN; // calc mean
1325   5                              
1326   5                              if (interrupt_flag){
1327   6                                  interrupt_flag = FALSE;
1328   6                                  interrupt_manager();
1329   6                              }
1330   5      
1331   5                              LR_counter = 0;               // reset counter
1332   5                              LR_status = NORMAL;           // goto normal execution
1333   5                          }
1334   4                      break;
1335   4      
1336   4                      case WAIT:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 23  

1337   4                          if(emg_1_status == NORMAL && emg_2_status == NORMAL && UD_status == NORMAL)
1338   4                              LR_status = DISCARD;
1339   4                      break;
1340   4                  }
1341   3      
1342   3                  if (interrupt_flag){
1343   4                      interrupt_flag = FALSE;
1344   4                      interrupt_manager();
1345   4                  }
1346   3                  
1347   3              } 
1348   2              else {
1349   3                  // Read ADC_buf[2] and ADC_buf[3] as EMGs
1350   3                  
1351   3                  // EMG 1 calibration state machine
1352   3              
1353   3                  // Calibration state machine
1354   3                  switch(emg_1_status) {
1355   4                      case NORMAL: // normal execution
1356   4                          i_aux = (int32)ADC_buf[2];
1357   4                          if (i_aux < 0) 
1358   4                              i_aux = 0;
1359   4                          i_aux = filter_ch1(i_aux);
1360   4                          i_aux = (i_aux << 10) / g_mem.emg_max_value[0];
1361   4              
1362   4                          if (interrupt_flag){
1363   5                              interrupt_flag = FALSE;
1364   5                              interrupt_manager();
1365   5                          }
1366   4                          //Saturation
1367   4                          if (i_aux < 0)
1368   4                              i_aux = 0;
1369   4                          else
1370   4                              if (i_aux > 1024) 
1371   4                                  i_aux = 1024;
1372   4                          
1373   4                          g_meas.emg[0] = i_aux;
1374   4              
1375   4                          if (interrupt_flag){
1376   5                              interrupt_flag = FALSE;
1377   5                              interrupt_manager();
1378   5                          }
1379   4                          
1380   4                          break;
1381   4      
1382   4                      case RESET: // reset variables
1383   4                          emg_counter_1 = 0;
1384   4                          g_mem.emg_max_value[0] = 0;
1385   4                          emg_1_status = DISCARD; // goto next status
1386   4                          
1387   4                          break;
1388   4      
1389   4                      case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1390   4                          emg_counter_1++;
1391   4                          if (emg_counter_1 == EMG_SAMPLE_TO_DISCARD) {
1392   5                              emg_counter_1 = 0;          // reset counter
1393   5                              
1394   5                              LED_CTRL_Write(1);
1395   5                              LED_BLINK_EN_Write(0);
1396   5                                  
1397   5                              if (interrupt_flag){
1398   6                                  interrupt_flag = FALSE;
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 24  

1399   6                                  interrupt_manager();
1400   6                              }
1401   5                              
1402   5                              emg_1_status = SUM_AND_MEAN;           // sum and mean status
1403   5                          }
1404   4                          break;
1405   4      
1406   4                      case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1407   4                          // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1408   4                          emg_counter_1++;
1409   4                          if (ADC_buf[2] < 0) 
1410   4                              ADC_buf[2] = 0;
1411   4                          g_mem.emg_max_value[0] += filter_ch1((int32)ADC_buf[2]);
1412   4                          
1413   4                          if (interrupt_flag){
1414   5                              interrupt_flag = FALSE;
1415   5                              interrupt_manager();
1416   5                          }
1417   4                          
1418   4                          if (emg_counter_1 == SAMPLES_FOR_EMG_MEAN) {
1419   5                              g_mem.emg_max_value[0] = g_mem.emg_max_value[0] / SAMPLES_FOR_EMG_MEAN; // calc me
             -an
1420   5              
1421   5                              if (interrupt_flag){
1422   6                                  interrupt_flag = FALSE;
1423   6                                  interrupt_manager();
1424   6                              }                    
1425   5                              
1426   5                              LED_CTRL_Write(0);
1427   5                              LED_BLINK_EN_Write(0);
1428   5                              
1429   5                              emg_counter_1 = 0;          // reset counter
1430   5      
1431   5                              emg_1_status = NORMAL;           // goto normal execution
1432   5                          }
1433   4                          break;
1434   4      
1435   4                      default:
1436   4                          break;
1437   4                  }
1438   3              
1439   3                  if (interrupt_flag){
1440   4                      interrupt_flag = FALSE;
1441   4                      interrupt_manager();
1442   4                  }
1443   3                  // EMG 2 calibration state machine
1444   3                  switch(emg_2_status) {
1445   4                      case NORMAL: // normal execution
1446   4                          i_aux = (int32)ADC_buf[3];
1447   4                          if (i_aux < 0)
1448   4                              i_aux = 0;
1449   4                          i_aux = filter_ch2(i_aux);
1450   4                          i_aux = (i_aux << 10) / g_mem.emg_max_value[1];
1451   4              
1452   4                          if (interrupt_flag){
1453   5                              interrupt_flag = FALSE;
1454   5                              interrupt_manager();
1455   5                          }
1456   4                          
1457   4                          if (i_aux < 0) 
1458   4                              i_aux = 0;
1459   4                          else
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 25  

1460   4                              if (i_aux > 1024)
1461   4                                  i_aux = 1024;
1462   4                          
1463   4                          g_meas.emg[1] = i_aux;
1464   4      
1465   4                          break;
1466   4      
1467   4                      case RESET: // reset variables
1468   4                          emg_counter_2 = 0;
1469   4                          g_mem.emg_max_value[1] = 0;
1470   4              
1471   4                          if (interrupt_flag){
1472   5                              interrupt_flag = FALSE;
1473   5                              interrupt_manager();
1474   5                          }
1475   4                          
1476   4                          emg_2_status = WAIT; // wait for EMG 1 calibration
1477   4                          break;
1478   4      
1479   4                      case DISCARD: // discard first EMG_SAMPLE_TO_DISCARD samples
1480   4                          emg_counter_2++;
1481   4                          if (emg_counter_2 == EMG_SAMPLE_TO_DISCARD) {
1482   5                              emg_counter_2 = 0;          // reset counter
1483   5                              
1484   5                              LED_CTRL_Write(1);
1485   5                              LED_BLINK_EN_Write(0);
1486   5              
1487   5                              if (interrupt_flag){
1488   6                                  interrupt_flag = FALSE;
1489   6                                  interrupt_manager();
1490   6                              }
1491   5                              
1492   5                              emg_2_status = SUM_AND_MEAN;           // sum and mean status
1493   5                          }
1494   4                          break;
1495   4      
1496   4                      case SUM_AND_MEAN: // sum first SAMPLES_FOR_EMG_MEAN samples
1497   4                          // NOTE max(value)*SAMPLES_FOR_EMG_MEAN must fit in 32bit
1498   4                          emg_counter_2++;
1499   4                          if (ADC_buf[3] < 0)
1500   4                              ADC_buf[3] = 0;
1501   4                          g_mem.emg_max_value[1] += filter_ch2((int32)ADC_buf[3]);
1502   4              
1503   4                          if (interrupt_flag){
1504   5                              interrupt_flag = FALSE;
1505   5                              interrupt_manager();
1506   5                          }
1507   4                          
1508   4                          if (emg_counter_2 == SAMPLES_FOR_EMG_MEAN) {
1509   5                              g_mem.emg_max_value[1] = g_mem.emg_max_value[1] / SAMPLES_FOR_EMG_MEAN; // calc me
             -an
1510   5                              
1511   5                              LED_CTRL_Write(0);
1512   5                              LED_BLINK_EN_Write(0);
1513   5                              
1514   5                              emg_counter_2 = 0;          // reset counter
1515   5                          
1516   5                              if (interrupt_flag){
1517   6                                  interrupt_flag = FALSE;
1518   6                                  interrupt_manager();
1519   6                              }
1520   5                              
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 26  

1521   5                              emg_2_status = WAIT_EoC;           // goto end of calibration wait
1522   5                          }
1523   4                          break;
1524   4      
1525   4                      case WAIT: // wait for EMG calibration to be done
1526   4                          if (emg_1_status == NORMAL)
1527   4                              emg_2_status = DISCARD;           // goto discard sample
1528   4                          break;
1529   4      
1530   4                      case WAIT_EoC:  // wait for end of calibration procedure (only for LED visibility reasons)
1531   4                          emg_counter_2++;
1532   4                          if (emg_counter_2 == EMG_SAMPLE_TO_DISCARD) {
1533   5                              emg_counter_2 = 0;          // reset counter
1534   5      
1535   5                              if (interrupt_flag){
1536   6                                  interrupt_flag = FALSE;
1537   6                                  interrupt_manager();
1538   6                              }
1539   5                              
1540   5                              // if EMG control mode active, activate motors accordingly with startup value
1541   5                              if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1542   5                                  (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1543   5                                  (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1544   5                                  (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1545   6                                  if (c_mem.control_mode == CONTROL_ANGLE) {
1546   7                                      g_ref.pos[0] = g_meas.pos[0];
1547   7                                      g_ref.pos[1] = g_meas.pos[1];
1548   7                                  }
1549   6                                  g_ref.onoff = c_mem.activ;
1550   6                                  MOTOR_ON_OFF_Write(g_ref.onoff);
1551   6                              }
1552   5                                  
1553   5                              emg_2_status = NORMAL;           // goto normal execution
1554   5                          }
1555   4                          break;
1556   4                          
1557   4                      default:
1558   4                          break;
1559   4                  }
1560   3                      
1561   3                  if (interrupt_flag){
1562   4                      interrupt_flag = FALSE;
1563   4                      interrupt_manager();
1564   4                  }
1565   3              }
1566   2          }
1567   1          else {
1568   2      
1569   2              emg_1_status = RESET; 
1570   2              emg_2_status = RESET;
1571   2      
1572   2              UD_status = RESET;
1573   2              LR_status = RESET;
1574   2                      
1575   2              tension_valid = FALSE;
1576   2              
1577   2              //fixed
1578   2              LED_CTRL_Write(1);
1579   2              //PWM Blink Enable
1580   2              LED_BLINK_EN_Write(0);
1581   2                  
1582   2              if (interrupt_flag){
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 27  

1583   3                  interrupt_flag = FALSE;
1584   3                  interrupt_manager();
1585   3              }
1586   2              
1587   2              if (c_mem.emg_calibration_flag) {
1588   3                  if ((c_mem.input_mode == INPUT_MODE_EMG_PROPORTIONAL) ||
1589   3                      (c_mem.input_mode == INPUT_MODE_EMG_INTEGRAL) ||
1590   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS) ||
1591   3                      (c_mem.input_mode == INPUT_MODE_EMG_FCFS_ADV)) {
1592   4                      g_ref.onoff = 0x00;
1593   4                      MOTOR_ON_OFF_Write(g_ref.onoff);
1594   4                  }
1595   3              }
1596   2      
1597   2              // Reset current
1598   2              g_meas.curr[0] = 0;
1599   2      
1600   2              // Reset emg
1601   2              g_meas.emg[0] = 0;
1602   2              g_meas.emg[1] = 0;
1603   2              
1604   2              // Reset Joystick
1605   2              g_meas.joystick[0] = 0;
1606   2              g_meas.joystick[1] = 0;
1607   2      
1608   2          }
1609   1          
1610   1          // The board LED blinks if attached battery is not fully charged
1611   1          if (!first_tension_valid && tension_valid == TRUE && emg_1_status == NORMAL && emg_2_status == NORMAL)
             -{
1612   2              dev_tension_f = filter_voltage(dev_tension);
1613   2              if (dev_tension_f > 0.92 * pow_tension){
1614   3                  //fixed
1615   3                  LED_CTRL_Write(1);
1616   3                  
1617   3                  //PWM Blink Enable
1618   3                  LED_BLINK_EN_Write(0);
1619   3              }
1620   2              else {
1621   3                  // blink
1622   3                  LED_CTRL_Write(0);
1623   3                  
1624   3                  //PWM Blink Enable
1625   3                  LED_BLINK_EN_Write(1);
1626   3                  
1627   3                  // Disable slave or motors because of not fully charged battery
1628   3                  if (master_mode) {
1629   4                      deactivate_slaves();
1630   4                      
1631   4                      // Check Interrupt 
1632   4                      if (interrupt_flag){
1633   5                          interrupt_flag = FALSE;
1634   5                          interrupt_manager();
1635   5                      }
1636   4                      
1637   4                      master_mode = 0;        // exit from master mode
1638   4                  }
1639   3                  else {
1640   4                      g_refNew.onoff = 0x00;
1641   4                      MOTOR_ON_OFF_Write(g_refNew.onoff); // Deactivate motors
1642   4                  }
1643   3              }
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 28  

1644   2          }
1645   1              
1646   1          if (interrupt_flag){
1647   2              interrupt_flag = FALSE;
1648   2              interrupt_manager();
1649   2          }
1650   1      }
1651          
1652          //==============================================================================
1653          //                                                           OVERCURRENT CONTROL
1654          //==============================================================================
1655          
1656          void overcurrent_control() {
1657   1          if (c_mem.current_limit != 0) {
1658   2              // if the current is over the limit
1659   2              if (g_meas.curr[0] > c_mem.current_limit) {
1660   3                  //decrese pwm_limit
1661   3                  dev_pwm_limit--;
1662   3              // if the current is in the safe zone
1663   3              } else if (g_meas.curr[0] < (c_mem.current_limit - CURRENT_HYSTERESIS)) {
1664   3                  //increase pwm_limit
1665   3                  dev_pwm_limit++;
1666   3              }
1667   2      
1668   2              // Bound pwm_limit
1669   2              if (dev_pwm_limit < 0) 
1670   2                  dev_pwm_limit = 0;
1671   2              else 
1672   2                  if (dev_pwm_limit > 100) 
1673   2                      dev_pwm_limit = 100;
1674   2          }
1675   1      }
1676          
1677          //==============================================================================
1678          //                                                              PWM_LIMIT_SEARCH
1679          //==============================================================================
1680          
1681          void pwm_limit_search() {
1682   1      
1683   1          uint8 CYDATA index;
1684   1      
1685   1          if (dev_tension > 25500) {
1686   2              dev_pwm_limit = 0;
1687   2          } else if (dev_tension < 11500) {
1688   2              dev_pwm_limit = 100;
1689   2          } else {
1690   2              index = (uint8)((dev_tension - 11500) >> 9);
1691   2              dev_pwm_limit = pwm_preload_values[index];
1692   2          }
1693   1      }
1694          
1695          /* [] END OF FILE */
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 29  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION ISR_WATCHDOG_Handler (BEGIN)
                                           ; SOURCE LINE # 102
                                           ; SOURCE LINE # 106
0000 D200        E     SETB    watchdog_flag
                                           ; SOURCE LINE # 108
0002 32                RETI    
             ; FUNCTION ISR_WATCHDOG_Handler (END)

             ; FUNCTION ISR_RS485_RX_ExInterrupt (BEGIN)
                                           ; SOURCE LINE # 114
                                           ; SOURCE LINE # 118
0000 D200        E     SETB    interrupt_flag
                                           ; SOURCE LINE # 120
0002 32                RETI    
             ; FUNCTION ISR_RS485_RX_ExInterrupt (END)

             ; FUNCTION interrupt_manager (BEGIN)
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 153
0000 E4                CLR     A
0001 F500        R     MOV     package_count,A
0003         ?C0003:
                                           ; SOURCE LINE # 159
0003 120000      E     LCALL   UART_RS485_GetRxBufferSize
0006 EF                MOV     A,R7
0007 7003              JNZ     $ + 5H
0009 020000      R     LJMP    ?C0026
000C E500        R     MOV     A,package_count
000E C3                CLR     C
000F 9406              SUBB    A,#06H
0011 4003              JC      $ + 5H
0013 020000      R     LJMP    ?C0026
                                           ; SOURCE LINE # 163
0016 120000      E     LCALL   UART_RS485_GetChar
0019 8F00        R     MOV     rx_data,R7
                                           ; SOURCE LINE # 165
001B E500        R     MOV     A,state
001D 14                DEC     A
001E 6049              JZ      ?C0010
0020 14                DEC     A
0021 6068              JZ      ?C0014
0023 14                DEC     A
0024 7003              JNZ     $ + 5H
0026 020000      R     LJMP    ?C0021
0029 14                DEC     A
002A 7003              JNZ     $ + 5H
002C 020000      R     LJMP    ?C0024
002F 2404              ADD     A,#04H
0031 70D0              JNZ     ?C0003
                                           ; SOURCE LINE # 167
0033         ?C0006:
                                           ; SOURCE LINE # 169
0033 850000      R     MOV     rx_queue,rx_queue+01H
                                           ; SOURCE LINE # 170
0036 850000      R     MOV     rx_queue+01H,rx_queue+02H
                                           ; SOURCE LINE # 171
0039 850000      R     MOV     rx_queue+02H,rx_data
                                           ; SOURCE LINE # 174
003C E500        R     MOV     A,rx_queue+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 30  

003E B43A11            CJNE    A,#03AH,?C0007
0041 E500        R     MOV     A,rx_queue+02H
0043 B43A0C            CJNE    A,#03AH,?C0007
                                           ; SOURCE LINE # 175
0046 E4                CLR     A
0047 F500        R     MOV     rx_queue,A
                                           ; SOURCE LINE # 176
0049 F500        R     MOV     rx_queue+01H,A
                                           ; SOURCE LINE # 177
004B F500        R     MOV     rx_queue+02H,A
                                           ; SOURCE LINE # 178
004D 750001      R     MOV     state,#01H
                                           ; SOURCE LINE # 179
0050 80B1              SJMP    ?C0003
0052         ?C0007:
                                           ; SOURCE LINE # 180
0052 E500        R     MOV     A,rx_queue
0054 B43FAC            CJNE    A,#03FH,?C0003
0057 E500        R     MOV     A,rx_queue+01H
0059 B40DA7            CJNE    A,#0DH,?C0003
005C E500        R     MOV     A,rx_queue+02H
005E 640A              XRL     A,#0AH
0060 70A1              JNZ     ?C0003
                                           ; SOURCE LINE # 183
0062 FF                MOV     R7,A
0063 FE                MOV     R6,A
0064 120000      E     LCALL   _infoGet
                                           ; SOURCE LINE # 184
0067 809A              SJMP    ?C0003
                                           ; SOURCE LINE # 187
0069         ?C0010:
                                           ; SOURCE LINE # 190
0069 900000      E     MOV     DPTR,#c_mem+01H
006C E0                MOVX    A,@DPTR
006D 6500        R     XRL     A,rx_data
006F 600B              JZ      ?C0012
0071 E500        R     MOV     A,rx_data
0073 6007              JZ      ?C0012
0075 900000      E     MOV     DPTR,#c_mem+0BAH
0078 E0                MOVX    A,@DPTR
0079 B50004            CJNE    A,rx_data,?C0011
007C         ?C0012:
                                           ; SOURCE LINE # 191
007C C200        R     CLR     rx_data_type
007E 8002              SJMP    ?C0013
0080         ?C0011:
                                           ; SOURCE LINE # 193
0080 D200        R     SETB    rx_data_type
0082         ?C0013:
                                           ; SOURCE LINE # 195
0082 E4                CLR     A
0083 F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 196
0085 750002      R     MOV     state,#02H
                                           ; SOURCE LINE # 197
0088 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 200
008B         ?C0014:
                                           ; SOURCE LINE # 203
008B 850000      R     MOV     data_packet_length,rx_data
                                           ; SOURCE LINE # 205
008E E500        R     MOV     A,data_packet_length
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 31  

0090 D3                SETB    C
0091 9401              SUBB    A,#01H
0093 5008              JNC     ?C0015
                                           ; SOURCE LINE # 206
0095 E4                CLR     A
0096 F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 207
0098 F500        R     MOV     state,A
                                           ; SOURCE LINE # 208
009A 020000      R     LJMP    ?C0003
009D         ?C0015:
009D E500        R     MOV     A,data_packet_length
009F D3                SETB    C
00A0 9480              SUBB    A,#080H
00A2 4008              JC      ?C0017
                                           ; SOURCE LINE # 209
00A4 E4                CLR     A
00A5 F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 210
00A7 F500        R     MOV     state,A
                                           ; SOURCE LINE # 211
00A9 020000      R     LJMP    ?C0003
00AC         ?C0017:
                                           ; SOURCE LINE # 212
00AC E4                CLR     A
00AD F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 214
00AF 200006            JB      rx_data_type,?C0019
                                           ; SOURCE LINE # 215
00B2 750003      R     MOV     state,#03H
00B5 020000      R     LJMP    ?C0003
00B8         ?C0019:
                                           ; SOURCE LINE # 217
00B8 750004      R     MOV     state,#04H
                                           ; SOURCE LINE # 218
                                           ; SOURCE LINE # 219
00BB 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 222
00BE         ?C0021:
                                           ; SOURCE LINE # 224
00BE 7400        R     MOV     A,#LOW data_packet_buffer
00C0 2500        R     ADD     A,data_packet_index
00C2 F582              MOV     DPL,A
00C4 E4                CLR     A
00C5 3400        R     ADDC    A,#HIGH data_packet_buffer
00C7 F583              MOV     DPH,A
00C9 E500        R     MOV     A,rx_data
00CB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 225
00CC 0500        R     INC     data_packet_index
                                           ; SOURCE LINE # 228
00CE E500        R     MOV     A,data_packet_index
00D0 C3                CLR     C
00D1 9500        R     SUBB    A,data_packet_length
00D3 5003              JNC     $ + 5H
00D5 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 230
00D8 200025            JB      rx_data_type,?C0023
                                           ; SOURCE LINE # 232
00DB AF00        R     MOV     R7,data_packet_length
00DD 7E00              MOV     R6,#00H
00DF 7800        E     MOV     R0,#LOW g_rx
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 32  

00E1 7C00        E     MOV     R4,#HIGH g_rx
00E3 7D01              MOV     R5,#01H
00E5 7B01              MOV     R3,#01H
00E7 7A00        R     MOV     R2,#HIGH data_packet_buffer
00E9 7900        R     MOV     R1,#LOW data_packet_buffer
00EB 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 233
00EE 900000      E     MOV     DPTR,#g_rx+080H
00F1 E4                CLR     A
00F2 F0                MOVX    @DPTR,A
00F3 A3                INC     DPTR
00F4 E500        R     MOV     A,data_packet_length
00F6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 234
00F7 900000      E     MOV     DPTR,#g_rx+084H
00FA 7401              MOV     A,#01H
00FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 236
00FD 120000      E     LCALL   commProcess
                                           ; SOURCE LINE # 237
0100         ?C0023:
                                           ; SOURCE LINE # 239
0100 E4                CLR     A
0101 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 240
0103 F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 241
0105 F500        R     MOV     state,A
                                           ; SOURCE LINE # 242
0107 0500        R     INC     package_count
                                           ; SOURCE LINE # 244
                                           ; SOURCE LINE # 245
0109 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 248
010C         ?C0024:
                                           ; SOURCE LINE # 249
010C 1500        R     DEC     data_packet_length
010E E500        R     MOV     A,data_packet_length
0110 6003              JZ      $ + 5H
0112 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 250
0115 F500        R     MOV     data_packet_index,A
                                           ; SOURCE LINE # 251
0117 F500        R     MOV     data_packet_length,A
                                           ; SOURCE LINE # 252
0119 7F01              MOV     R7,#01H
011B 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 253
011E E4                CLR     A
011F FF                MOV     R7,A
0120 120000      E     LCALL   _RS485_CTS_Write
                                           ; SOURCE LINE # 254
0123 E4                CLR     A
0124 F500        R     MOV     state,A
                                           ; SOURCE LINE # 255
0126 0500        R     INC     package_count
                                           ; SOURCE LINE # 256
                                           ; SOURCE LINE # 257
0128 020000      R     LJMP    ?C0003
                                           ; SOURCE LINE # 258
                                           ; SOURCE LINE # 259
012B 020000      R     LJMP    ?C0003
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 33  

                                           ; SOURCE LINE # 260
012E         ?C0026:
012E 22                RET     
             ; FUNCTION interrupt_manager (END)

             ; FUNCTION function_scheduler (BEGIN)
                                           ; SOURCE LINE # 269
                                           ; SOURCE LINE # 273
0000 120000      E     LCALL   MY_TIMER_ReadCounter
0003 900000      E     MOV     DPTR,#timer_value0
0006 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 277
0009 7F01              MOV     R7,#01H
000B 120000      E     LCALL   _ADC_SOC_Write
                                           ; SOURCE LINE # 281
000E 300005            JNB     interrupt_flag,?C0027
                                           ; SOURCE LINE # 282
0011 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 283
0013 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 284
0016         ?C0027:
                                           ; SOURCE LINE # 288
0016 E4                CLR     A
0017 FF                MOV     R7,A
0018 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 292
001B 300005            JNB     interrupt_flag,?C0028
                                           ; SOURCE LINE # 293
001E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 294
0020 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 295
0023         ?C0028:
                                           ; SOURCE LINE # 297
0023 7F01              MOV     R7,#01H
0025 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 301
0028 300005            JNB     interrupt_flag,?C0029
                                           ; SOURCE LINE # 302
002B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 303
002D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 304
0030         ?C0029:
                                           ; SOURCE LINE # 306
0030 7F02              MOV     R7,#02H
0032 120000      R     LCALL   _encoder_reading
                                           ; SOURCE LINE # 310
0035 300005            JNB     interrupt_flag,?C0030
                                           ; SOURCE LINE # 311
0038 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 312
003A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 313
003D         ?C0030:
                                           ; SOURCE LINE # 317
003D 120000      R     LCALL   motor_control
                                           ; SOURCE LINE # 321
0040 300005            JNB     interrupt_flag,?C0031
                                           ; SOURCE LINE # 322
0043 C200        E     CLR     interrupt_flag
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 34  

                                           ; SOURCE LINE # 323
0045 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 324
0048         ?C0031:
                                           ; SOURCE LINE # 328
0048 120000      R     LCALL   analog_read_end
                                           ; SOURCE LINE # 330
004B 300005            JNB     interrupt_flag,?C0032
                                           ; SOURCE LINE # 331
004E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 332
0050 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 333
0053         ?C0032:
                                           ; SOURCE LINE # 337
0053 120000      R     LCALL   overcurrent_control
                                           ; SOURCE LINE # 341
0056 300005            JNB     interrupt_flag,?C0033
                                           ; SOURCE LINE # 342
0059 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 343
005B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 344
005E         ?C0033:
                                           ; SOURCE LINE # 348
005E 900000      E     MOV     DPTR,#master_mode
0061 E0                MOVX    A,@DPTR
0062 7003              JNZ     $ + 5H
0064 020000      R     LJMP    ?C0034
                                           ; SOURCE LINE # 350
0067 900000      E     MOV     DPTR,#c_mem+0A9H
006A E0                MOVX    A,@DPTR
006B 6068              JZ      ?C0035
                                           ; SOURCE LINE # 353
006D 900000      E     MOV     DPTR,#c_mem+096H
0070 E0                MOVX    A,@DPTR
0071 6401              XRL     A,#01H
0073 7055              JNZ     ?C0036
                                           ; SOURCE LINE # 354
0075 900000      R     MOV     DPTR,#counter_calibration
0078 E0                MOVX    A,@DPTR
0079 7004              JNZ     ?C0313
007B A3                INC     DPTR
007C E0                MOVX    A,@DPTR
007D 640A              XRL     A,#0AH
007F         ?C0313:
007F 7033              JNZ     ?C0037
                                           ; SOURCE LINE # 357
0081 900000      E     MOV     DPTR,#c_mem+0A7H
0084 E0                MOVX    A,@DPTR
0085 7004              JNZ     ?C0039
0087 A3                INC     DPTR
0088 E0                MOVX    A,@DPTR
0089 6016              JZ      ?C0038
008B         ?C0039:
                                           ; SOURCE LINE # 358
008B 900000      E     MOV     DPTR,#SH_current_position
008E E0                MOVX    A,@DPTR
008F FC                MOV     R4,A
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 35  

0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FE                MOV     R6,A
0096 A3                INC     DPTR
0097 E0                MOVX    A,@DPTR
0098 FF                MOV     R7,A
0099 900000      E     MOV     DPTR,#curr_pos_res
009C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 359
009F 8009              SJMP    ?C0040
00A1         ?C0038:
                                           ; SOURCE LINE # 360
                                           ; SOURCE LINE # 361
00A1 120000      E     LCALL   commReadMeasFromSH
00A4 900000      E     MOV     DPTR,#curr_pos_res
00A7 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 362
00AA         ?C0040:
                                           ; SOURCE LINE # 365
00AA 120000      E     LCALL   check_rest_position
                                           ; SOURCE LINE # 366
00AD E4                CLR     A
00AE 900000      R     MOV     DPTR,#counter_calibration
00B1 F0                MOVX    @DPTR,A
00B2 A3                INC     DPTR
00B3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 367
00B4         ?C0037:
                                           ; SOURCE LINE # 368
00B4 900000      R     MOV     DPTR,#counter_calibration+01H
00B7 E0                MOVX    A,@DPTR
00B8 04                INC     A
00B9 F0                MOVX    @DPTR,A
00BA 7006              JNZ     ?C0314
00BC 900000      R     MOV     DPTR,#counter_calibration
00BF E0                MOVX    A,@DPTR
00C0 04                INC     A
00C1 F0                MOVX    @DPTR,A
00C2         ?C0314:
                                           ; SOURCE LINE # 371
00C2 300005            JNB     interrupt_flag,?C0036
                                           ; SOURCE LINE # 372
00C5 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 373
00C7 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 374
                                           ; SOURCE LINE # 375
00CA         ?C0036:
                                           ; SOURCE LINE # 377
00CA 120000      E     LCALL   drive_SH
                                           ; SOURCE LINE # 380
00CD 300005            JNB     interrupt_flag,?C0035
                                           ; SOURCE LINE # 381
00D0 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 382
00D2 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 383
                                           ; SOURCE LINE # 384
00D5         ?C0035:
                                           ; SOURCE LINE # 386
00D5 900000      E     MOV     DPTR,#c_mem+0A7H
00D8 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 36  

00D9 600B              JZ      ?C0043
                                           ; SOURCE LINE # 387
00DB 120000      E     LCALL   drive_force_fb
                                           ; SOURCE LINE # 390
00DE 300005            JNB     interrupt_flag,?C0043
                                           ; SOURCE LINE # 391
00E1 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 392
00E3 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 393
                                           ; SOURCE LINE # 395
00E6         ?C0043:
                                           ; SOURCE LINE # 397
00E6 900000      E     MOV     DPTR,#c_mem+0A8H
00E9 E0                MOVX    A,@DPTR
00EA 600B              JZ      ?C0034
                                           ; SOURCE LINE # 398
00EC 120000      E     LCALL   drive_proprio_fb
                                           ; SOURCE LINE # 401
00EF 300005            JNB     interrupt_flag,?C0034
                                           ; SOURCE LINE # 402
00F2 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 403
00F4 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 404
                                           ; SOURCE LINE # 405
                                           ; SOURCE LINE # 407
00F7         ?C0034:
                                           ; SOURCE LINE # 411
00F7 300005            JNB     interrupt_flag,?C0047
                                           ; SOURCE LINE # 412
00FA C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 413
00FC 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 414
00FF         ?C0047:
                                           ; SOURCE LINE # 419
00FF 900000      E     MOV     DPTR,#calib
0102 E0                MOVX    A,@DPTR
0103 B40124            CJNE    A,#01H,?C0048
                                           ; SOURCE LINE # 420
0106 900000      R     MOV     DPTR,#counter_calibration
0109 E0                MOVX    A,@DPTR
010A 7004              JNZ     ?C0315
010C A3                INC     DPTR
010D E0                MOVX    A,@DPTR
010E 640A              XRL     A,#0AH
0110         ?C0315:
0110 700A              JNZ     ?C0049
                                           ; SOURCE LINE # 421
0112 120000      E     LCALL   calibration
                                           ; SOURCE LINE # 422
0115 E4                CLR     A
0116 900000      R     MOV     DPTR,#counter_calibration
0119 F0                MOVX    @DPTR,A
011A A3                INC     DPTR
011B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 423
011C         ?C0049:
                                           ; SOURCE LINE # 424
011C 900000      R     MOV     DPTR,#counter_calibration+01H
011F E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 37  

0120 04                INC     A
0121 F0                MOVX    @DPTR,A
0122 7006              JNZ     ?C0316
0124 900000      R     MOV     DPTR,#counter_calibration
0127 E0                MOVX    A,@DPTR
0128 04                INC     A
0129 F0                MOVX    @DPTR,A
012A         ?C0316:
                                           ; SOURCE LINE # 425
012A         ?C0048:
                                           ; SOURCE LINE # 429
012A 300005            JNB     interrupt_flag,?C0050
                                           ; SOURCE LINE # 430
012D C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 431
012F 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 432
0132         ?C0050:
                                           ; SOURCE LINE # 438
0132 7800        E     MOV     R0,#LOW g_measOld
0134 7C00        E     MOV     R4,#HIGH g_measOld
0136 7D01              MOV     R5,#01H
0138 7B01              MOV     R3,#01H
013A 7A00        E     MOV     R2,#HIGH g_meas
013C 7900        E     MOV     R1,#LOW g_meas
013E 7E00              MOV     R6,#00H
0140 7F3B              MOV     R7,#03BH
0142 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 439
0145 7800        E     MOV     R0,#LOW g_refOld
0147 7C00        E     MOV     R4,#HIGH g_refOld
0149 7D01              MOV     R5,#01H
014B 7B01              MOV     R3,#01H
014D 7A00        E     MOV     R2,#HIGH g_ref
014F 7900        E     MOV     R1,#LOW g_ref
0151 7E00              MOV     R6,#00H
0153 7F19              MOV     R7,#019H
0155 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 442
0158 7800        E     MOV     R0,#LOW g_ref
015A 7C00        E     MOV     R4,#HIGH g_ref
015C 7D01              MOV     R5,#01H
015E 7B01              MOV     R3,#01H
0160 7A00        E     MOV     R2,#HIGH g_refNew
0162 7900        E     MOV     R1,#LOW g_refNew
0164 7E00              MOV     R6,#00H
0166 7F19              MOV     R7,#019H
0168 120000      E     LCALL   ?C?COPYAMD
                                           ; SOURCE LINE # 444
016B 300005            JNB     interrupt_flag,?C0051
                                           ; SOURCE LINE # 445
016E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 446
0170 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 447
0173         ?C0051:
                                           ; SOURCE LINE # 449
0173 120000      E     LCALL   MY_TIMER_ReadCounter
0176 900000      E     MOV     DPTR,#timer_value
0179 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 450
017C 7F40              MOV     R7,#040H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 38  

017E 7E4B              MOV     R6,#04BH
0180 7D4C              MOV     R5,#04CH
0182 7C00              MOV     R4,#00H
0184 120000      E     LCALL   _MY_TIMER_WriteCounter
                                           ; SOURCE LINE # 452
0187 22                RET     
             ; FUNCTION function_scheduler (END)

             ; FUNCTION motor_control (BEGIN)
                                           ; SOURCE LINE # 458
                                           ; SOURCE LINE # 460
0000 E4                CLR     A
0001 F500        R     MOV     pwm_input+03H,A
0003 F500        R     MOV     pwm_input+02H,A
0005 F500        R     MOV     pwm_input+01H,A
0007 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 471
0009 900000      E     MOV     DPTR,#c_mem+02H
000C E0                MOVX    A,@DPTR
000D FC                MOV     R4,A
000E A3                INC     DPTR
000F E0                MOVX    A,@DPTR
0010 FD                MOV     R5,A
0011 A3                INC     DPTR
0012 E0                MOVX    A,@DPTR
0013 FE                MOV     R6,A
0014 A3                INC     DPTR
0015 E0                MOVX    A,@DPTR
0016 F500        R     MOV     k_p+03H,A
0018 8E00        R     MOV     k_p+02H,R6
001A 8D00        R     MOV     k_p+01H,R5
001C 8C00        R     MOV     k_p,R4
                                           ; SOURCE LINE # 472
001E A3                INC     DPTR
001F E0                MOVX    A,@DPTR
0020 FC                MOV     R4,A
0021 A3                INC     DPTR
0022 E0                MOVX    A,@DPTR
0023 FD                MOV     R5,A
0024 A3                INC     DPTR
0025 E0                MOVX    A,@DPTR
0026 FE                MOV     R6,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 F500        R     MOV     k_i+03H,A
002B 8E00        R     MOV     k_i+02H,R6
002D 8D00        R     MOV     k_i+01H,R5
002F 8C00        R     MOV     k_i,R4
                                           ; SOURCE LINE # 473
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 FC                MOV     R4,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 FD                MOV     R5,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FE                MOV     R6,A
003A A3                INC     DPTR
003B E0                MOVX    A,@DPTR
003C F500        R     MOV     k_d+03H,A
003E 8E00        R     MOV     k_d+02H,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 39  

0040 8D00        R     MOV     k_d+01H,R5
0042 8C00        R     MOV     k_d,R4
                                           ; SOURCE LINE # 475
0044 A3                INC     DPTR
0045 E0                MOVX    A,@DPTR
0046 FC                MOV     R4,A
0047 A3                INC     DPTR
0048 E0                MOVX    A,@DPTR
0049 FD                MOV     R5,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C FE                MOV     R6,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F F500        R     MOV     k_p_c+03H,A
0051 8E00        R     MOV     k_p_c+02H,R6
0053 8D00        R     MOV     k_p_c+01H,R5
0055 8C00        R     MOV     k_p_c,R4
                                           ; SOURCE LINE # 476
0057 A3                INC     DPTR
0058 E0                MOVX    A,@DPTR
0059 FC                MOV     R4,A
005A A3                INC     DPTR
005B E0                MOVX    A,@DPTR
005C FD                MOV     R5,A
005D A3                INC     DPTR
005E E0                MOVX    A,@DPTR
005F FE                MOV     R6,A
0060 A3                INC     DPTR
0061 E0                MOVX    A,@DPTR
0062 F500        R     MOV     k_i_c+03H,A
0064 8E00        R     MOV     k_i_c+02H,R6
0066 8D00        R     MOV     k_i_c+01H,R5
0068 8C00        R     MOV     k_i_c,R4
                                           ; SOURCE LINE # 477
006A A3                INC     DPTR
006B E0                MOVX    A,@DPTR
006C FC                MOV     R4,A
006D A3                INC     DPTR
006E E0                MOVX    A,@DPTR
006F FD                MOV     R5,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 FE                MOV     R6,A
0073 A3                INC     DPTR
0074 E0                MOVX    A,@DPTR
0075 F500        R     MOV     k_d_c+03H,A
0077 8E00        R     MOV     k_d_c+02H,R6
0079 8D00        R     MOV     k_d_c+01H,R5
007B 8C00        R     MOV     k_d_c,R4
                                           ; SOURCE LINE # 479
007D A3                INC     DPTR
007E E0                MOVX    A,@DPTR
007F FC                MOV     R4,A
0080 A3                INC     DPTR
0081 E0                MOVX    A,@DPTR
0082 FD                MOV     R5,A
0083 A3                INC     DPTR
0084 E0                MOVX    A,@DPTR
0085 FE                MOV     R6,A
0086 A3                INC     DPTR
0087 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 40  

0088 F500        R     MOV     k_p_dl+03H,A
008A 8E00        R     MOV     k_p_dl+02H,R6
008C 8D00        R     MOV     k_p_dl+01H,R5
008E 8C00        R     MOV     k_p_dl,R4
                                           ; SOURCE LINE # 480
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FC                MOV     R4,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FD                MOV     R5,A
0096 A3                INC     DPTR
0097 E0                MOVX    A,@DPTR
0098 FE                MOV     R6,A
0099 A3                INC     DPTR
009A E0                MOVX    A,@DPTR
009B F500        R     MOV     k_i_dl+03H,A
009D 8E00        R     MOV     k_i_dl+02H,R6
009F 8D00        R     MOV     k_i_dl+01H,R5
00A1 8C00        R     MOV     k_i_dl,R4
                                           ; SOURCE LINE # 481
00A3 A3                INC     DPTR
00A4 E0                MOVX    A,@DPTR
00A5 FC                MOV     R4,A
00A6 A3                INC     DPTR
00A7 E0                MOVX    A,@DPTR
00A8 FD                MOV     R5,A
00A9 A3                INC     DPTR
00AA E0                MOVX    A,@DPTR
00AB FE                MOV     R6,A
00AC A3                INC     DPTR
00AD E0                MOVX    A,@DPTR
00AE F500        R     MOV     k_d_dl+03H,A
00B0 8E00        R     MOV     k_d_dl+02H,R6
00B2 8D00        R     MOV     k_d_dl+01H,R5
00B4 8C00        R     MOV     k_d_dl,R4
                                           ; SOURCE LINE # 483
00B6 A3                INC     DPTR
00B7 E0                MOVX    A,@DPTR
00B8 FC                MOV     R4,A
00B9 A3                INC     DPTR
00BA E0                MOVX    A,@DPTR
00BB FD                MOV     R5,A
00BC A3                INC     DPTR
00BD E0                MOVX    A,@DPTR
00BE FE                MOV     R6,A
00BF A3                INC     DPTR
00C0 E0                MOVX    A,@DPTR
00C1 F500        R     MOV     k_p_c_dl+03H,A
00C3 8E00        R     MOV     k_p_c_dl+02H,R6
00C5 8D00        R     MOV     k_p_c_dl+01H,R5
00C7 8C00        R     MOV     k_p_c_dl,R4
                                           ; SOURCE LINE # 484
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB FC                MOV     R4,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE FD                MOV     R5,A
00CF A3                INC     DPTR
00D0 E0                MOVX    A,@DPTR
00D1 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 41  

00D2 A3                INC     DPTR
00D3 E0                MOVX    A,@DPTR
00D4 F500        R     MOV     k_i_c_dl+03H,A
00D6 8E00        R     MOV     k_i_c_dl+02H,R6
00D8 8D00        R     MOV     k_i_c_dl+01H,R5
00DA 8C00        R     MOV     k_i_c_dl,R4
                                           ; SOURCE LINE # 485
00DC A3                INC     DPTR
00DD E0                MOVX    A,@DPTR
00DE FC                MOV     R4,A
00DF A3                INC     DPTR
00E0 E0                MOVX    A,@DPTR
00E1 FD                MOV     R5,A
00E2 A3                INC     DPTR
00E3 E0                MOVX    A,@DPTR
00E4 FE                MOV     R6,A
00E5 A3                INC     DPTR
00E6 E0                MOVX    A,@DPTR
00E7 F500        R     MOV     k_d_c_dl+03H,A
00E9 8E00        R     MOV     k_d_c_dl+02H,R6
00EB 8D00        R     MOV     k_d_c_dl+01H,R5
00ED 8C00        R     MOV     k_d_c_dl,R4
                                           ; SOURCE LINE # 502
00EF 900000      E     MOV     DPTR,#c_mem+06BH
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 FF                MOV     R7,A
00F7 FB                MOV     R3,A
00F8 AA06              MOV     R2,AR6
00FA E4                CLR     A
00FB 900000      E     MOV     DPTR,#g_meas+017H
00FE E0                MOVX    A,@DPTR
00FF FC                MOV     R4,A
0100 A3                INC     DPTR
0101 E0                MOVX    A,@DPTR
0102 FD                MOV     R5,A
0103 A3                INC     DPTR
0104 E0                MOVX    A,@DPTR
0105 FE                MOV     R6,A
0106 A3                INC     DPTR
0107 E0                MOVX    A,@DPTR
0108 C3                CLR     C
0109 9B                SUBB    A,R3
010A F500        R     MOV     err_emg_1+03H,A
010C EE                MOV     A,R6
010D 9A                SUBB    A,R2
010E F500        R     MOV     err_emg_1+02H,A
0110 ED                MOV     A,R5
0111 9400              SUBB    A,#00H
0113 F500        R     MOV     err_emg_1+01H,A
0115 EC                MOV     A,R4
0116 9400              SUBB    A,#00H
0118 F500        R     MOV     err_emg_1,A
                                           ; SOURCE LINE # 503
011A 900000      E     MOV     DPTR,#c_mem+06DH
011D E0                MOVX    A,@DPTR
011E FE                MOV     R6,A
011F A3                INC     DPTR
0120 E0                MOVX    A,@DPTR
0121 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 42  

0122 FB                MOV     R3,A
0123 AA06              MOV     R2,AR6
0125 E4                CLR     A
0126 900000      E     MOV     DPTR,#g_meas+01BH
0129 E0                MOVX    A,@DPTR
012A FC                MOV     R4,A
012B A3                INC     DPTR
012C E0                MOVX    A,@DPTR
012D FD                MOV     R5,A
012E A3                INC     DPTR
012F E0                MOVX    A,@DPTR
0130 FE                MOV     R6,A
0131 A3                INC     DPTR
0132 E0                MOVX    A,@DPTR
0133 C3                CLR     C
0134 9B                SUBB    A,R3
0135 F500        R     MOV     err_emg_2+03H,A
0137 EE                MOV     A,R6
0138 9A                SUBB    A,R2
0139 F500        R     MOV     err_emg_2+02H,A
013B ED                MOV     A,R5
013C 9400              SUBB    A,#00H
013E F500        R     MOV     err_emg_2+01H,A
0140 EC                MOV     A,R4
0141 9400              SUBB    A,#00H
0143 F500        R     MOV     err_emg_2,A
                                           ; SOURCE LINE # 506
0145 900000      E     MOV     DPTR,#c_mem+033H
0148 E0                MOVX    A,@DPTR
0149 24FE              ADD     A,#0FEH
014B 7003              JNZ     $ + 5H
014D 020000      R     LJMP    ?C0063
0150 14                DEC     A
0151 7003              JNZ     $ + 5H
0153 020000      R     LJMP    ?C0066
0156 14                DEC     A
0157 7003              JNZ     $ + 5H
0159 020000      R     LJMP    ?C0069
015C 14                DEC     A
015D 7003              JNZ     $ + 5H
015F 020000      R     LJMP    ?C0079
0162 14                DEC     A
0163 7003              JNZ     $ + 5H
0165 020000      R     LJMP    ?C0091
0168 2405              ADD     A,#05H
016A 6003              JZ      $ + 5H
016C 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 508
016F         ?C0054:
                                           ; SOURCE LINE # 510
016F 900000      E     MOV     DPTR,#master_mode
0172 E0                MOVX    A,@DPTR
0173 6026              JZ      ?C0055
                                           ; SOURCE LINE # 512
0175 900000      E     MOV     DPTR,#c_mem+07AH
0178 E0                MOVX    A,@DPTR
0179 FF                MOV     R7,A
017A 33                RLC     A
017B 95E0              SUBB    A,ACC
017D FE                MOV     R6,A
017E FD                MOV     R5,A
017F FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 43  

0180 900000      E     MOV     DPTR,#g_meas
0183 E0                MOVX    A,@DPTR
0184 F8                MOV     R0,A
0185 A3                INC     DPTR
0186 E0                MOVX    A,@DPTR
0187 F9                MOV     R1,A
0188 A3                INC     DPTR
0189 E0                MOVX    A,@DPTR
018A FA                MOV     R2,A
018B A3                INC     DPTR
018C E0                MOVX    A,@DPTR
018D FB                MOV     R3,A
018E 120000      E     LCALL   ?C?LMUL
0191 8F00        R     MOV     handle_value+03H,R7
0193 8E00        R     MOV     handle_value+02H,R6
0195 8D00        R     MOV     handle_value+01H,R5
0197 8C00        R     MOV     handle_value,R4
                                           ; SOURCE LINE # 513
0199 804E              SJMP    ?C0056
019B         ?C0055:
                                           ; SOURCE LINE # 514
                                           ; SOURCE LINE # 518
019B 900000      E     MOV     DPTR,#c_mem+079H
019E E0                MOVX    A,@DPTR
019F 6024              JZ      ?C0057
                                           ; SOURCE LINE # 519
01A1 A3                INC     DPTR
01A2 E0                MOVX    A,@DPTR
01A3 FF                MOV     R7,A
01A4 33                RLC     A
01A5 95E0              SUBB    A,ACC
01A7 FE                MOV     R6,A
01A8 FD                MOV     R5,A
01A9 FC                MOV     R4,A
01AA 900000      E     MOV     DPTR,#g_meas+08H
01AD E0                MOVX    A,@DPTR
01AE F8                MOV     R0,A
01AF A3                INC     DPTR
01B0 E0                MOVX    A,@DPTR
01B1 F9                MOV     R1,A
01B2 A3                INC     DPTR
01B3 E0                MOVX    A,@DPTR
01B4 FA                MOV     R2,A
01B5 A3                INC     DPTR
01B6 E0                MOVX    A,@DPTR
01B7 FB                MOV     R3,A
01B8 120000      E     LCALL   ?C?LMUL
01BB 8F00        R     MOV     handle_value+03H,R7
01BD 8E00        R     MOV     handle_value+02H,R6
01BF 8D00        R     MOV     handle_value+01H,R5
01C1 8C00        R     MOV     handle_value,R4
01C3 8024              SJMP    ?C0056
01C5         ?C0057:
                                           ; SOURCE LINE # 521
01C5 900000      E     MOV     DPTR,#c_mem+07AH
01C8 E0                MOVX    A,@DPTR
01C9 FF                MOV     R7,A
01CA 33                RLC     A
01CB 95E0              SUBB    A,ACC
01CD FE                MOV     R6,A
01CE FD                MOV     R5,A
01CF FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 44  

01D0 900000      E     MOV     DPTR,#g_meas+04H
01D3 E0                MOVX    A,@DPTR
01D4 F8                MOV     R0,A
01D5 A3                INC     DPTR
01D6 E0                MOVX    A,@DPTR
01D7 F9                MOV     R1,A
01D8 A3                INC     DPTR
01D9 E0                MOVX    A,@DPTR
01DA FA                MOV     R2,A
01DB A3                INC     DPTR
01DC E0                MOVX    A,@DPTR
01DD FB                MOV     R3,A
01DE 120000      E     LCALL   ?C?LMUL
01E1 8F00        R     MOV     handle_value+03H,R7
01E3 8E00        R     MOV     handle_value+02H,R6
01E5 8D00        R     MOV     handle_value+01H,R5
01E7 8C00        R     MOV     handle_value,R4
                                           ; SOURCE LINE # 522
01E9         ?C0056:
                                           ; SOURCE LINE # 525
01E9 900000      E     MOV     DPTR,#g_ref
01EC E0                MOVX    A,@DPTR
01ED F8                MOV     R0,A
01EE A3                INC     DPTR
01EF E0                MOVX    A,@DPTR
01F0 F9                MOV     R1,A
01F1 A3                INC     DPTR
01F2 E0                MOVX    A,@DPTR
01F3 FA                MOV     R2,A
01F4 A3                INC     DPTR
01F5 E0                MOVX    A,@DPTR
01F6 FB                MOV     R3,A
01F7 C3                CLR     C
01F8 E500        R     MOV     A,handle_value+03H
01FA 9B                SUBB    A,R3
01FB FF                MOV     R7,A
01FC E500        R     MOV     A,handle_value+02H
01FE 9A                SUBB    A,R2
01FF FE                MOV     R6,A
0200 E500        R     MOV     A,handle_value+01H
0202 99                SUBB    A,R1
0203 FD                MOV     R5,A
0204 E500        R     MOV     A,handle_value
0206 98                SUBB    A,R0
0207 FC                MOV     R4,A
0208 900000      E     MOV     DPTR,#c_mem+061H
020B E0                MOVX    A,@DPTR
020C F8                MOV     R0,A
020D A3                INC     DPTR
020E E0                MOVX    A,@DPTR
020F F9                MOV     R1,A
0210 A3                INC     DPTR
0211 E0                MOVX    A,@DPTR
0212 FA                MOV     R2,A
0213 A3                INC     DPTR
0214 E0                MOVX    A,@DPTR
0215 FB                MOV     R3,A
0216 C3                CLR     C
0217 120000      E     LCALL   ?C?SLCMP
021A 5044              JNC     ?C0059
021C E4                CLR     A
021D FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 45  

021E FE                MOV     R6,A
021F FD                MOV     R5,A
0220 FC                MOV     R4,A
0221 900000      E     MOV     DPTR,#c_mem+061H
0224 E0                MOVX    A,@DPTR
0225 F8                MOV     R0,A
0226 A3                INC     DPTR
0227 E0                MOVX    A,@DPTR
0228 A3                INC     DPTR
0229 E0                MOVX    A,@DPTR
022A A3                INC     DPTR
022B E0                MOVX    A,@DPTR
022C C3                CLR     C
022D 120000      E     LCALL   ?C?SLCMP
0230 602E              JZ      ?C0059
                                           ; SOURCE LINE # 526
0232 900000      E     MOV     DPTR,#g_ref
0235 E0                MOVX    A,@DPTR
0236 FC                MOV     R4,A
0237 A3                INC     DPTR
0238 E0                MOVX    A,@DPTR
0239 FD                MOV     R5,A
023A A3                INC     DPTR
023B E0                MOVX    A,@DPTR
023C FE                MOV     R6,A
023D A3                INC     DPTR
023E E0                MOVX    A,@DPTR
023F FF                MOV     R7,A
0240 900000      E     MOV     DPTR,#c_mem+061H
0243 E0                MOVX    A,@DPTR
0244 F8                MOV     R0,A
0245 A3                INC     DPTR
0246 E0                MOVX    A,@DPTR
0247 A3                INC     DPTR
0248 E0                MOVX    A,@DPTR
0249 A3                INC     DPTR
024A E0                MOVX    A,@DPTR
024B EF                MOV     A,R7
024C 2B                ADD     A,R3
024D FF                MOV     R7,A
024E EE                MOV     A,R6
024F 3A                ADDC    A,R2
0250 FE                MOV     R6,A
0251 ED                MOV     A,R5
0252 39                ADDC    A,R1
0253 FD                MOV     R5,A
0254 EC                MOV     A,R4
0255 38                ADDC    A,R0
0256 FC                MOV     R4,A
0257 900000      E     MOV     DPTR,#g_ref
025A 120000      E     LCALL   ?C?LSTXDATA
025D 020000      R     LJMP    ?C0053
0260         ?C0059:
                                           ; SOURCE LINE # 527
                                           ; SOURCE LINE # 528
0260 900000      E     MOV     DPTR,#g_ref
0263 E0                MOVX    A,@DPTR
0264 F8                MOV     R0,A
0265 A3                INC     DPTR
0266 E0                MOVX    A,@DPTR
0267 F9                MOV     R1,A
0268 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 46  

0269 E0                MOVX    A,@DPTR
026A FA                MOV     R2,A
026B A3                INC     DPTR
026C E0                MOVX    A,@DPTR
026D FB                MOV     R3,A
026E C3                CLR     C
026F E500        R     MOV     A,handle_value+03H
0271 9B                SUBB    A,R3
0272 FF                MOV     R7,A
0273 E500        R     MOV     A,handle_value+02H
0275 9A                SUBB    A,R2
0276 FE                MOV     R6,A
0277 E500        R     MOV     A,handle_value+01H
0279 99                SUBB    A,R1
027A FD                MOV     R5,A
027B E500        R     MOV     A,handle_value
027D 98                SUBB    A,R0
027E FC                MOV     R4,A
027F 900000      E     MOV     DPTR,#c_mem+065H
0282 E0                MOVX    A,@DPTR
0283 F8                MOV     R0,A
0284 A3                INC     DPTR
0285 E0                MOVX    A,@DPTR
0286 F9                MOV     R1,A
0287 A3                INC     DPTR
0288 E0                MOVX    A,@DPTR
0289 FA                MOV     R2,A
028A A3                INC     DPTR
028B E0                MOVX    A,@DPTR
028C FB                MOV     R3,A
028D D3                SETB    C
028E 120000      E     LCALL   ?C?SLCMP
0291 4043              JC      ?C0061
0293 E4                CLR     A
0294 FF                MOV     R7,A
0295 FE                MOV     R6,A
0296 FD                MOV     R5,A
0297 FC                MOV     R4,A
0298 900000      E     MOV     DPTR,#c_mem+065H
029B E0                MOVX    A,@DPTR
029C F8                MOV     R0,A
029D A3                INC     DPTR
029E E0                MOVX    A,@DPTR
029F A3                INC     DPTR
02A0 E0                MOVX    A,@DPTR
02A1 A3                INC     DPTR
02A2 E0                MOVX    A,@DPTR
02A3 120000      E     LCALL   ?C?SLCMP
02A6 602E              JZ      ?C0061
                                           ; SOURCE LINE # 529
02A8 900000      E     MOV     DPTR,#g_ref
02AB E0                MOVX    A,@DPTR
02AC FC                MOV     R4,A
02AD A3                INC     DPTR
02AE E0                MOVX    A,@DPTR
02AF FD                MOV     R5,A
02B0 A3                INC     DPTR
02B1 E0                MOVX    A,@DPTR
02B2 FE                MOV     R6,A
02B3 A3                INC     DPTR
02B4 E0                MOVX    A,@DPTR
02B5 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 47  

02B6 900000      E     MOV     DPTR,#c_mem+065H
02B9 E0                MOVX    A,@DPTR
02BA F8                MOV     R0,A
02BB A3                INC     DPTR
02BC E0                MOVX    A,@DPTR
02BD A3                INC     DPTR
02BE E0                MOVX    A,@DPTR
02BF A3                INC     DPTR
02C0 E0                MOVX    A,@DPTR
02C1 EF                MOV     A,R7
02C2 2B                ADD     A,R3
02C3 FF                MOV     R7,A
02C4 EE                MOV     A,R6
02C5 3A                ADDC    A,R2
02C6 FE                MOV     R6,A
02C7 ED                MOV     A,R5
02C8 39                ADDC    A,R1
02C9 FD                MOV     R5,A
02CA EC                MOV     A,R4
02CB 38                ADDC    A,R0
02CC FC                MOV     R4,A
02CD 900000      E     MOV     DPTR,#g_ref
02D0 120000      E     LCALL   ?C?LSTXDATA
02D3 020000      R     LJMP    ?C0053
02D6         ?C0061:
                                           ; SOURCE LINE # 531
02D6 AF00        R     MOV     R7,handle_value+03H
02D8 AE00        R     MOV     R6,handle_value+02H
02DA AD00        R     MOV     R5,handle_value+01H
02DC AC00        R     MOV     R4,handle_value
02DE 900000      E     MOV     DPTR,#g_ref
02E1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 532
                                           ; SOURCE LINE # 533
02E4 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 535
02E7         ?C0063:
                                           ; SOURCE LINE # 536
02E7 E4                CLR     A
02E8 FF                MOV     R7,A
02E9 FE                MOV     R6,A
02EA FD                MOV     R5,A
02EB FC                MOV     R4,A
02EC AB00        R     MOV     R3,err_emg_1+03H
02EE AA00        R     MOV     R2,err_emg_1+02H
02F0 A900        R     MOV     R1,err_emg_1+01H
02F2 A800        R     MOV     R0,err_emg_1
02F4 D3                SETB    C
02F5 120000      E     LCALL   ?C?SLCMP
02F8 403D              JC      ?C0064
                                           ; SOURCE LINE # 537
02FA 900000      E     MOV     DPTR,#g_mem+059H
02FD E0                MOVX    A,@DPTR
02FE FC                MOV     R4,A
02FF A3                INC     DPTR
0300 E0                MOVX    A,@DPTR
0301 FD                MOV     R5,A
0302 A3                INC     DPTR
0303 E0                MOVX    A,@DPTR
0304 FE                MOV     R6,A
0305 A3                INC     DPTR
0306 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 48  

0307 FF                MOV     R7,A
0308 A800        R     MOV     R0,err_emg_1
030A 120000      E     LCALL   ?C?LMUL
030D C006              PUSH    AR6
030F C007              PUSH    AR7
0311 900000      E     MOV     DPTR,#c_mem+06BH
0314 E0                MOVX    A,@DPTR
0315 FE                MOV     R6,A
0316 A3                INC     DPTR
0317 E0                MOVX    A,@DPTR
0318 FF                MOV     R7,A
0319 C3                CLR     C
031A E4                CLR     A
031B 9F                SUBB    A,R7
031C FF                MOV     R7,A
031D 7404              MOV     A,#04H
031F 9E                SUBB    A,R6
0320 FE                MOV     R6,A
0321 AB07              MOV     R3,AR7
0323 FA                MOV     R2,A
0324 E4                CLR     A
0325 F9                MOV     R1,A
0326 F8                MOV     R0,A
0327 D007              POP     AR7
0329 D006              POP     AR6
032B 120000      E     LCALL   ?C?SLDIV
032E 900000      E     MOV     DPTR,#g_ref
0331 120000      E     LCALL   ?C?LSTXDATA
0334 020000      R     LJMP    ?C0053
0337         ?C0064:
                                           ; SOURCE LINE # 539
0337 E4                CLR     A
0338 FF                MOV     R7,A
0339 FE                MOV     R6,A
033A FD                MOV     R5,A
033B FC                MOV     R4,A
033C 900000      E     MOV     DPTR,#g_ref
033F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 540
0342 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 542
0345         ?C0066:
                                           ; SOURCE LINE # 543
0345 900000      E     MOV     DPTR,#g_refOld
0348 E0                MOVX    A,@DPTR
0349 FC                MOV     R4,A
034A A3                INC     DPTR
034B E0                MOVX    A,@DPTR
034C FD                MOV     R5,A
034D A3                INC     DPTR
034E E0                MOVX    A,@DPTR
034F FE                MOV     R6,A
0350 A3                INC     DPTR
0351 E0                MOVX    A,@DPTR
0352 FF                MOV     R7,A
0353 900000      E     MOV     DPTR,#g_ref
0356 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 544
0359 E4                CLR     A
035A FF                MOV     R7,A
035B FE                MOV     R6,A
035C FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 49  

035D FC                MOV     R4,A
035E AB00        R     MOV     R3,err_emg_1+03H
0360 AA00        R     MOV     R2,err_emg_1+02H
0362 A900        R     MOV     R1,err_emg_1+01H
0364 A800        R     MOV     R0,err_emg_1
0366 D3                SETB    C
0367 120000      E     LCALL   ?C?SLCMP
036A 4056              JC      ?C0067
                                           ; SOURCE LINE # 545
036C 900000      E     MOV     DPTR,#g_mem+078H
036F E0                MOVX    A,@DPTR
0370 FF                MOV     R7,A
0371 E4                CLR     A
0372 FC                MOV     R4,A
0373 FD                MOV     R5,A
0374 FE                MOV     R6,A
0375 A800        R     MOV     R0,err_emg_1
0377 120000      E     LCALL   ?C?LMUL
037A E4                CLR     A
037B 7B02              MOV     R3,#02H
037D FA                MOV     R2,A
037E F9                MOV     R1,A
037F F8                MOV     R0,A
0380 120000      E     LCALL   ?C?LMUL
0383 C006              PUSH    AR6
0385 C007              PUSH    AR7
0387 900000      E     MOV     DPTR,#c_mem+06BH
038A E0                MOVX    A,@DPTR
038B FE                MOV     R6,A
038C A3                INC     DPTR
038D E0                MOVX    A,@DPTR
038E FF                MOV     R7,A
038F C3                CLR     C
0390 E4                CLR     A
0391 9F                SUBB    A,R7
0392 FF                MOV     R7,A
0393 7404              MOV     A,#04H
0395 9E                SUBB    A,R6
0396 FE                MOV     R6,A
0397 AB07              MOV     R3,AR7
0399 FA                MOV     R2,A
039A E4                CLR     A
039B F9                MOV     R1,A
039C F8                MOV     R0,A
039D D007              POP     AR7
039F D006              POP     AR6
03A1 120000      E     LCALL   ?C?SLDIV
03A4 900000      E     MOV     DPTR,#g_refOld
03A7 E0                MOVX    A,@DPTR
03A8 F8                MOV     R0,A
03A9 A3                INC     DPTR
03AA E0                MOVX    A,@DPTR
03AB F9                MOV     R1,A
03AC A3                INC     DPTR
03AD E0                MOVX    A,@DPTR
03AE FA                MOV     R2,A
03AF A3                INC     DPTR
03B0 E0                MOVX    A,@DPTR
03B1 2F                ADD     A,R7
03B2 FF                MOV     R7,A
03B3 EA                MOV     A,R2
03B4 3E                ADDC    A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 50  

03B5 FE                MOV     R6,A
03B6 E9                MOV     A,R1
03B7 3D                ADDC    A,R5
03B8 FD                MOV     R5,A
03B9 E8                MOV     A,R0
03BA 3C                ADDC    A,R4
03BB FC                MOV     R4,A
03BC 900000      E     MOV     DPTR,#g_ref
03BF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 546
03C2         ?C0067:
                                           ; SOURCE LINE # 547
03C2 E4                CLR     A
03C3 FF                MOV     R7,A
03C4 FE                MOV     R6,A
03C5 FD                MOV     R5,A
03C6 FC                MOV     R4,A
03C7 AB00        R     MOV     R3,err_emg_2+03H
03C9 AA00        R     MOV     R2,err_emg_2+02H
03CB A900        R     MOV     R1,err_emg_2+01H
03CD A800        R     MOV     R0,err_emg_2
03CF D3                SETB    C
03D0 120000      E     LCALL   ?C?SLCMP
03D3 5003              JNC     $ + 5H
03D5 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 548
03D8 900000      E     MOV     DPTR,#g_mem+078H
03DB E0                MOVX    A,@DPTR
03DC FF                MOV     R7,A
03DD E4                CLR     A
03DE FC                MOV     R4,A
03DF FD                MOV     R5,A
03E0 FE                MOV     R6,A
03E1 A800        R     MOV     R0,err_emg_2
03E3 120000      E     LCALL   ?C?LMUL
03E6 E4                CLR     A
03E7 7B02              MOV     R3,#02H
03E9 FA                MOV     R2,A
03EA F9                MOV     R1,A
03EB F8                MOV     R0,A
03EC 120000      E     LCALL   ?C?LMUL
03EF C006              PUSH    AR6
03F1 C007              PUSH    AR7
03F3 900000      E     MOV     DPTR,#c_mem+06DH
03F6 E0                MOVX    A,@DPTR
03F7 FE                MOV     R6,A
03F8 A3                INC     DPTR
03F9 E0                MOVX    A,@DPTR
03FA FF                MOV     R7,A
03FB C3                CLR     C
03FC E4                CLR     A
03FD 9F                SUBB    A,R7
03FE FF                MOV     R7,A
03FF 7404              MOV     A,#04H
0401 9E                SUBB    A,R6
0402 FE                MOV     R6,A
0403 AB07              MOV     R3,AR7
0405 FA                MOV     R2,A
0406 E4                CLR     A
0407 F9                MOV     R1,A
0408 F8                MOV     R0,A
0409 D007              POP     AR7
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 51  

040B D006              POP     AR6
040D 120000      E     LCALL   ?C?SLDIV
0410 A804              MOV     R0,AR4
0412 A905              MOV     R1,AR5
0414 AA06              MOV     R2,AR6
0416 AB07              MOV     R3,AR7
0418 900000      E     MOV     DPTR,#g_refOld
041B E0                MOVX    A,@DPTR
041C FC                MOV     R4,A
041D A3                INC     DPTR
041E E0                MOVX    A,@DPTR
041F FD                MOV     R5,A
0420 A3                INC     DPTR
0421 E0                MOVX    A,@DPTR
0422 FE                MOV     R6,A
0423 A3                INC     DPTR
0424 E0                MOVX    A,@DPTR
0425 C3                CLR     C
0426 9B                SUBB    A,R3
0427 FF                MOV     R7,A
0428 EE                MOV     A,R6
0429 9A                SUBB    A,R2
042A FE                MOV     R6,A
042B ED                MOV     A,R5
042C 99                SUBB    A,R1
042D FD                MOV     R5,A
042E EC                MOV     A,R4
042F 98                SUBB    A,R0
0430 FC                MOV     R4,A
0431 900000      E     MOV     DPTR,#g_ref
0434 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 549
                                           ; SOURCE LINE # 550
0437 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 552
043A         ?C0069:
                                           ; SOURCE LINE # 553
043A 900000      E     MOV     DPTR,#g_refOld
043D E0                MOVX    A,@DPTR
043E FC                MOV     R4,A
043F A3                INC     DPTR
0440 E0                MOVX    A,@DPTR
0441 FD                MOV     R5,A
0442 A3                INC     DPTR
0443 E0                MOVX    A,@DPTR
0444 FE                MOV     R6,A
0445 A3                INC     DPTR
0446 E0                MOVX    A,@DPTR
0447 FF                MOV     R7,A
0448 900000      E     MOV     DPTR,#g_ref
044B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 554
044E 900000      R     MOV     DPTR,#current_emg
0451 E0                MOVX    A,@DPTR
0452 14                DEC     A
0453 6048              JZ      ?C0074
0455 14                DEC     A
0456 7003              JNZ     $ + 5H
0458 020000      R     LJMP    ?C0076
045B 2402              ADD     A,#02H
045D 6003              JZ      $ + 5H
045F 020000      R     LJMP    ?C0053
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 52  

                                           ; SOURCE LINE # 555
0462         ?C0071:
                                           ; SOURCE LINE # 557
0462 E4                CLR     A
0463 FF                MOV     R7,A
0464 FE                MOV     R6,A
0465 FD                MOV     R5,A
0466 FC                MOV     R4,A
0467 AB00        R     MOV     R3,err_emg_1+03H
0469 AA00        R     MOV     R2,err_emg_1+02H
046B A900        R     MOV     R1,err_emg_1+01H
046D A800        R     MOV     R0,err_emg_1
046F D3                SETB    C
0470 120000      E     LCALL   ?C?SLCMP
0473 4009              JC      ?C0072
                                           ; SOURCE LINE # 558
0475 900000      R     MOV     DPTR,#current_emg
0478 7401              MOV     A,#01H
047A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 559
047B 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 560
047E         ?C0072:
                                           ; SOURCE LINE # 561
047E E4                CLR     A
047F FF                MOV     R7,A
0480 FE                MOV     R6,A
0481 FD                MOV     R5,A
0482 FC                MOV     R4,A
0483 AB00        R     MOV     R3,err_emg_2+03H
0485 AA00        R     MOV     R2,err_emg_2+02H
0487 A900        R     MOV     R1,err_emg_2+01H
0489 A800        R     MOV     R0,err_emg_2
048B D3                SETB    C
048C 120000      E     LCALL   ?C?SLCMP
048F 5003              JNC     $ + 5H
0491 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 562
0494 900000      R     MOV     DPTR,#current_emg
0497 7402              MOV     A,#02H
0499 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 563
049A 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 564
                                           ; SOURCE LINE # 565
                                           ; SOURCE LINE # 567
049D         ?C0074:
                                           ; SOURCE LINE # 569
049D E4                CLR     A
049E FF                MOV     R7,A
049F FE                MOV     R6,A
04A0 FD                MOV     R5,A
04A1 FC                MOV     R4,A
04A2 AB00        R     MOV     R3,err_emg_1+03H
04A4 AA00        R     MOV     R2,err_emg_1+02H
04A6 A900        R     MOV     R1,err_emg_1+01H
04A8 A800        R     MOV     R0,err_emg_1
04AA C3                CLR     C
04AB 120000      E     LCALL   ?C?SLCMP
04AE 5008              JNC     ?C0075
                                           ; SOURCE LINE # 570
04B0 E4                CLR     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 53  

04B1 900000      R     MOV     DPTR,#current_emg
04B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 571
04B5 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 572
04B8         ?C0075:
                                           ; SOURCE LINE # 573
04B8 900000      E     MOV     DPTR,#g_mem+078H
04BB E0                MOVX    A,@DPTR
04BC FF                MOV     R7,A
04BD E4                CLR     A
04BE FC                MOV     R4,A
04BF FD                MOV     R5,A
04C0 FE                MOV     R6,A
04C1 AB00        R     MOV     R3,err_emg_1+03H
04C3 AA00        R     MOV     R2,err_emg_1+02H
04C5 A900        R     MOV     R1,err_emg_1+01H
04C7 A800        R     MOV     R0,err_emg_1
04C9 120000      E     LCALL   ?C?LMUL
04CC E4                CLR     A
04CD 7B02              MOV     R3,#02H
04CF FA                MOV     R2,A
04D0 F9                MOV     R1,A
04D1 F8                MOV     R0,A
04D2 120000      E     LCALL   ?C?LMUL
04D5 C006              PUSH    AR6
04D7 C007              PUSH    AR7
04D9 900000      E     MOV     DPTR,#c_mem+06BH
04DC E0                MOVX    A,@DPTR
04DD FE                MOV     R6,A
04DE A3                INC     DPTR
04DF E0                MOVX    A,@DPTR
04E0 FF                MOV     R7,A
04E1 C3                CLR     C
04E2 E4                CLR     A
04E3 9F                SUBB    A,R7
04E4 FF                MOV     R7,A
04E5 7404              MOV     A,#04H
04E7 9E                SUBB    A,R6
04E8 FE                MOV     R6,A
04E9 AB07              MOV     R3,AR7
04EB FA                MOV     R2,A
04EC E4                CLR     A
04ED F9                MOV     R1,A
04EE F8                MOV     R0,A
04EF D007              POP     AR7
04F1 D006              POP     AR6
04F3 120000      E     LCALL   ?C?SLDIV
04F6 900000      E     MOV     DPTR,#g_refOld
04F9 E0                MOVX    A,@DPTR
04FA F8                MOV     R0,A
04FB A3                INC     DPTR
04FC E0                MOVX    A,@DPTR
04FD F9                MOV     R1,A
04FE A3                INC     DPTR
04FF E0                MOVX    A,@DPTR
0500 FA                MOV     R2,A
0501 A3                INC     DPTR
0502 E0                MOVX    A,@DPTR
0503 2F                ADD     A,R7
0504 FF                MOV     R7,A
0505 EA                MOV     A,R2
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 54  

0506 3E                ADDC    A,R6
0507 FE                MOV     R6,A
0508 E9                MOV     A,R1
0509 3D                ADDC    A,R5
050A FD                MOV     R5,A
050B E8                MOV     A,R0
050C 3C                ADDC    A,R4
050D FC                MOV     R4,A
050E 900000      E     MOV     DPTR,#g_ref
0511 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 574
0514 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 576
0517         ?C0076:
                                           ; SOURCE LINE # 578
0517 E4                CLR     A
0518 FF                MOV     R7,A
0519 FE                MOV     R6,A
051A FD                MOV     R5,A
051B FC                MOV     R4,A
051C AB00        R     MOV     R3,err_emg_2+03H
051E AA00        R     MOV     R2,err_emg_2+02H
0520 A900        R     MOV     R1,err_emg_2+01H
0522 A800        R     MOV     R0,err_emg_2
0524 C3                CLR     C
0525 120000      E     LCALL   ?C?SLCMP
0528 5008              JNC     ?C0077
                                           ; SOURCE LINE # 579
052A E4                CLR     A
052B 900000      R     MOV     DPTR,#current_emg
052E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 580
052F 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 581
0532         ?C0077:
                                           ; SOURCE LINE # 582
0532 900000      E     MOV     DPTR,#g_mem+078H
0535 E0                MOVX    A,@DPTR
0536 FF                MOV     R7,A
0537 E4                CLR     A
0538 FC                MOV     R4,A
0539 FD                MOV     R5,A
053A FE                MOV     R6,A
053B AB00        R     MOV     R3,err_emg_2+03H
053D AA00        R     MOV     R2,err_emg_2+02H
053F A900        R     MOV     R1,err_emg_2+01H
0541 A800        R     MOV     R0,err_emg_2
0543 120000      E     LCALL   ?C?LMUL
0546 E4                CLR     A
0547 7B02              MOV     R3,#02H
0549 FA                MOV     R2,A
054A F9                MOV     R1,A
054B F8                MOV     R0,A
054C 120000      E     LCALL   ?C?LMUL
054F C006              PUSH    AR6
0551 C007              PUSH    AR7
0553 900000      E     MOV     DPTR,#c_mem+06DH
0556 E0                MOVX    A,@DPTR
0557 FE                MOV     R6,A
0558 A3                INC     DPTR
0559 E0                MOVX    A,@DPTR
055A FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 55  

055B C3                CLR     C
055C E4                CLR     A
055D 9F                SUBB    A,R7
055E FF                MOV     R7,A
055F 7404              MOV     A,#04H
0561 9E                SUBB    A,R6
0562 FE                MOV     R6,A
0563 AB07              MOV     R3,AR7
0565 FA                MOV     R2,A
0566 E4                CLR     A
0567 F9                MOV     R1,A
0568 F8                MOV     R0,A
0569 D007              POP     AR7
056B D006              POP     AR6
056D 120000      E     LCALL   ?C?SLDIV
0570 A804              MOV     R0,AR4
0572 A905              MOV     R1,AR5
0574 AA06              MOV     R2,AR6
0576 AB07              MOV     R3,AR7
0578 900000      E     MOV     DPTR,#g_refOld
057B E0                MOVX    A,@DPTR
057C FC                MOV     R4,A
057D A3                INC     DPTR
057E E0                MOVX    A,@DPTR
057F FD                MOV     R5,A
0580 A3                INC     DPTR
0581 E0                MOVX    A,@DPTR
0582 FE                MOV     R6,A
0583 A3                INC     DPTR
0584 E0                MOVX    A,@DPTR
0585 C3                CLR     C
0586 9B                SUBB    A,R3
0587 FF                MOV     R7,A
0588 EE                MOV     A,R6
0589 9A                SUBB    A,R2
058A FE                MOV     R6,A
058B ED                MOV     A,R5
058C 99                SUBB    A,R1
058D FD                MOV     R5,A
058E EC                MOV     A,R4
058F 98                SUBB    A,R0
0590 FC                MOV     R4,A
0591 900000      E     MOV     DPTR,#g_ref
0594 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 583
0597 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 585
                                           ; SOURCE LINE # 586
                                           ; SOURCE LINE # 587
                                           ; SOURCE LINE # 589
059A 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 591
059D         ?C0079:
                                           ; SOURCE LINE # 592
059D 900000      E     MOV     DPTR,#g_refOld
05A0 E0                MOVX    A,@DPTR
05A1 FC                MOV     R4,A
05A2 A3                INC     DPTR
05A3 E0                MOVX    A,@DPTR
05A4 FD                MOV     R5,A
05A5 A3                INC     DPTR
05A6 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 56  

05A7 FE                MOV     R6,A
05A8 A3                INC     DPTR
05A9 E0                MOVX    A,@DPTR
05AA FF                MOV     R7,A
05AB 900000      E     MOV     DPTR,#g_ref
05AE 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 593
05B1 900000      R     MOV     DPTR,#current_emg
05B4 E0                MOVX    A,@DPTR
05B5 14                DEC     A
05B6 6048              JZ      ?C0084
05B8 14                DEC     A
05B9 7003              JNZ     $ + 5H
05BB 020000      R     LJMP    ?C0087
05BE 2402              ADD     A,#02H
05C0 6003              JZ      $ + 5H
05C2 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 595
05C5         ?C0081:
                                           ; SOURCE LINE # 596
05C5 E4                CLR     A
05C6 FF                MOV     R7,A
05C7 FE                MOV     R6,A
05C8 FD                MOV     R5,A
05C9 FC                MOV     R4,A
05CA AB00        R     MOV     R3,err_emg_1+03H
05CC AA00        R     MOV     R2,err_emg_1+02H
05CE A900        R     MOV     R1,err_emg_1+01H
05D0 A800        R     MOV     R0,err_emg_1
05D2 D3                SETB    C
05D3 120000      E     LCALL   ?C?SLCMP
05D6 4009              JC      ?C0082
                                           ; SOURCE LINE # 597
05D8 900000      R     MOV     DPTR,#current_emg
05DB 7401              MOV     A,#01H
05DD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 598
05DE 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 599
05E1         ?C0082:
                                           ; SOURCE LINE # 600
05E1 E4                CLR     A
05E2 FF                MOV     R7,A
05E3 FE                MOV     R6,A
05E4 FD                MOV     R5,A
05E5 FC                MOV     R4,A
05E6 AB00        R     MOV     R3,err_emg_2+03H
05E8 AA00        R     MOV     R2,err_emg_2+02H
05EA A900        R     MOV     R1,err_emg_2+01H
05EC A800        R     MOV     R0,err_emg_2
05EE D3                SETB    C
05EF 120000      E     LCALL   ?C?SLCMP
05F2 5003              JNC     $ + 5H
05F4 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 601
05F7 900000      R     MOV     DPTR,#current_emg
05FA 7402              MOV     A,#02H
05FC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 602
05FD 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 603
                                           ; SOURCE LINE # 604
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 57  

                                           ; SOURCE LINE # 607
0600         ?C0084:
                                           ; SOURCE LINE # 609
0600 E4                CLR     A
0601 FF                MOV     R7,A
0602 FE                MOV     R6,A
0603 FD                MOV     R5,A
0604 FC                MOV     R4,A
0605 AB00        R     MOV     R3,err_emg_1+03H
0607 AA00        R     MOV     R2,err_emg_1+02H
0609 A900        R     MOV     R1,err_emg_1+01H
060B A800        R     MOV     R0,err_emg_1
060D C3                CLR     C
060E 120000      E     LCALL   ?C?SLCMP
0611 501B              JNC     ?C0085
0613 E4                CLR     A
0614 FF                MOV     R7,A
0615 FE                MOV     R6,A
0616 FD                MOV     R5,A
0617 FC                MOV     R4,A
0618 AB00        R     MOV     R3,err_emg_2+03H
061A AA00        R     MOV     R2,err_emg_2+02H
061C A900        R     MOV     R1,err_emg_2+01H
061E A800        R     MOV     R0,err_emg_2
0620 C3                CLR     C
0621 120000      E     LCALL   ?C?SLCMP
0624 5008              JNC     ?C0085
                                           ; SOURCE LINE # 610
0626 E4                CLR     A
0627 900000      R     MOV     DPTR,#current_emg
062A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 611
062B 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 612
062E         ?C0085:
                                           ; SOURCE LINE # 614
062E E4                CLR     A
062F FF                MOV     R7,A
0630 FE                MOV     R6,A
0631 FD                MOV     R5,A
0632 FC                MOV     R4,A
0633 AB00        R     MOV     R3,err_emg_1+03H
0635 AA00        R     MOV     R2,err_emg_1+02H
0637 A900        R     MOV     R1,err_emg_1+01H
0639 A800        R     MOV     R0,err_emg_1
063B D3                SETB    C
063C 120000      E     LCALL   ?C?SLCMP
063F 5003              JNC     $ + 5H
0641 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 615
0644 900000      E     MOV     DPTR,#g_mem+078H
0647 E0                MOVX    A,@DPTR
0648 FF                MOV     R7,A
0649 E4                CLR     A
064A FC                MOV     R4,A
064B FD                MOV     R5,A
064C FE                MOV     R6,A
064D A800        R     MOV     R0,err_emg_1
064F 120000      E     LCALL   ?C?LMUL
0652 7802              MOV     R0,#02H
0654 120000      E     LCALL   ?C?LSHL
0657 C006              PUSH    AR6
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 58  

0659 C007              PUSH    AR7
065B 900000      E     MOV     DPTR,#c_mem+06BH
065E E0                MOVX    A,@DPTR
065F FE                MOV     R6,A
0660 A3                INC     DPTR
0661 E0                MOVX    A,@DPTR
0662 FF                MOV     R7,A
0663 C3                CLR     C
0664 E4                CLR     A
0665 9F                SUBB    A,R7
0666 FF                MOV     R7,A
0667 7404              MOV     A,#04H
0669 9E                SUBB    A,R6
066A FE                MOV     R6,A
066B AB07              MOV     R3,AR7
066D FA                MOV     R2,A
066E E4                CLR     A
066F F9                MOV     R1,A
0670 F8                MOV     R0,A
0671 D007              POP     AR7
0673 D006              POP     AR6
0675 120000      E     LCALL   ?C?SLDIV
0678 900000      E     MOV     DPTR,#g_refOld
067B E0                MOVX    A,@DPTR
067C F8                MOV     R0,A
067D A3                INC     DPTR
067E E0                MOVX    A,@DPTR
067F F9                MOV     R1,A
0680 A3                INC     DPTR
0681 E0                MOVX    A,@DPTR
0682 FA                MOV     R2,A
0683 A3                INC     DPTR
0684 E0                MOVX    A,@DPTR
0685 2F                ADD     A,R7
0686 FF                MOV     R7,A
0687 EA                MOV     A,R2
0688 3E                ADDC    A,R6
0689 FE                MOV     R6,A
068A E9                MOV     A,R1
068B 3D                ADDC    A,R5
068C FD                MOV     R5,A
068D E8                MOV     A,R0
068E 3C                ADDC    A,R4
068F FC                MOV     R4,A
0690 900000      E     MOV     DPTR,#g_ref
0693 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 617
0696 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 620
0699         ?C0087:
                                           ; SOURCE LINE # 622
0699 E4                CLR     A
069A FF                MOV     R7,A
069B FE                MOV     R6,A
069C FD                MOV     R5,A
069D FC                MOV     R4,A
069E AB00        R     MOV     R3,err_emg_1+03H
06A0 AA00        R     MOV     R2,err_emg_1+02H
06A2 A900        R     MOV     R1,err_emg_1+01H
06A4 A800        R     MOV     R0,err_emg_1
06A6 C3                CLR     C
06A7 120000      E     LCALL   ?C?SLCMP
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 59  

06AA 501B              JNC     ?C0088
06AC E4                CLR     A
06AD FF                MOV     R7,A
06AE FE                MOV     R6,A
06AF FD                MOV     R5,A
06B0 FC                MOV     R4,A
06B1 AB00        R     MOV     R3,err_emg_2+03H
06B3 AA00        R     MOV     R2,err_emg_2+02H
06B5 A900        R     MOV     R1,err_emg_2+01H
06B7 A800        R     MOV     R0,err_emg_2
06B9 C3                CLR     C
06BA 120000      E     LCALL   ?C?SLCMP
06BD 5008              JNC     ?C0088
                                           ; SOURCE LINE # 623
06BF E4                CLR     A
06C0 900000      R     MOV     DPTR,#current_emg
06C3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 624
06C4 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 625
06C7         ?C0088:
                                           ; SOURCE LINE # 627
06C7 E4                CLR     A
06C8 FF                MOV     R7,A
06C9 FE                MOV     R6,A
06CA FD                MOV     R5,A
06CB FC                MOV     R4,A
06CC AB00        R     MOV     R3,err_emg_2+03H
06CE AA00        R     MOV     R2,err_emg_2+02H
06D0 A900        R     MOV     R1,err_emg_2+01H
06D2 A800        R     MOV     R0,err_emg_2
06D4 D3                SETB    C
06D5 120000      E     LCALL   ?C?SLCMP
06D8 5003              JNC     $ + 5H
06DA 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 628
06DD 900000      E     MOV     DPTR,#c_mem+078H
06E0 E0                MOVX    A,@DPTR
06E1 FF                MOV     R7,A
06E2 E4                CLR     A
06E3 FC                MOV     R4,A
06E4 FD                MOV     R5,A
06E5 FE                MOV     R6,A
06E6 A800        R     MOV     R0,err_emg_2
06E8 120000      E     LCALL   ?C?LMUL
06EB 7802              MOV     R0,#02H
06ED 120000      E     LCALL   ?C?LSHL
06F0 C006              PUSH    AR6
06F2 C007              PUSH    AR7
06F4 900000      E     MOV     DPTR,#c_mem+06DH
06F7 E0                MOVX    A,@DPTR
06F8 FE                MOV     R6,A
06F9 A3                INC     DPTR
06FA E0                MOVX    A,@DPTR
06FB FF                MOV     R7,A
06FC C3                CLR     C
06FD E4                CLR     A
06FE 9F                SUBB    A,R7
06FF FF                MOV     R7,A
0700 7404              MOV     A,#04H
0702 9E                SUBB    A,R6
0703 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 60  

0704 AB07              MOV     R3,AR7
0706 FA                MOV     R2,A
0707 E4                CLR     A
0708 F9                MOV     R1,A
0709 F8                MOV     R0,A
070A D007              POP     AR7
070C D006              POP     AR6
070E 120000      E     LCALL   ?C?SLDIV
0711 A804              MOV     R0,AR4
0713 A905              MOV     R1,AR5
0715 AA06              MOV     R2,AR6
0717 AB07              MOV     R3,AR7
0719 900000      E     MOV     DPTR,#g_refOld
071C E0                MOVX    A,@DPTR
071D FC                MOV     R4,A
071E A3                INC     DPTR
071F E0                MOVX    A,@DPTR
0720 FD                MOV     R5,A
0721 A3                INC     DPTR
0722 E0                MOVX    A,@DPTR
0723 FE                MOV     R6,A
0724 A3                INC     DPTR
0725 E0                MOVX    A,@DPTR
0726 C3                CLR     C
0727 9B                SUBB    A,R3
0728 FF                MOV     R7,A
0729 EE                MOV     A,R6
072A 9A                SUBB    A,R2
072B FE                MOV     R6,A
072C ED                MOV     A,R5
072D 99                SUBB    A,R1
072E FD                MOV     R5,A
072F EC                MOV     A,R4
0730 98                SUBB    A,R0
0731 FC                MOV     R4,A
0732 900000      E     MOV     DPTR,#g_ref
0735 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 629
                                           ; SOURCE LINE # 630
0738 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 632
                                           ; SOURCE LINE # 633
                                           ; SOURCE LINE # 634
                                           ; SOURCE LINE # 636
073B 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 638
073E         ?C0091:
                                           ; SOURCE LINE # 640
073E 900000      E     MOV     DPTR,#c_mem+0BFH
0741 E0                MOVX    A,@DPTR
0742 FC                MOV     R4,A
0743 A3                INC     DPTR
0744 E0                MOVX    A,@DPTR
0745 FD                MOV     R5,A
0746 E4                CLR     A
0747 120000      E     LCALL   ?C?FCASTI
074A E4                CLR     A
074B FB                MOV     R3,A
074C FA                MOV     R2,A
074D F9                MOV     R1,A
074E 7840              MOV     R0,#040H
0750 120000      E     LCALL   ?C?FPDIV
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 61  

0753 C004              PUSH    AR4
0755 C005              PUSH    AR5
0757 C006              PUSH    AR6
0759 C007              PUSH    AR7
075B 900000      E     MOV     DPTR,#g_meas+037H
075E E0                MOVX    A,@DPTR
075F FC                MOV     R4,A
0760 A3                INC     DPTR
0761 E0                MOVX    A,@DPTR
0762 FD                MOV     R5,A
0763 EC                MOV     A,R4
0764 120000      E     LCALL   ?C?FCASTI
0767 D003              POP     AR3
0769 D002              POP     AR2
076B D001              POP     AR1
076D D000              POP     AR0
076F 120000      E     LCALL   ?C?FPDIV
0772 8F00        R     MOV     joy_perc+03H,R7
0774 8E00        R     MOV     joy_perc+02H,R6
0776 8D00        R     MOV     joy_perc+01H,R5
0778 8C00        R     MOV     joy_perc,R4
                                           ; SOURCE LINE # 641
077A 900000      E     MOV     DPTR,#c_mem+0BDH
077D E0                MOVX    A,@DPTR
077E FC                MOV     R4,A
077F A3                INC     DPTR
0780 E0                MOVX    A,@DPTR
0781 FD                MOV     R5,A
0782 E4                CLR     A
0783 120000      E     LCALL   ?C?FCASTI
0786 AB00        R     MOV     R3,joy_perc+03H
0788 AA00        R     MOV     R2,joy_perc+02H
078A A900        R     MOV     R1,joy_perc+01H
078C A800        R     MOV     R0,joy_perc
078E 120000      E     LCALL   ?C?FPMUL
0791 C004              PUSH    AR4
0793 C005              PUSH    AR5
0795 C006              PUSH    AR6
0797 C007              PUSH    AR7
0799 900000      E     MOV     DPTR,#g_refOld
079C E0                MOVX    A,@DPTR
079D FC                MOV     R4,A
079E A3                INC     DPTR
079F E0                MOVX    A,@DPTR
07A0 FD                MOV     R5,A
07A1 A3                INC     DPTR
07A2 E0                MOVX    A,@DPTR
07A3 FE                MOV     R6,A
07A4 A3                INC     DPTR
07A5 E0                MOVX    A,@DPTR
07A6 FF                MOV     R7,A
07A7 EC                MOV     A,R4
07A8 120000      E     LCALL   ?C?FCASTL
07AB D003              POP     AR3
07AD D002              POP     AR2
07AF D001              POP     AR1
07B1 D000              POP     AR0
07B3 120000      E     LCALL   ?C?FPADD
07B6 120000      E     LCALL   ?C?CASTF
07B9 900000      E     MOV     DPTR,#g_ref
07BC 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 643
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 62  

                                           ; SOURCE LINE # 644
                                           ; SOURCE LINE # 645
                                           ; SOURCE LINE # 646
07BF         ?C0053:
                                           ; SOURCE LINE # 649
07BF 900000      E     MOV     DPTR,#c_mem+050H
07C2 E0                MOVX    A,@DPTR
07C3 606A              JZ      ?C0093
                                           ; SOURCE LINE # 650
07C5 A3                INC     DPTR
07C6 E0                MOVX    A,@DPTR
07C7 FC                MOV     R4,A
07C8 A3                INC     DPTR
07C9 E0                MOVX    A,@DPTR
07CA FD                MOV     R5,A
07CB A3                INC     DPTR
07CC E0                MOVX    A,@DPTR
07CD FE                MOV     R6,A
07CE A3                INC     DPTR
07CF E0                MOVX    A,@DPTR
07D0 FF                MOV     R7,A
07D1 900000      E     MOV     DPTR,#g_ref
07D4 E0                MOVX    A,@DPTR
07D5 F8                MOV     R0,A
07D6 A3                INC     DPTR
07D7 E0                MOVX    A,@DPTR
07D8 F9                MOV     R1,A
07D9 A3                INC     DPTR
07DA E0                MOVX    A,@DPTR
07DB FA                MOV     R2,A
07DC A3                INC     DPTR
07DD E0                MOVX    A,@DPTR
07DE FB                MOV     R3,A
07DF C3                CLR     C
07E0 120000      E     LCALL   ?C?SLCMP
07E3 5014              JNC     ?C0094
                                           ; SOURCE LINE # 651
07E5 900000      E     MOV     DPTR,#c_mem+051H
07E8 E0                MOVX    A,@DPTR
07E9 FC                MOV     R4,A
07EA A3                INC     DPTR
07EB E0                MOVX    A,@DPTR
07EC FD                MOV     R5,A
07ED A3                INC     DPTR
07EE E0                MOVX    A,@DPTR
07EF FE                MOV     R6,A
07F0 A3                INC     DPTR
07F1 E0                MOVX    A,@DPTR
07F2 FF                MOV     R7,A
07F3 900000      E     MOV     DPTR,#g_ref
07F6 120000      E     LCALL   ?C?LSTXDATA
07F9         ?C0094:
                                           ; SOURCE LINE # 652
07F9 900000      E     MOV     DPTR,#c_mem+059H
07FC E0                MOVX    A,@DPTR
07FD FC                MOV     R4,A
07FE A3                INC     DPTR
07FF E0                MOVX    A,@DPTR
0800 FD                MOV     R5,A
0801 A3                INC     DPTR
0802 E0                MOVX    A,@DPTR
0803 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 63  

0804 A3                INC     DPTR
0805 E0                MOVX    A,@DPTR
0806 FF                MOV     R7,A
0807 900000      E     MOV     DPTR,#g_ref
080A E0                MOVX    A,@DPTR
080B F8                MOV     R0,A
080C A3                INC     DPTR
080D E0                MOVX    A,@DPTR
080E F9                MOV     R1,A
080F A3                INC     DPTR
0810 E0                MOVX    A,@DPTR
0811 FA                MOV     R2,A
0812 A3                INC     DPTR
0813 E0                MOVX    A,@DPTR
0814 FB                MOV     R3,A
0815 D3                SETB    C
0816 120000      E     LCALL   ?C?SLCMP
0819 4014              JC      ?C0093
                                           ; SOURCE LINE # 653
081B 900000      E     MOV     DPTR,#c_mem+059H
081E E0                MOVX    A,@DPTR
081F FC                MOV     R4,A
0820 A3                INC     DPTR
0821 E0                MOVX    A,@DPTR
0822 FD                MOV     R5,A
0823 A3                INC     DPTR
0824 E0                MOVX    A,@DPTR
0825 FE                MOV     R6,A
0826 A3                INC     DPTR
0827 E0                MOVX    A,@DPTR
0828 FF                MOV     R7,A
0829 900000      E     MOV     DPTR,#g_ref
082C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 654
082F         ?C0093:
                                           ; SOURCE LINE # 656
082F 900000      E     MOV     DPTR,#c_mem+096H
0832 E0                MOVX    A,@DPTR
0833 6401              XRL     A,#01H
0835 6003              JZ      $ + 5H
0837 020000      R     LJMP    ?C0096
                                           ; SOURCE LINE # 657
083A 900000      E     MOV     DPTR,#rest_enabled
083D E0                MOVX    A,@DPTR
083E B40114            CJNE    A,#01H,?C0097
                                           ; SOURCE LINE # 659
0841 900000      E     MOV     DPTR,#rest_pos_curr_ref
0844 E0                MOVX    A,@DPTR
0845 FC                MOV     R4,A
0846 A3                INC     DPTR
0847 E0                MOVX    A,@DPTR
0848 FD                MOV     R5,A
0849 A3                INC     DPTR
084A E0                MOVX    A,@DPTR
084B FE                MOV     R6,A
084C A3                INC     DPTR
084D E0                MOVX    A,@DPTR
084E FF                MOV     R7,A
084F 900000      E     MOV     DPTR,#g_ref
0852 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 660
0855         ?C0097:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 64  

                                           ; SOURCE LINE # 662
0855 900000      E     MOV     DPTR,#forced_open
0858 E0                MOVX    A,@DPTR
0859 6401              XRL     A,#01H
085B 6003              JZ      $ + 5H
085D 020000      R     LJMP    ?C0096
                                           ; SOURCE LINE # 664
0860 FF                MOV     R7,A
0861 FE                MOV     R6,A
0862 FD                MOV     R5,A
0863 FC                MOV     R4,A
0864 AB00        R     MOV     R3,err_emg_2+03H
0866 AA00        R     MOV     R2,err_emg_2+02H
0868 A900        R     MOV     R1,err_emg_2+01H
086A A800        R     MOV     R0,err_emg_2
086C D3                SETB    C
086D 120000      E     LCALL   ?C?SLCMP
0870 405D              JC      ?C0099
                                           ; SOURCE LINE # 665
0872 900000      E     MOV     DPTR,#g_mem+097H
0875 E0                MOVX    A,@DPTR
0876 FC                MOV     R4,A
0877 A3                INC     DPTR
0878 E0                MOVX    A,@DPTR
0879 FD                MOV     R5,A
087A A3                INC     DPTR
087B E0                MOVX    A,@DPTR
087C FE                MOV     R6,A
087D A3                INC     DPTR
087E E0                MOVX    A,@DPTR
087F FF                MOV     R7,A
0880 A800        R     MOV     R0,err_emg_2
0882 120000      E     LCALL   ?C?LMUL
0885 C006              PUSH    AR6
0887 C007              PUSH    AR7
0889 900000      E     MOV     DPTR,#c_mem+06DH
088C E0                MOVX    A,@DPTR
088D FE                MOV     R6,A
088E A3                INC     DPTR
088F E0                MOVX    A,@DPTR
0890 FF                MOV     R7,A
0891 C3                CLR     C
0892 E4                CLR     A
0893 9F                SUBB    A,R7
0894 FF                MOV     R7,A
0895 7404              MOV     A,#04H
0897 9E                SUBB    A,R6
0898 FE                MOV     R6,A
0899 AB07              MOV     R3,AR7
089B FA                MOV     R2,A
089C E4                CLR     A
089D F9                MOV     R1,A
089E F8                MOV     R0,A
089F D007              POP     AR7
08A1 D006              POP     AR6
08A3 120000      E     LCALL   ?C?SLDIV
08A6 A804              MOV     R0,AR4
08A8 A905              MOV     R1,AR5
08AA AA06              MOV     R2,AR6
08AC AB07              MOV     R3,AR7
08AE 900000      E     MOV     DPTR,#g_mem+097H
08B1 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 65  

08B2 FC                MOV     R4,A
08B3 A3                INC     DPTR
08B4 E0                MOVX    A,@DPTR
08B5 FD                MOV     R5,A
08B6 A3                INC     DPTR
08B7 E0                MOVX    A,@DPTR
08B8 FE                MOV     R6,A
08B9 A3                INC     DPTR
08BA E0                MOVX    A,@DPTR
08BB C3                CLR     C
08BC 9B                SUBB    A,R3
08BD FF                MOV     R7,A
08BE EE                MOV     A,R6
08BF 9A                SUBB    A,R2
08C0 FE                MOV     R6,A
08C1 ED                MOV     A,R5
08C2 99                SUBB    A,R1
08C3 FD                MOV     R5,A
08C4 EC                MOV     A,R4
08C5 98                SUBB    A,R0
08C6 FC                MOV     R4,A
08C7 900000      E     MOV     DPTR,#g_ref
08CA 120000      E     LCALL   ?C?LSTXDATA
08CD 8019              SJMP    ?C0096
08CF         ?C0099:
                                           ; SOURCE LINE # 666
                                           ; SOURCE LINE # 667
08CF 900000      E     MOV     DPTR,#g_mem+097H
08D2 E0                MOVX    A,@DPTR
08D3 FC                MOV     R4,A
08D4 A3                INC     DPTR
08D5 E0                MOVX    A,@DPTR
08D6 FD                MOV     R5,A
08D7 A3                INC     DPTR
08D8 E0                MOVX    A,@DPTR
08D9 FE                MOV     R6,A
08DA A3                INC     DPTR
08DB E0                MOVX    A,@DPTR
08DC FF                MOV     R7,A
08DD 900000      E     MOV     DPTR,#g_ref
08E0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 668
08E3 E4                CLR     A
08E4 900000      E     MOV     DPTR,#forced_open
08E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 669
                                           ; SOURCE LINE # 670
                                           ; SOURCE LINE # 671
08E8         ?C0096:
                                           ; SOURCE LINE # 673
08E8 900000      E     MOV     DPTR,#c_mem+034H
08EB E0                MOVX    A,@DPTR
08EC 7003              JNZ     $ + 5H
08EE 020000      R     LJMP    ?C0123
08F1 14                DEC     A
08F2 7003              JNZ     $ + 5H
08F4 020000      R     LJMP    ?C0145
08F7 14                DEC     A
08F8 7003              JNZ     $ + 5H
08FA 020000      R     LJMP    ?C0132
08FD 14                DEC     A
08FE 6003              JZ      $ + 5H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 66  

0900 020000      R     LJMP    ?C0101
                                           ; SOURCE LINE # 675
0903         ?C0102:
                                           ; SOURCE LINE # 676
0903 900000      E     MOV     DPTR,#g_meas
0906 E0                MOVX    A,@DPTR
0907 F8                MOV     R0,A
0908 A3                INC     DPTR
0909 E0                MOVX    A,@DPTR
090A F9                MOV     R1,A
090B A3                INC     DPTR
090C E0                MOVX    A,@DPTR
090D FA                MOV     R2,A
090E A3                INC     DPTR
090F E0                MOVX    A,@DPTR
0910 FB                MOV     R3,A
0911 900000      E     MOV     DPTR,#g_ref
0914 E0                MOVX    A,@DPTR
0915 FC                MOV     R4,A
0916 A3                INC     DPTR
0917 E0                MOVX    A,@DPTR
0918 FD                MOV     R5,A
0919 A3                INC     DPTR
091A E0                MOVX    A,@DPTR
091B FE                MOV     R6,A
091C A3                INC     DPTR
091D E0                MOVX    A,@DPTR
091E C3                CLR     C
091F 9B                SUBB    A,R3
0920 F500        R     MOV     pos_error+03H,A
0922 EE                MOV     A,R6
0923 9A                SUBB    A,R2
0924 F500        R     MOV     pos_error+02H,A
0926 ED                MOV     A,R5
0927 99                SUBB    A,R1
0928 F500        R     MOV     pos_error+01H,A
092A EC                MOV     A,R4
092B 98                SUBB    A,R0
092C F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 678
092E 900000      R     MOV     DPTR,#pos_error_sum
0931 E0                MOVX    A,@DPTR
0932 FC                MOV     R4,A
0933 A3                INC     DPTR
0934 E0                MOVX    A,@DPTR
0935 FD                MOV     R5,A
0936 A3                INC     DPTR
0937 E0                MOVX    A,@DPTR
0938 FE                MOV     R6,A
0939 A3                INC     DPTR
093A E0                MOVX    A,@DPTR
093B 2500        R     ADD     A,pos_error+03H
093D FF                MOV     R7,A
093E EE                MOV     A,R6
093F 3500        R     ADDC    A,pos_error+02H
0941 FE                MOV     R6,A
0942 ED                MOV     A,R5
0943 3500        R     ADDC    A,pos_error+01H
0945 FD                MOV     R5,A
0946 EC                MOV     A,R4
0947 3500        R     ADDC    A,pos_error
0949 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 67  

094A 900000      R     MOV     DPTR,#pos_error_sum
094D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 681
0950 7F80              MOV     R7,#080H
0952 7EF0              MOV     R6,#0F0H
0954 7DFA              MOV     R5,#0FAH
0956 7C02              MOV     R4,#02H
0958 900000      R     MOV     DPTR,#pos_error_sum
095B E0                MOVX    A,@DPTR
095C F8                MOV     R0,A
095D A3                INC     DPTR
095E E0                MOVX    A,@DPTR
095F F9                MOV     R1,A
0960 A3                INC     DPTR
0961 E0                MOVX    A,@DPTR
0962 FA                MOV     R2,A
0963 A3                INC     DPTR
0964 E0                MOVX    A,@DPTR
0965 FB                MOV     R3,A
0966 D3                SETB    C
0967 120000      E     LCALL   ?C?SLCMP
096A 4010              JC      ?C0103
                                           ; SOURCE LINE # 682
096C 7F80              MOV     R7,#080H
096E 7EF0              MOV     R6,#0F0H
0970 7DFA              MOV     R5,#0FAH
0972 7C02              MOV     R4,#02H
0974 900000      R     MOV     DPTR,#pos_error_sum
0977 120000      E     LCALL   ?C?LSTXDATA
097A 802A              SJMP    ?C0104
097C         ?C0103:
                                           ; SOURCE LINE # 683
                                           ; SOURCE LINE # 684
097C 7F80              MOV     R7,#080H
097E 7E0F              MOV     R6,#0FH
0980 7D05              MOV     R5,#05H
0982 7CFD              MOV     R4,#0FDH
0984 900000      R     MOV     DPTR,#pos_error_sum
0987 E0                MOVX    A,@DPTR
0988 F8                MOV     R0,A
0989 A3                INC     DPTR
098A E0                MOVX    A,@DPTR
098B F9                MOV     R1,A
098C A3                INC     DPTR
098D E0                MOVX    A,@DPTR
098E FA                MOV     R2,A
098F A3                INC     DPTR
0990 E0                MOVX    A,@DPTR
0991 FB                MOV     R3,A
0992 C3                CLR     C
0993 120000      E     LCALL   ?C?SLCMP
0996 500E              JNC     ?C0104
                                           ; SOURCE LINE # 685
0998 7F80              MOV     R7,#080H
099A 7E0F              MOV     R6,#0FH
099C 7D05              MOV     R5,#05H
099E 7CFD              MOV     R4,#0FDH
09A0 900000      R     MOV     DPTR,#pos_error_sum
09A3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 686
09A6         ?C0104:
                                           ; SOURCE LINE # 690
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 68  

09A6 E4                CLR     A
09A7 F500        R     MOV     i_ref+03H,A
09A9 F500        R     MOV     i_ref+02H,A
09AB F500        R     MOV     i_ref+01H,A
09AD F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 693
09AF FF                MOV     R7,A
09B0 FE                MOV     R6,A
09B1 FD                MOV     R5,A
09B2 FC                MOV     R4,A
09B3 AB00        R     MOV     R3,k_p_dl+03H
09B5 AA00        R     MOV     R2,k_p_dl+02H
09B7 A900        R     MOV     R1,k_p_dl+01H
09B9 A800        R     MOV     R0,k_p_dl
09BB C3                CLR     C
09BC 120000      E     LCALL   ?C?SLCMP
09BF 6026              JZ      ?C0106
                                           ; SOURCE LINE # 694
09C1 AF00        R     MOV     R7,pos_error+03H
09C3 AE00        R     MOV     R6,pos_error+02H
09C5 AD00        R     MOV     R5,pos_error+01H
09C7 AC00        R     MOV     R4,pos_error
09C9 A800        R     MOV     R0,k_p_dl
09CB 120000      E     LCALL   ?C?LMUL
09CE 7810              MOV     R0,#010H
09D0 120000      E     LCALL   ?C?SLSHR
09D3 E500        R     MOV     A,i_ref+03H
09D5 2F                ADD     A,R7
09D6 F500        R     MOV     i_ref+03H,A
09D8 E500        R     MOV     A,i_ref+02H
09DA 3E                ADDC    A,R6
09DB F500        R     MOV     i_ref+02H,A
09DD E500        R     MOV     A,i_ref+01H
09DF 3D                ADDC    A,R5
09E0 F500        R     MOV     i_ref+01H,A
09E2 E500        R     MOV     A,i_ref
09E4 3C                ADDC    A,R4
09E5 F500        R     MOV     i_ref,A
09E7         ?C0106:
                                           ; SOURCE LINE # 697
09E7 E4                CLR     A
09E8 FF                MOV     R7,A
09E9 FE                MOV     R6,A
09EA FD                MOV     R5,A
09EB FC                MOV     R4,A
09EC AB00        R     MOV     R3,k_i_dl+03H
09EE AA00        R     MOV     R2,k_i_dl+02H
09F0 A900        R     MOV     R1,k_i_dl+01H
09F2 A800        R     MOV     R0,k_i_dl
09F4 C3                CLR     C
09F5 120000      E     LCALL   ?C?SLCMP
09F8 602C              JZ      ?C0107
                                           ; SOURCE LINE # 698
09FA 900000      R     MOV     DPTR,#pos_error_sum
09FD E0                MOVX    A,@DPTR
09FE FC                MOV     R4,A
09FF A3                INC     DPTR
0A00 E0                MOVX    A,@DPTR
0A01 FD                MOV     R5,A
0A02 A3                INC     DPTR
0A03 E0                MOVX    A,@DPTR
0A04 FE                MOV     R6,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 69  

0A05 A3                INC     DPTR
0A06 E0                MOVX    A,@DPTR
0A07 FF                MOV     R7,A
0A08 A800        R     MOV     R0,k_i_dl
0A0A 120000      E     LCALL   ?C?LMUL
0A0D 7810              MOV     R0,#010H
0A0F 120000      E     LCALL   ?C?SLSHR
0A12 E500        R     MOV     A,i_ref+03H
0A14 2F                ADD     A,R7
0A15 F500        R     MOV     i_ref+03H,A
0A17 E500        R     MOV     A,i_ref+02H
0A19 3E                ADDC    A,R6
0A1A F500        R     MOV     i_ref+02H,A
0A1C E500        R     MOV     A,i_ref+01H
0A1E 3D                ADDC    A,R5
0A1F F500        R     MOV     i_ref+01H,A
0A21 E500        R     MOV     A,i_ref
0A23 3C                ADDC    A,R4
0A24 F500        R     MOV     i_ref,A
0A26         ?C0107:
                                           ; SOURCE LINE # 701
0A26 E4                CLR     A
0A27 FF                MOV     R7,A
0A28 FE                MOV     R6,A
0A29 FD                MOV     R5,A
0A2A FC                MOV     R4,A
0A2B AB00        R     MOV     R3,k_d_dl+03H
0A2D AA00        R     MOV     R2,k_d_dl+02H
0A2F A900        R     MOV     R1,k_d_dl+01H
0A31 A800        R     MOV     R0,k_d_dl
0A33 C3                CLR     C
0A34 120000      E     LCALL   ?C?SLCMP
0A37 6043              JZ      ?C0108
                                           ; SOURCE LINE # 702
0A39 900000      R     MOV     DPTR,#prev_pos_err
0A3C E0                MOVX    A,@DPTR
0A3D F8                MOV     R0,A
0A3E A3                INC     DPTR
0A3F E0                MOVX    A,@DPTR
0A40 F9                MOV     R1,A
0A41 A3                INC     DPTR
0A42 E0                MOVX    A,@DPTR
0A43 FA                MOV     R2,A
0A44 A3                INC     DPTR
0A45 E0                MOVX    A,@DPTR
0A46 FB                MOV     R3,A
0A47 C3                CLR     C
0A48 E500        R     MOV     A,pos_error+03H
0A4A 9B                SUBB    A,R3
0A4B FF                MOV     R7,A
0A4C E500        R     MOV     A,pos_error+02H
0A4E 9A                SUBB    A,R2
0A4F FE                MOV     R6,A
0A50 E500        R     MOV     A,pos_error+01H
0A52 99                SUBB    A,R1
0A53 FD                MOV     R5,A
0A54 E500        R     MOV     A,pos_error
0A56 98                SUBB    A,R0
0A57 FC                MOV     R4,A
0A58 AB00        R     MOV     R3,k_d_dl+03H
0A5A AA00        R     MOV     R2,k_d_dl+02H
0A5C A900        R     MOV     R1,k_d_dl+01H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 70  

0A5E A800        R     MOV     R0,k_d_dl
0A60 120000      E     LCALL   ?C?LMUL
0A63 7810              MOV     R0,#010H
0A65 120000      E     LCALL   ?C?SLSHR
0A68 E500        R     MOV     A,i_ref+03H
0A6A 2F                ADD     A,R7
0A6B F500        R     MOV     i_ref+03H,A
0A6D E500        R     MOV     A,i_ref+02H
0A6F 3E                ADDC    A,R6
0A70 F500        R     MOV     i_ref+02H,A
0A72 E500        R     MOV     A,i_ref+01H
0A74 3D                ADDC    A,R5
0A75 F500        R     MOV     i_ref+01H,A
0A77 E500        R     MOV     A,i_ref
0A79 3C                ADDC    A,R4
0A7A F500        R     MOV     i_ref,A
0A7C         ?C0108:
                                           ; SOURCE LINE # 705
0A7C AF00        R     MOV     R7,pos_error+03H
0A7E AE00        R     MOV     R6,pos_error+02H
0A80 AD00        R     MOV     R5,pos_error+01H
0A82 AC00        R     MOV     R4,pos_error
0A84 900000      R     MOV     DPTR,#prev_pos_err
0A87 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 708
0A8A E4                CLR     A
0A8B FF                MOV     R7,A
0A8C FE                MOV     R6,A
0A8D FD                MOV     R5,A
0A8E FC                MOV     R4,A
0A8F AB00        R     MOV     R3,i_ref+03H
0A91 AA00        R     MOV     R2,i_ref+02H
0A93 A900        R     MOV     R1,i_ref+01H
0A95 A800        R     MOV     R0,i_ref
0A97 C3                CLR     C
0A98 120000      E     LCALL   ?C?SLCMP
0A9B 4004              JC      ?C0109
                                           ; SOURCE LINE # 709
0A9D D200        R     SETB    motor_dir
0A9F 8002              SJMP    ?C0110
0AA1         ?C0109:
                                           ; SOURCE LINE # 711
0AA1 C200        R     CLR     motor_dir
0AA3         ?C0110:
                                           ; SOURCE LINE # 714
0AA3 900000      E     MOV     DPTR,#c_mem+069H
0AA6 E0                MOVX    A,@DPTR
0AA7 FE                MOV     R6,A
0AA8 A3                INC     DPTR
0AA9 E0                MOVX    A,@DPTR
0AAA FF                MOV     R7,A
0AAB EE                MOV     A,R6
0AAC 33                RLC     A
0AAD 95E0              SUBB    A,ACC
0AAF FD                MOV     R5,A
0AB0 FC                MOV     R4,A
0AB1 AB00        R     MOV     R3,i_ref+03H
0AB3 AA00        R     MOV     R2,i_ref+02H
0AB5 A900        R     MOV     R1,i_ref+01H
0AB7 A800        R     MOV     R0,i_ref
0AB9 D3                SETB    C
0ABA 120000      E     LCALL   ?C?SLCMP
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 71  

0ABD 4016              JC      ?C0111
                                           ; SOURCE LINE # 715
0ABF 900000      E     MOV     DPTR,#c_mem+069H
0AC2 E0                MOVX    A,@DPTR
0AC3 FE                MOV     R6,A
0AC4 A3                INC     DPTR
0AC5 E0                MOVX    A,@DPTR
0AC6 FF                MOV     R7,A
0AC7 EE                MOV     A,R6
0AC8 33                RLC     A
0AC9 95E0              SUBB    A,ACC
0ACB 8F00        R     MOV     i_ref+03H,R7
0ACD 8E00        R     MOV     i_ref+02H,R6
0ACF F500        R     MOV     i_ref+01H,A
0AD1 F500        R     MOV     i_ref,A
0AD3 803C              SJMP    ?C0112
0AD5         ?C0111:
                                           ; SOURCE LINE # 717
0AD5 900000      E     MOV     DPTR,#c_mem+069H
0AD8 E0                MOVX    A,@DPTR
0AD9 FE                MOV     R6,A
0ADA A3                INC     DPTR
0ADB E0                MOVX    A,@DPTR
0ADC FF                MOV     R7,A
0ADD C3                CLR     C
0ADE E4                CLR     A
0ADF 9F                SUBB    A,R7
0AE0 FF                MOV     R7,A
0AE1 E4                CLR     A
0AE2 9E                SUBB    A,R6
0AE3 FE                MOV     R6,A
0AE4 33                RLC     A
0AE5 95E0              SUBB    A,ACC
0AE7 FD                MOV     R5,A
0AE8 FC                MOV     R4,A
0AE9 AB00        R     MOV     R3,i_ref+03H
0AEB AA00        R     MOV     R2,i_ref+02H
0AED A900        R     MOV     R1,i_ref+01H
0AEF A800        R     MOV     R0,i_ref
0AF1 C3                CLR     C
0AF2 120000      E     LCALL   ?C?SLCMP
0AF5 501A              JNC     ?C0112
                                           ; SOURCE LINE # 718
0AF7 900000      E     MOV     DPTR,#c_mem+069H
0AFA E0                MOVX    A,@DPTR
0AFB FE                MOV     R6,A
0AFC A3                INC     DPTR
0AFD E0                MOVX    A,@DPTR
0AFE FF                MOV     R7,A
0AFF C3                CLR     C
0B00 E4                CLR     A
0B01 9F                SUBB    A,R7
0B02 FF                MOV     R7,A
0B03 E4                CLR     A
0B04 9E                SUBB    A,R6
0B05 FE                MOV     R6,A
0B06 33                RLC     A
0B07 95E0              SUBB    A,ACC
0B09 8F00        R     MOV     i_ref+03H,R7
0B0B 8E00        R     MOV     i_ref+02H,R6
0B0D F500        R     MOV     i_ref+01H,A
0B0F F500        R     MOV     i_ref,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 72  

0B11         ?C0112:
                                           ; SOURCE LINE # 721
0B11 900000      E     MOV     DPTR,#g_meas+0CH
0B14 E0                MOVX    A,@DPTR
0B15 F8                MOV     R0,A
0B16 A3                INC     DPTR
0B17 E0                MOVX    A,@DPTR
0B18 F9                MOV     R1,A
0B19 A3                INC     DPTR
0B1A E0                MOVX    A,@DPTR
0B1B FA                MOV     R2,A
0B1C A3                INC     DPTR
0B1D E0                MOVX    A,@DPTR
0B1E FB                MOV     R3,A
0B1F C3                CLR     C
0B20 E500        R     MOV     A,i_ref+03H
0B22 9B                SUBB    A,R3
0B23 F500        R     MOV     curr_error+03H,A
0B25 E500        R     MOV     A,i_ref+02H
0B27 9A                SUBB    A,R2
0B28 F500        R     MOV     curr_error+02H,A
0B2A E500        R     MOV     A,i_ref+01H
0B2C 99                SUBB    A,R1
0B2D F500        R     MOV     curr_error+01H,A
0B2F E500        R     MOV     A,i_ref
0B31 98                SUBB    A,R0
0B32 F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 722
0B34 900000      R     MOV     DPTR,#curr_error_sum
0B37 E0                MOVX    A,@DPTR
0B38 FC                MOV     R4,A
0B39 A3                INC     DPTR
0B3A E0                MOVX    A,@DPTR
0B3B FD                MOV     R5,A
0B3C A3                INC     DPTR
0B3D E0                MOVX    A,@DPTR
0B3E FE                MOV     R6,A
0B3F A3                INC     DPTR
0B40 E0                MOVX    A,@DPTR
0B41 2500        R     ADD     A,curr_error+03H
0B43 FF                MOV     R7,A
0B44 EE                MOV     A,R6
0B45 3500        R     ADDC    A,curr_error+02H
0B47 FE                MOV     R6,A
0B48 ED                MOV     A,R5
0B49 3500        R     ADDC    A,curr_error+01H
0B4B FD                MOV     R5,A
0B4C EC                MOV     A,R4
0B4D 3500        R     ADDC    A,curr_error
0B4F FC                MOV     R4,A
0B50 900000      R     MOV     DPTR,#curr_error_sum
0B53 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 724
0B56 7FA0              MOV     R7,#0A0H
0B58 7E86              MOV     R6,#086H
0B5A 7D01              MOV     R5,#01H
0B5C 7C00              MOV     R4,#00H
0B5E 900000      R     MOV     DPTR,#curr_error_sum
0B61 E0                MOVX    A,@DPTR
0B62 F8                MOV     R0,A
0B63 A3                INC     DPTR
0B64 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 73  

0B65 F9                MOV     R1,A
0B66 A3                INC     DPTR
0B67 E0                MOVX    A,@DPTR
0B68 FA                MOV     R2,A
0B69 A3                INC     DPTR
0B6A E0                MOVX    A,@DPTR
0B6B FB                MOV     R3,A
0B6C D3                SETB    C
0B6D 120000      E     LCALL   ?C?SLCMP
0B70 4010              JC      ?C0114
                                           ; SOURCE LINE # 725
0B72 7FA0              MOV     R7,#0A0H
0B74 7E86              MOV     R6,#086H
0B76 7D01              MOV     R5,#01H
0B78 7C00              MOV     R4,#00H
0B7A 900000      R     MOV     DPTR,#curr_error_sum
0B7D 120000      E     LCALL   ?C?LSTXDATA
0B80 802A              SJMP    ?C0115
0B82         ?C0114:
                                           ; SOURCE LINE # 726
                                           ; SOURCE LINE # 727
0B82 7F60              MOV     R7,#060H
0B84 7E79              MOV     R6,#079H
0B86 7DFE              MOV     R5,#0FEH
0B88 7CFF              MOV     R4,#0FFH
0B8A 900000      R     MOV     DPTR,#curr_error_sum
0B8D E0                MOVX    A,@DPTR
0B8E F8                MOV     R0,A
0B8F A3                INC     DPTR
0B90 E0                MOVX    A,@DPTR
0B91 F9                MOV     R1,A
0B92 A3                INC     DPTR
0B93 E0                MOVX    A,@DPTR
0B94 FA                MOV     R2,A
0B95 A3                INC     DPTR
0B96 E0                MOVX    A,@DPTR
0B97 FB                MOV     R3,A
0B98 C3                CLR     C
0B99 120000      E     LCALL   ?C?SLCMP
0B9C 500E              JNC     ?C0115
                                           ; SOURCE LINE # 728
0B9E 7F60              MOV     R7,#060H
0BA0 7E79              MOV     R6,#079H
0BA2 7DFE              MOV     R5,#0FEH
0BA4 7CFF              MOV     R4,#0FFH
0BA6 900000      R     MOV     DPTR,#curr_error_sum
0BA9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 729
0BAC         ?C0115:
                                           ; SOURCE LINE # 733
0BAC E4                CLR     A
0BAD F500        R     MOV     pwm_input+03H,A
0BAF F500        R     MOV     pwm_input+02H,A
0BB1 F500        R     MOV     pwm_input+01H,A
0BB3 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 736
0BB5 FF                MOV     R7,A
0BB6 FE                MOV     R6,A
0BB7 FD                MOV     R5,A
0BB8 FC                MOV     R4,A
0BB9 AB00        R     MOV     R3,k_p_c_dl+03H
0BBB AA00        R     MOV     R2,k_p_c_dl+02H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 74  

0BBD A900        R     MOV     R1,k_p_c_dl+01H
0BBF A800        R     MOV     R0,k_p_c_dl
0BC1 C3                CLR     C
0BC2 120000      E     LCALL   ?C?SLCMP
0BC5 6026              JZ      ?C0117
                                           ; SOURCE LINE # 737
0BC7 AF00        R     MOV     R7,curr_error+03H
0BC9 AE00        R     MOV     R6,curr_error+02H
0BCB AD00        R     MOV     R5,curr_error+01H
0BCD AC00        R     MOV     R4,curr_error
0BCF A800        R     MOV     R0,k_p_c_dl
0BD1 120000      E     LCALL   ?C?LMUL
0BD4 7810              MOV     R0,#010H
0BD6 120000      E     LCALL   ?C?SLSHR
0BD9 E500        R     MOV     A,pwm_input+03H
0BDB 2F                ADD     A,R7
0BDC F500        R     MOV     pwm_input+03H,A
0BDE E500        R     MOV     A,pwm_input+02H
0BE0 3E                ADDC    A,R6
0BE1 F500        R     MOV     pwm_input+02H,A
0BE3 E500        R     MOV     A,pwm_input+01H
0BE5 3D                ADDC    A,R5
0BE6 F500        R     MOV     pwm_input+01H,A
0BE8 E500        R     MOV     A,pwm_input
0BEA 3C                ADDC    A,R4
0BEB F500        R     MOV     pwm_input,A
0BED         ?C0117:
                                           ; SOURCE LINE # 740
0BED E4                CLR     A
0BEE FF                MOV     R7,A
0BEF FE                MOV     R6,A
0BF0 FD                MOV     R5,A
0BF1 FC                MOV     R4,A
0BF2 AB00        R     MOV     R3,k_i_c_dl+03H
0BF4 AA00        R     MOV     R2,k_i_c_dl+02H
0BF6 A900        R     MOV     R1,k_i_c_dl+01H
0BF8 A800        R     MOV     R0,k_i_c_dl
0BFA C3                CLR     C
0BFB 120000      E     LCALL   ?C?SLCMP
0BFE 602C              JZ      ?C0118
                                           ; SOURCE LINE # 741
0C00 900000      R     MOV     DPTR,#curr_error_sum
0C03 E0                MOVX    A,@DPTR
0C04 FC                MOV     R4,A
0C05 A3                INC     DPTR
0C06 E0                MOVX    A,@DPTR
0C07 FD                MOV     R5,A
0C08 A3                INC     DPTR
0C09 E0                MOVX    A,@DPTR
0C0A FE                MOV     R6,A
0C0B A3                INC     DPTR
0C0C E0                MOVX    A,@DPTR
0C0D FF                MOV     R7,A
0C0E A800        R     MOV     R0,k_i_c_dl
0C10 120000      E     LCALL   ?C?LMUL
0C13 7810              MOV     R0,#010H
0C15 120000      E     LCALL   ?C?SLSHR
0C18 E500        R     MOV     A,pwm_input+03H
0C1A 2F                ADD     A,R7
0C1B F500        R     MOV     pwm_input+03H,A
0C1D E500        R     MOV     A,pwm_input+02H
0C1F 3E                ADDC    A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 75  

0C20 F500        R     MOV     pwm_input+02H,A
0C22 E500        R     MOV     A,pwm_input+01H
0C24 3D                ADDC    A,R5
0C25 F500        R     MOV     pwm_input+01H,A
0C27 E500        R     MOV     A,pwm_input
0C29 3C                ADDC    A,R4
0C2A F500        R     MOV     pwm_input,A
0C2C         ?C0118:
                                           ; SOURCE LINE # 744
0C2C E4                CLR     A
0C2D FF                MOV     R7,A
0C2E FE                MOV     R6,A
0C2F FD                MOV     R5,A
0C30 FC                MOV     R4,A
0C31 AB00        R     MOV     R3,k_d_c_dl+03H
0C33 AA00        R     MOV     R2,k_d_c_dl+02H
0C35 A900        R     MOV     R1,k_d_c_dl+01H
0C37 A800        R     MOV     R0,k_d_c_dl
0C39 C3                CLR     C
0C3A 120000      E     LCALL   ?C?SLCMP
0C3D 6043              JZ      ?C0119
                                           ; SOURCE LINE # 745
0C3F 900000      R     MOV     DPTR,#prev_curr_err
0C42 E0                MOVX    A,@DPTR
0C43 F8                MOV     R0,A
0C44 A3                INC     DPTR
0C45 E0                MOVX    A,@DPTR
0C46 F9                MOV     R1,A
0C47 A3                INC     DPTR
0C48 E0                MOVX    A,@DPTR
0C49 FA                MOV     R2,A
0C4A A3                INC     DPTR
0C4B E0                MOVX    A,@DPTR
0C4C FB                MOV     R3,A
0C4D C3                CLR     C
0C4E E500        R     MOV     A,curr_error+03H
0C50 9B                SUBB    A,R3
0C51 FF                MOV     R7,A
0C52 E500        R     MOV     A,curr_error+02H
0C54 9A                SUBB    A,R2
0C55 FE                MOV     R6,A
0C56 E500        R     MOV     A,curr_error+01H
0C58 99                SUBB    A,R1
0C59 FD                MOV     R5,A
0C5A E500        R     MOV     A,curr_error
0C5C 98                SUBB    A,R0
0C5D FC                MOV     R4,A
0C5E AB00        R     MOV     R3,k_d_c_dl+03H
0C60 AA00        R     MOV     R2,k_d_c_dl+02H
0C62 A900        R     MOV     R1,k_d_c_dl+01H
0C64 A800        R     MOV     R0,k_d_c_dl
0C66 120000      E     LCALL   ?C?LMUL
0C69 7810              MOV     R0,#010H
0C6B 120000      E     LCALL   ?C?SLSHR
0C6E E500        R     MOV     A,pwm_input+03H
0C70 2F                ADD     A,R7
0C71 F500        R     MOV     pwm_input+03H,A
0C73 E500        R     MOV     A,pwm_input+02H
0C75 3E                ADDC    A,R6
0C76 F500        R     MOV     pwm_input+02H,A
0C78 E500        R     MOV     A,pwm_input+01H
0C7A 3D                ADDC    A,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 76  

0C7B F500        R     MOV     pwm_input+01H,A
0C7D E500        R     MOV     A,pwm_input
0C7F 3C                ADDC    A,R4
0C80 F500        R     MOV     pwm_input,A
0C82         ?C0119:
                                           ; SOURCE LINE # 748
0C82 74FF              MOV     A,#0FFH
0C84 7F9C              MOV     R7,#09CH
0C86 FE                MOV     R6,A
0C87 FD                MOV     R5,A
0C88 FC                MOV     R4,A
0C89 AB00        R     MOV     R3,pwm_input+03H
0C8B AA00        R     MOV     R2,pwm_input+02H
0C8D A900        R     MOV     R1,pwm_input+01H
0C8F A800        R     MOV     R0,pwm_input
0C91 C3                CLR     C
0C92 120000      E     LCALL   ?C?SLCMP
0C95 500D              JNC     ?C0120
                                           ; SOURCE LINE # 749
0C97 74FF              MOV     A,#0FFH
0C99 75009C      R     MOV     pwm_input+03H,#09CH
0C9C F500        R     MOV     pwm_input+02H,A
0C9E F500        R     MOV     pwm_input+01H,A
0CA0 F500        R     MOV     pwm_input,A
0CA2 801E              SJMP    ?C0121
0CA4         ?C0120:
                                           ; SOURCE LINE # 750
                                           ; SOURCE LINE # 751
0CA4 E4                CLR     A
0CA5 7F64              MOV     R7,#064H
0CA7 FE                MOV     R6,A
0CA8 FD                MOV     R5,A
0CA9 FC                MOV     R4,A
0CAA AB00        R     MOV     R3,pwm_input+03H
0CAC AA00        R     MOV     R2,pwm_input+02H
0CAE A900        R     MOV     R1,pwm_input+01H
0CB0 A800        R     MOV     R0,pwm_input
0CB2 D3                SETB    C
0CB3 120000      E     LCALL   ?C?SLCMP
0CB6 400A              JC      ?C0121
                                           ; SOURCE LINE # 752
0CB8 E4                CLR     A
0CB9 750064      R     MOV     pwm_input+03H,#064H
0CBC F500        R     MOV     pwm_input+02H,A
0CBE F500        R     MOV     pwm_input+01H,A
0CC0 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 753
0CC2         ?C0121:
                                           ; SOURCE LINE # 756
0CC2 AF00        R     MOV     R7,curr_error+03H
0CC4 AE00        R     MOV     R6,curr_error+02H
0CC6 AD00        R     MOV     R5,curr_error+01H
0CC8 AC00        R     MOV     R4,curr_error
0CCA 900000      R     MOV     DPTR,#prev_curr_err
0CCD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 758
0CD0 020000      R     LJMP    ?C0101
                                           ; SOURCE LINE # 761
0CD3         ?C0123:
                                           ; SOURCE LINE # 762
0CD3 900000      E     MOV     DPTR,#g_meas
0CD6 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 77  

0CD7 F8                MOV     R0,A
0CD8 A3                INC     DPTR
0CD9 E0                MOVX    A,@DPTR
0CDA F9                MOV     R1,A
0CDB A3                INC     DPTR
0CDC E0                MOVX    A,@DPTR
0CDD FA                MOV     R2,A
0CDE A3                INC     DPTR
0CDF E0                MOVX    A,@DPTR
0CE0 FB                MOV     R3,A
0CE1 900000      E     MOV     DPTR,#g_ref
0CE4 E0                MOVX    A,@DPTR
0CE5 FC                MOV     R4,A
0CE6 A3                INC     DPTR
0CE7 E0                MOVX    A,@DPTR
0CE8 FD                MOV     R5,A
0CE9 A3                INC     DPTR
0CEA E0                MOVX    A,@DPTR
0CEB FE                MOV     R6,A
0CEC A3                INC     DPTR
0CED E0                MOVX    A,@DPTR
0CEE C3                CLR     C
0CEF 9B                SUBB    A,R3
0CF0 F500        R     MOV     pos_error+03H,A
0CF2 EE                MOV     A,R6
0CF3 9A                SUBB    A,R2
0CF4 F500        R     MOV     pos_error+02H,A
0CF6 ED                MOV     A,R5
0CF7 99                SUBB    A,R1
0CF8 F500        R     MOV     pos_error+01H,A
0CFA EC                MOV     A,R4
0CFB 98                SUBB    A,R0
0CFC F500        R     MOV     pos_error,A
                                           ; SOURCE LINE # 764
0CFE 900000      R     MOV     DPTR,#pos_error_sum
0D01 E0                MOVX    A,@DPTR
0D02 FC                MOV     R4,A
0D03 A3                INC     DPTR
0D04 E0                MOVX    A,@DPTR
0D05 FD                MOV     R5,A
0D06 A3                INC     DPTR
0D07 E0                MOVX    A,@DPTR
0D08 FE                MOV     R6,A
0D09 A3                INC     DPTR
0D0A E0                MOVX    A,@DPTR
0D0B 2500        R     ADD     A,pos_error+03H
0D0D FF                MOV     R7,A
0D0E EE                MOV     A,R6
0D0F 3500        R     ADDC    A,pos_error+02H
0D11 FE                MOV     R6,A
0D12 ED                MOV     A,R5
0D13 3500        R     ADDC    A,pos_error+01H
0D15 FD                MOV     R5,A
0D16 EC                MOV     A,R4
0D17 3500        R     ADDC    A,pos_error
0D19 FC                MOV     R4,A
0D1A 900000      R     MOV     DPTR,#pos_error_sum
0D1D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 767
0D20 E4                CLR     A
0D21 7FE8              MOV     R7,#0E8H
0D23 7E03              MOV     R6,#03H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 78  

0D25 FD                MOV     R5,A
0D26 FC                MOV     R4,A
0D27 900000      R     MOV     DPTR,#pos_error_sum
0D2A E0                MOVX    A,@DPTR
0D2B F8                MOV     R0,A
0D2C A3                INC     DPTR
0D2D E0                MOVX    A,@DPTR
0D2E F9                MOV     R1,A
0D2F A3                INC     DPTR
0D30 E0                MOVX    A,@DPTR
0D31 FA                MOV     R2,A
0D32 A3                INC     DPTR
0D33 E0                MOVX    A,@DPTR
0D34 FB                MOV     R3,A
0D35 D3                SETB    C
0D36 120000      E     LCALL   ?C?SLCMP
0D39 400F              JC      ?C0124
                                           ; SOURCE LINE # 768
0D3B E4                CLR     A
0D3C 7FE8              MOV     R7,#0E8H
0D3E 7E03              MOV     R6,#03H
0D40 FD                MOV     R5,A
0D41 FC                MOV     R4,A
0D42 900000      R     MOV     DPTR,#pos_error_sum
0D45 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 769
0D48 802A              SJMP    ?C0125
0D4A         ?C0124:
0D4A 7F18              MOV     R7,#018H
0D4C 7EFC              MOV     R6,#0FCH
0D4E 7DFF              MOV     R5,#0FFH
0D50 7CFF              MOV     R4,#0FFH
0D52 900000      R     MOV     DPTR,#pos_error_sum
0D55 E0                MOVX    A,@DPTR
0D56 F8                MOV     R0,A
0D57 A3                INC     DPTR
0D58 E0                MOVX    A,@DPTR
0D59 F9                MOV     R1,A
0D5A A3                INC     DPTR
0D5B E0                MOVX    A,@DPTR
0D5C FA                MOV     R2,A
0D5D A3                INC     DPTR
0D5E E0                MOVX    A,@DPTR
0D5F FB                MOV     R3,A
0D60 C3                CLR     C
0D61 120000      E     LCALL   ?C?SLCMP
0D64 500E              JNC     ?C0125
                                           ; SOURCE LINE # 770
0D66 7F18              MOV     R7,#018H
0D68 7EFC              MOV     R6,#0FCH
0D6A 7DFF              MOV     R5,#0FFH
0D6C 7CFF              MOV     R4,#0FFH
0D6E 900000      R     MOV     DPTR,#pos_error_sum
0D71 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 771
0D74         ?C0125:
                                           ; SOURCE LINE # 774
0D74 E4                CLR     A
0D75 FF                MOV     R7,A
0D76 FE                MOV     R6,A
0D77 FD                MOV     R5,A
0D78 FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 79  

0D79 AB00        R     MOV     R3,k_p+03H
0D7B AA00        R     MOV     R2,k_p+02H
0D7D A900        R     MOV     R1,k_p+01H
0D7F A800        R     MOV     R0,k_p
0D81 C3                CLR     C
0D82 120000      E     LCALL   ?C?SLCMP
0D85 601A              JZ      ?C0127
                                           ; SOURCE LINE # 775
0D87 AF00        R     MOV     R7,pos_error+03H
0D89 AE00        R     MOV     R6,pos_error+02H
0D8B AD00        R     MOV     R5,pos_error+01H
0D8D AC00        R     MOV     R4,pos_error
0D8F A800        R     MOV     R0,k_p
0D91 120000      E     LCALL   ?C?LMUL
0D94 7810              MOV     R0,#010H
0D96 120000      E     LCALL   ?C?SLSHR
0D99 8F00        R     MOV     pwm_input+03H,R7
0D9B 8E00        R     MOV     pwm_input+02H,R6
0D9D 8D00        R     MOV     pwm_input+01H,R5
0D9F 8C00        R     MOV     pwm_input,R4
0DA1         ?C0127:
                                           ; SOURCE LINE # 779
0DA1 E4                CLR     A
0DA2 FF                MOV     R7,A
0DA3 FE                MOV     R6,A
0DA4 FD                MOV     R5,A
0DA5 FC                MOV     R4,A
0DA6 AB00        R     MOV     R3,k_i+03H
0DA8 AA00        R     MOV     R2,k_i+02H
0DAA A900        R     MOV     R1,k_i+01H
0DAC A800        R     MOV     R0,k_i
0DAE C3                CLR     C
0DAF 120000      E     LCALL   ?C?SLCMP
0DB2 602C              JZ      ?C0128
                                           ; SOURCE LINE # 780
0DB4 900000      R     MOV     DPTR,#pos_error_sum
0DB7 E0                MOVX    A,@DPTR
0DB8 FC                MOV     R4,A
0DB9 A3                INC     DPTR
0DBA E0                MOVX    A,@DPTR
0DBB FD                MOV     R5,A
0DBC A3                INC     DPTR
0DBD E0                MOVX    A,@DPTR
0DBE FE                MOV     R6,A
0DBF A3                INC     DPTR
0DC0 E0                MOVX    A,@DPTR
0DC1 FF                MOV     R7,A
0DC2 A800        R     MOV     R0,k_i
0DC4 120000      E     LCALL   ?C?LMUL
0DC7 7810              MOV     R0,#010H
0DC9 120000      E     LCALL   ?C?SLSHR
0DCC E500        R     MOV     A,pwm_input+03H
0DCE 2F                ADD     A,R7
0DCF F500        R     MOV     pwm_input+03H,A
0DD1 E500        R     MOV     A,pwm_input+02H
0DD3 3E                ADDC    A,R6
0DD4 F500        R     MOV     pwm_input+02H,A
0DD6 E500        R     MOV     A,pwm_input+01H
0DD8 3D                ADDC    A,R5
0DD9 F500        R     MOV     pwm_input+01H,A
0DDB E500        R     MOV     A,pwm_input
0DDD 3C                ADDC    A,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 80  

0DDE F500        R     MOV     pwm_input,A
0DE0         ?C0128:
                                           ; SOURCE LINE # 784
0DE0 E4                CLR     A
0DE1 FF                MOV     R7,A
0DE2 FE                MOV     R6,A
0DE3 FD                MOV     R5,A
0DE4 FC                MOV     R4,A
0DE5 AB00        R     MOV     R3,k_d+03H
0DE7 AA00        R     MOV     R2,k_d+02H
0DE9 A900        R     MOV     R1,k_d+01H
0DEB A800        R     MOV     R0,k_d
0DED C3                CLR     C
0DEE 120000      E     LCALL   ?C?SLCMP
0DF1 6043              JZ      ?C0129
                                           ; SOURCE LINE # 785
0DF3 900000      R     MOV     DPTR,#prev_pos_err
0DF6 E0                MOVX    A,@DPTR
0DF7 F8                MOV     R0,A
0DF8 A3                INC     DPTR
0DF9 E0                MOVX    A,@DPTR
0DFA F9                MOV     R1,A
0DFB A3                INC     DPTR
0DFC E0                MOVX    A,@DPTR
0DFD FA                MOV     R2,A
0DFE A3                INC     DPTR
0DFF E0                MOVX    A,@DPTR
0E00 FB                MOV     R3,A
0E01 C3                CLR     C
0E02 E500        R     MOV     A,pos_error+03H
0E04 9B                SUBB    A,R3
0E05 FF                MOV     R7,A
0E06 E500        R     MOV     A,pos_error+02H
0E08 9A                SUBB    A,R2
0E09 FE                MOV     R6,A
0E0A E500        R     MOV     A,pos_error+01H
0E0C 99                SUBB    A,R1
0E0D FD                MOV     R5,A
0E0E E500        R     MOV     A,pos_error
0E10 98                SUBB    A,R0
0E11 FC                MOV     R4,A
0E12 AB00        R     MOV     R3,k_d+03H
0E14 AA00        R     MOV     R2,k_d+02H
0E16 A900        R     MOV     R1,k_d+01H
0E18 A800        R     MOV     R0,k_d
0E1A 120000      E     LCALL   ?C?LMUL
0E1D 7810              MOV     R0,#010H
0E1F 120000      E     LCALL   ?C?SLSHR
0E22 E500        R     MOV     A,pwm_input+03H
0E24 2F                ADD     A,R7
0E25 F500        R     MOV     pwm_input+03H,A
0E27 E500        R     MOV     A,pwm_input+02H
0E29 3E                ADDC    A,R6
0E2A F500        R     MOV     pwm_input+02H,A
0E2C E500        R     MOV     A,pwm_input+01H
0E2E 3D                ADDC    A,R5
0E2F F500        R     MOV     pwm_input+01H,A
0E31 E500        R     MOV     A,pwm_input
0E33 3C                ADDC    A,R4
0E34 F500        R     MOV     pwm_input,A
0E36         ?C0129:
                                           ; SOURCE LINE # 789
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 81  

0E36 AF00        R     MOV     R7,pos_error+03H
0E38 AE00        R     MOV     R6,pos_error+02H
0E3A AD00        R     MOV     R5,pos_error+01H
0E3C AC00        R     MOV     R4,pos_error
0E3E 900000      R     MOV     DPTR,#prev_pos_err
0E41 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 791
0E44 E4                CLR     A
0E45 FF                MOV     R7,A
0E46 FE                MOV     R6,A
0E47 FD                MOV     R5,A
0E48 FC                MOV     R4,A
0E49 AB00        R     MOV     R3,pwm_input+03H
0E4B AA00        R     MOV     R2,pwm_input+02H
0E4D A900        R     MOV     R1,pwm_input+01H
0E4F A800        R     MOV     R0,pwm_input
0E51 D3                SETB    C
0E52 120000      E     LCALL   ?C?SLCMP
0E55 4005              JC      ?C0130
                                           ; SOURCE LINE # 792
0E57 D200        R     SETB    motor_dir
0E59 020000      R     LJMP    ?C0101
0E5C         ?C0130:
                                           ; SOURCE LINE # 794
0E5C C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 796
0E5E 020000      R     LJMP    ?C0101
                                           ; SOURCE LINE # 799
0E61         ?C0132:
                                           ; SOURCE LINE # 800
0E61 900000      E     MOV     DPTR,#g_ref+018H
0E64 E0                MOVX    A,@DPTR
0E65 7003              JNZ     $ + 5H
0E67 020000      R     LJMP    ?C0101
0E6A 200003      E     JB      tension_valid,$ + 6H
0E6D 020000      R     LJMP    ?C0101
                                           ; SOURCE LINE # 802
0E70 900000      E     MOV     DPTR,#g_ref+08H
0E73 E0                MOVX    A,@DPTR
0E74 FC                MOV     R4,A
0E75 A3                INC     DPTR
0E76 E0                MOVX    A,@DPTR
0E77 FD                MOV     R5,A
0E78 A3                INC     DPTR
0E79 E0                MOVX    A,@DPTR
0E7A FE                MOV     R6,A
0E7B A3                INC     DPTR
0E7C E0                MOVX    A,@DPTR
0E7D F500        R     MOV     i_ref+03H,A
0E7F 8E00        R     MOV     i_ref+02H,R6
0E81 8D00        R     MOV     i_ref+01H,R5
0E83 8C00        R     MOV     i_ref,R4
                                           ; SOURCE LINE # 804
0E85 900000      E     MOV     DPTR,#c_mem+069H
0E88 E0                MOVX    A,@DPTR
0E89 FE                MOV     R6,A
0E8A A3                INC     DPTR
0E8B E0                MOVX    A,@DPTR
0E8C FF                MOV     R7,A
0E8D EE                MOV     A,R6
0E8E 33                RLC     A
0E8F 95E0              SUBB    A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 82  

0E91 FD                MOV     R5,A
0E92 FC                MOV     R4,A
0E93 AB00        R     MOV     R3,i_ref+03H
0E95 AA00        R     MOV     R2,i_ref+02H
0E97 A900        R     MOV     R1,i_ref+01H
0E99 A800        R     MOV     R0,i_ref
0E9B D3                SETB    C
0E9C 120000      E     LCALL   ?C?SLCMP
0E9F 4016              JC      ?C0134
                                           ; SOURCE LINE # 805
0EA1 900000      E     MOV     DPTR,#c_mem+069H
0EA4 E0                MOVX    A,@DPTR
0EA5 FE                MOV     R6,A
0EA6 A3                INC     DPTR
0EA7 E0                MOVX    A,@DPTR
0EA8 FF                MOV     R7,A
0EA9 EE                MOV     A,R6
0EAA 33                RLC     A
0EAB 95E0              SUBB    A,ACC
0EAD 8F00        R     MOV     i_ref+03H,R7
0EAF 8E00        R     MOV     i_ref+02H,R6
0EB1 F500        R     MOV     i_ref+01H,A
0EB3 F500        R     MOV     i_ref,A
0EB5 803C              SJMP    ?C0135
0EB7         ?C0134:
                                           ; SOURCE LINE # 806
                                           ; SOURCE LINE # 807
0EB7 900000      E     MOV     DPTR,#c_mem+069H
0EBA E0                MOVX    A,@DPTR
0EBB FE                MOV     R6,A
0EBC A3                INC     DPTR
0EBD E0                MOVX    A,@DPTR
0EBE FF                MOV     R7,A
0EBF C3                CLR     C
0EC0 E4                CLR     A
0EC1 9F                SUBB    A,R7
0EC2 FF                MOV     R7,A
0EC3 E4                CLR     A
0EC4 9E                SUBB    A,R6
0EC5 FE                MOV     R6,A
0EC6 33                RLC     A
0EC7 95E0              SUBB    A,ACC
0EC9 FD                MOV     R5,A
0ECA FC                MOV     R4,A
0ECB AB00        R     MOV     R3,i_ref+03H
0ECD AA00        R     MOV     R2,i_ref+02H
0ECF A900        R     MOV     R1,i_ref+01H
0ED1 A800        R     MOV     R0,i_ref
0ED3 C3                CLR     C
0ED4 120000      E     LCALL   ?C?SLCMP
0ED7 501A              JNC     ?C0135
                                           ; SOURCE LINE # 808
0ED9 900000      E     MOV     DPTR,#c_mem+069H
0EDC E0                MOVX    A,@DPTR
0EDD FE                MOV     R6,A
0EDE A3                INC     DPTR
0EDF E0                MOVX    A,@DPTR
0EE0 FF                MOV     R7,A
0EE1 C3                CLR     C
0EE2 E4                CLR     A
0EE3 9F                SUBB    A,R7
0EE4 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 83  

0EE5 E4                CLR     A
0EE6 9E                SUBB    A,R6
0EE7 FE                MOV     R6,A
0EE8 33                RLC     A
0EE9 95E0              SUBB    A,ACC
0EEB 8F00        R     MOV     i_ref+03H,R7
0EED 8E00        R     MOV     i_ref+02H,R6
0EEF F500        R     MOV     i_ref+01H,A
0EF1 F500        R     MOV     i_ref,A
                                           ; SOURCE LINE # 809
0EF3         ?C0135:
                                           ; SOURCE LINE # 812
0EF3 900000      E     MOV     DPTR,#g_meas+0CH
0EF6 E0                MOVX    A,@DPTR
0EF7 F8                MOV     R0,A
0EF8 A3                INC     DPTR
0EF9 E0                MOVX    A,@DPTR
0EFA F9                MOV     R1,A
0EFB A3                INC     DPTR
0EFC E0                MOVX    A,@DPTR
0EFD FA                MOV     R2,A
0EFE A3                INC     DPTR
0EFF E0                MOVX    A,@DPTR
0F00 FB                MOV     R3,A
0F01 C3                CLR     C
0F02 E500        R     MOV     A,i_ref+03H
0F04 9B                SUBB    A,R3
0F05 F500        R     MOV     curr_error+03H,A
0F07 E500        R     MOV     A,i_ref+02H
0F09 9A                SUBB    A,R2
0F0A F500        R     MOV     curr_error+02H,A
0F0C E500        R     MOV     A,i_ref+01H
0F0E 99                SUBB    A,R1
0F0F F500        R     MOV     curr_error+01H,A
0F11 E500        R     MOV     A,i_ref
0F13 98                SUBB    A,R0
0F14 F500        R     MOV     curr_error,A
                                           ; SOURCE LINE # 813
0F16 900000      R     MOV     DPTR,#curr_error_sum
0F19 E0                MOVX    A,@DPTR
0F1A FC                MOV     R4,A
0F1B A3                INC     DPTR
0F1C E0                MOVX    A,@DPTR
0F1D FD                MOV     R5,A
0F1E A3                INC     DPTR
0F1F E0                MOVX    A,@DPTR
0F20 FE                MOV     R6,A
0F21 A3                INC     DPTR
0F22 E0                MOVX    A,@DPTR
0F23 2500        R     ADD     A,curr_error+03H
0F25 FF                MOV     R7,A
0F26 EE                MOV     A,R6
0F27 3500        R     ADDC    A,curr_error+02H
0F29 FE                MOV     R6,A
0F2A ED                MOV     A,R5
0F2B 3500        R     ADDC    A,curr_error+01H
0F2D FD                MOV     R5,A
0F2E EC                MOV     A,R4
0F2F 3500        R     ADDC    A,curr_error
0F31 FC                MOV     R4,A
0F32 900000      R     MOV     DPTR,#curr_error_sum
0F35 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 84  

                                           ; SOURCE LINE # 815
0F38 7FA0              MOV     R7,#0A0H
0F3A 7E86              MOV     R6,#086H
0F3C 7D01              MOV     R5,#01H
0F3E 7C00              MOV     R4,#00H
0F40 900000      R     MOV     DPTR,#curr_error_sum
0F43 E0                MOVX    A,@DPTR
0F44 F8                MOV     R0,A
0F45 A3                INC     DPTR
0F46 E0                MOVX    A,@DPTR
0F47 F9                MOV     R1,A
0F48 A3                INC     DPTR
0F49 E0                MOVX    A,@DPTR
0F4A FA                MOV     R2,A
0F4B A3                INC     DPTR
0F4C E0                MOVX    A,@DPTR
0F4D FB                MOV     R3,A
0F4E D3                SETB    C
0F4F 120000      E     LCALL   ?C?SLCMP
0F52 4010              JC      ?C0137
                                           ; SOURCE LINE # 816
0F54 7FA0              MOV     R7,#0A0H
0F56 7E86              MOV     R6,#086H
0F58 7D01              MOV     R5,#01H
0F5A 7C00              MOV     R4,#00H
0F5C 900000      R     MOV     DPTR,#curr_error_sum
0F5F 120000      E     LCALL   ?C?LSTXDATA
0F62 802A              SJMP    ?C0138
0F64         ?C0137:
                                           ; SOURCE LINE # 817
                                           ; SOURCE LINE # 818
0F64 7F60              MOV     R7,#060H
0F66 7E79              MOV     R6,#079H
0F68 7DFE              MOV     R5,#0FEH
0F6A 7CFF              MOV     R4,#0FFH
0F6C 900000      R     MOV     DPTR,#curr_error_sum
0F6F E0                MOVX    A,@DPTR
0F70 F8                MOV     R0,A
0F71 A3                INC     DPTR
0F72 E0                MOVX    A,@DPTR
0F73 F9                MOV     R1,A
0F74 A3                INC     DPTR
0F75 E0                MOVX    A,@DPTR
0F76 FA                MOV     R2,A
0F77 A3                INC     DPTR
0F78 E0                MOVX    A,@DPTR
0F79 FB                MOV     R3,A
0F7A C3                CLR     C
0F7B 120000      E     LCALL   ?C?SLCMP
0F7E 500E              JNC     ?C0138
                                           ; SOURCE LINE # 819
0F80 7F60              MOV     R7,#060H
0F82 7E79              MOV     R6,#079H
0F84 7DFE              MOV     R5,#0FEH
0F86 7CFF              MOV     R4,#0FFH
0F88 900000      R     MOV     DPTR,#curr_error_sum
0F8B 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 820
0F8E         ?C0138:
                                           ; SOURCE LINE # 822
0F8E E4                CLR     A
0F8F F500        R     MOV     pwm_input+03H,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 85  

0F91 F500        R     MOV     pwm_input+02H,A
0F93 F500        R     MOV     pwm_input+01H,A
0F95 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 825
0F97 FF                MOV     R7,A
0F98 FE                MOV     R6,A
0F99 FD                MOV     R5,A
0F9A FC                MOV     R4,A
0F9B AB00        R     MOV     R3,k_p_c+03H
0F9D AA00        R     MOV     R2,k_p_c+02H
0F9F A900        R     MOV     R1,k_p_c+01H
0FA1 A800        R     MOV     R0,k_p_c
0FA3 C3                CLR     C
0FA4 120000      E     LCALL   ?C?SLCMP
0FA7 6026              JZ      ?C0140
                                           ; SOURCE LINE # 826
0FA9 AF00        R     MOV     R7,curr_error+03H
0FAB AE00        R     MOV     R6,curr_error+02H
0FAD AD00        R     MOV     R5,curr_error+01H
0FAF AC00        R     MOV     R4,curr_error
0FB1 A800        R     MOV     R0,k_p_c
0FB3 120000      E     LCALL   ?C?LMUL
0FB6 7810              MOV     R0,#010H
0FB8 120000      E     LCALL   ?C?SLSHR
0FBB E500        R     MOV     A,pwm_input+03H
0FBD 2F                ADD     A,R7
0FBE F500        R     MOV     pwm_input+03H,A
0FC0 E500        R     MOV     A,pwm_input+02H
0FC2 3E                ADDC    A,R6
0FC3 F500        R     MOV     pwm_input+02H,A
0FC5 E500        R     MOV     A,pwm_input+01H
0FC7 3D                ADDC    A,R5
0FC8 F500        R     MOV     pwm_input+01H,A
0FCA E500        R     MOV     A,pwm_input
0FCC 3C                ADDC    A,R4
0FCD F500        R     MOV     pwm_input,A
0FCF         ?C0140:
                                           ; SOURCE LINE # 829
0FCF E4                CLR     A
0FD0 FF                MOV     R7,A
0FD1 FE                MOV     R6,A
0FD2 FD                MOV     R5,A
0FD3 FC                MOV     R4,A
0FD4 AB00        R     MOV     R3,k_i_c+03H
0FD6 AA00        R     MOV     R2,k_i_c+02H
0FD8 A900        R     MOV     R1,k_i_c+01H
0FDA A800        R     MOV     R0,k_i_c
0FDC C3                CLR     C
0FDD 120000      E     LCALL   ?C?SLCMP
0FE0 602C              JZ      ?C0141
                                           ; SOURCE LINE # 830
0FE2 900000      R     MOV     DPTR,#curr_error_sum
0FE5 E0                MOVX    A,@DPTR
0FE6 FC                MOV     R4,A
0FE7 A3                INC     DPTR
0FE8 E0                MOVX    A,@DPTR
0FE9 FD                MOV     R5,A
0FEA A3                INC     DPTR
0FEB E0                MOVX    A,@DPTR
0FEC FE                MOV     R6,A
0FED A3                INC     DPTR
0FEE E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 86  

0FEF FF                MOV     R7,A
0FF0 A800        R     MOV     R0,k_i_c
0FF2 120000      E     LCALL   ?C?LMUL
0FF5 7810              MOV     R0,#010H
0FF7 120000      E     LCALL   ?C?SLSHR
0FFA E500        R     MOV     A,pwm_input+03H
0FFC 2F                ADD     A,R7
0FFD F500        R     MOV     pwm_input+03H,A
0FFF E500        R     MOV     A,pwm_input+02H
1001 3E                ADDC    A,R6
1002 F500        R     MOV     pwm_input+02H,A
1004 E500        R     MOV     A,pwm_input+01H
1006 3D                ADDC    A,R5
1007 F500        R     MOV     pwm_input+01H,A
1009 E500        R     MOV     A,pwm_input
100B 3C                ADDC    A,R4
100C F500        R     MOV     pwm_input,A
100E         ?C0141:
                                           ; SOURCE LINE # 833
100E E4                CLR     A
100F FF                MOV     R7,A
1010 FE                MOV     R6,A
1011 FD                MOV     R5,A
1012 FC                MOV     R4,A
1013 AB00        R     MOV     R3,k_d_c+03H
1015 AA00        R     MOV     R2,k_d_c+02H
1017 A900        R     MOV     R1,k_d_c+01H
1019 A800        R     MOV     R0,k_d_c
101B C3                CLR     C
101C 120000      E     LCALL   ?C?SLCMP
101F 6043              JZ      ?C0142
                                           ; SOURCE LINE # 834
1021 900000      R     MOV     DPTR,#prev_curr_err
1024 E0                MOVX    A,@DPTR
1025 F8                MOV     R0,A
1026 A3                INC     DPTR
1027 E0                MOVX    A,@DPTR
1028 F9                MOV     R1,A
1029 A3                INC     DPTR
102A E0                MOVX    A,@DPTR
102B FA                MOV     R2,A
102C A3                INC     DPTR
102D E0                MOVX    A,@DPTR
102E FB                MOV     R3,A
102F C3                CLR     C
1030 E500        R     MOV     A,curr_error+03H
1032 9B                SUBB    A,R3
1033 FF                MOV     R7,A
1034 E500        R     MOV     A,curr_error+02H
1036 9A                SUBB    A,R2
1037 FE                MOV     R6,A
1038 E500        R     MOV     A,curr_error+01H
103A 99                SUBB    A,R1
103B FD                MOV     R5,A
103C E500        R     MOV     A,curr_error
103E 98                SUBB    A,R0
103F FC                MOV     R4,A
1040 AB00        R     MOV     R3,k_d_c+03H
1042 AA00        R     MOV     R2,k_d_c+02H
1044 A900        R     MOV     R1,k_d_c+01H
1046 A800        R     MOV     R0,k_d_c
1048 120000      E     LCALL   ?C?LMUL
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 87  

104B 7810              MOV     R0,#010H
104D 120000      E     LCALL   ?C?SLSHR
1050 E500        R     MOV     A,pwm_input+03H
1052 2F                ADD     A,R7
1053 F500        R     MOV     pwm_input+03H,A
1055 E500        R     MOV     A,pwm_input+02H
1057 3E                ADDC    A,R6
1058 F500        R     MOV     pwm_input+02H,A
105A E500        R     MOV     A,pwm_input+01H
105C 3D                ADDC    A,R5
105D F500        R     MOV     pwm_input+01H,A
105F E500        R     MOV     A,pwm_input
1061 3C                ADDC    A,R4
1062 F500        R     MOV     pwm_input,A
1064         ?C0142:
                                           ; SOURCE LINE # 836
1064 AF00        R     MOV     R7,curr_error+03H
1066 AE00        R     MOV     R6,curr_error+02H
1068 AD00        R     MOV     R5,curr_error+01H
106A AC00        R     MOV     R4,curr_error
106C 900000      R     MOV     DPTR,#prev_curr_err
106F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 838
1072 E4                CLR     A
1073 FF                MOV     R7,A
1074 FE                MOV     R6,A
1075 FD                MOV     R5,A
1076 FC                MOV     R4,A
1077 AB00        R     MOV     R3,pwm_input+03H
1079 AA00        R     MOV     R2,pwm_input+02H
107B A900        R     MOV     R1,pwm_input+01H
107D A800        R     MOV     R0,pwm_input
107F C3                CLR     C
1080 120000      E     LCALL   ?C?SLCMP
1083 4004              JC      ?C0143
                                           ; SOURCE LINE # 839
1085 D200        R     SETB    motor_dir
1087 8072              SJMP    ?C0101
1089         ?C0143:
                                           ; SOURCE LINE # 841
1089 C200        R     CLR     motor_dir
                                           ; SOURCE LINE # 842
                                           ; SOURCE LINE # 843
108B 806E              SJMP    ?C0101
                                           ; SOURCE LINE # 846
108D         ?C0145:
                                           ; SOURCE LINE # 848
108D 900000      E     MOV     DPTR,#g_ref+010H
1090 E0                MOVX    A,@DPTR
1091 FC                MOV     R4,A
1092 A3                INC     DPTR
1093 E0                MOVX    A,@DPTR
1094 FD                MOV     R5,A
1095 A3                INC     DPTR
1096 E0                MOVX    A,@DPTR
1097 FE                MOV     R6,A
1098 A3                INC     DPTR
1099 E0                MOVX    A,@DPTR
109A F500        R     MOV     pwm_input+03H,A
109C 8E00        R     MOV     pwm_input+02H,R6
109E 8D00        R     MOV     pwm_input+01H,R5
10A0 8C00        R     MOV     pwm_input,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 88  

                                           ; SOURCE LINE # 850
10A2 E4                CLR     A
10A3 FF                MOV     R7,A
10A4 FE                MOV     R6,A
10A5 FD                MOV     R5,A
10A6 FC                MOV     R4,A
10A7 AB00        R     MOV     R3,pwm_input+03H
10A9 AA00        R     MOV     R2,pwm_input+02H
10AB A900        R     MOV     R1,pwm_input+01H
10AD A800        R     MOV     R0,pwm_input
10AF D3                SETB    C
10B0 120000      E     LCALL   ?C?SLCMP
10B3 4004              JC      ?C0146
                                           ; SOURCE LINE # 851
10B5 D200        R     SETB    motor_dir
10B7 8002              SJMP    ?C0147
10B9         ?C0146:
                                           ; SOURCE LINE # 853
10B9 C200        R     CLR     motor_dir
10BB         ?C0147:
                                           ; SOURCE LINE # 857
10BB 74FF              MOV     A,#0FFH
10BD 7F9C              MOV     R7,#09CH
10BF FE                MOV     R6,A
10C0 FD                MOV     R5,A
10C1 FC                MOV     R4,A
10C2 AB00        R     MOV     R3,pwm_input+03H
10C4 AA00        R     MOV     R2,pwm_input+02H
10C6 A900        R     MOV     R1,pwm_input+01H
10C8 A800        R     MOV     R0,pwm_input
10CA C3                CLR     C
10CB 120000      E     LCALL   ?C?SLCMP
10CE 500D              JNC     ?C0148
                                           ; SOURCE LINE # 858
10D0 74FF              MOV     A,#0FFH
10D2 75009C      R     MOV     pwm_input+03H,#09CH
10D5 F500        R     MOV     pwm_input+02H,A
10D7 F500        R     MOV     pwm_input+01H,A
10D9 F500        R     MOV     pwm_input,A
10DB 801E              SJMP    ?C0101
10DD         ?C0148:
                                           ; SOURCE LINE # 859
10DD E4                CLR     A
10DE 7F64              MOV     R7,#064H
10E0 FE                MOV     R6,A
10E1 FD                MOV     R5,A
10E2 FC                MOV     R4,A
10E3 AB00        R     MOV     R3,pwm_input+03H
10E5 AA00        R     MOV     R2,pwm_input+02H
10E7 A900        R     MOV     R1,pwm_input+01H
10E9 A800        R     MOV     R0,pwm_input
10EB D3                SETB    C
10EC 120000      E     LCALL   ?C?SLCMP
10EF 400A              JC      ?C0101
                                           ; SOURCE LINE # 860
10F1 E4                CLR     A
10F2 750064      R     MOV     pwm_input+03H,#064H
10F5 F500        R     MOV     pwm_input+02H,A
10F7 F500        R     MOV     pwm_input+01H,A
10F9 F500        R     MOV     pwm_input,A
                                           ; SOURCE LINE # 863
                                           ; SOURCE LINE # 865
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 89  

10FB         ?C0101:
                                           ; SOURCE LINE # 869
10FB E4                CLR     A
10FC 7F64              MOV     R7,#064H
10FE FE                MOV     R6,A
10FF FD                MOV     R5,A
1100 FC                MOV     R4,A
1101 AB00        R     MOV     R3,pwm_input+03H
1103 AA00        R     MOV     R2,pwm_input+02H
1105 A900        R     MOV     R1,pwm_input+01H
1107 A800        R     MOV     R0,pwm_input
1109 D3                SETB    C
110A 120000      E     LCALL   ?C?SLCMP
110D 400A              JC      ?C0151
                                           ; SOURCE LINE # 870
110F E4                CLR     A
1110 750064      R     MOV     pwm_input+03H,#064H
1113 F500        R     MOV     pwm_input+02H,A
1115 F500        R     MOV     pwm_input+01H,A
1117 F500        R     MOV     pwm_input,A
1119         ?C0151:
                                           ; SOURCE LINE # 871
1119 74FF              MOV     A,#0FFH
111B 7F9C              MOV     R7,#09CH
111D FE                MOV     R6,A
111E FD                MOV     R5,A
111F FC                MOV     R4,A
1120 AB00        R     MOV     R3,pwm_input+03H
1122 AA00        R     MOV     R2,pwm_input+02H
1124 A900        R     MOV     R1,pwm_input+01H
1126 A800        R     MOV     R0,pwm_input
1128 C3                CLR     C
1129 120000      E     LCALL   ?C?SLCMP
112C 500B              JNC     ?C0152
                                           ; SOURCE LINE # 872
112E 74FF              MOV     A,#0FFH
1130 75009C      R     MOV     pwm_input+03H,#09CH
1133 F500        R     MOV     pwm_input+02H,A
1135 F500        R     MOV     pwm_input+01H,A
1137 F500        R     MOV     pwm_input,A
1139         ?C0152:
                                           ; SOURCE LINE # 875
1139 900000      E     MOV     DPTR,#c_mem+034H
113C E0                MOVX    A,@DPTR
113D 6401              XRL     A,#01H
113F 6037              JZ      ?C0153
                                           ; SOURCE LINE # 876
1141 AF00        R     MOV     R7,pwm_input+03H
1143 AE00        R     MOV     R6,pwm_input+02H
1145 AD00        R     MOV     R5,pwm_input+01H
1147 AC00        R     MOV     R4,pwm_input
1149 780A              MOV     R0,#0AH
114B 120000      E     LCALL   ?C?LSHL
114E E4                CLR     A
114F 7B64              MOV     R3,#064H
1151 FA                MOV     R2,A
1152 F9                MOV     R1,A
1153 F8                MOV     R0,A
1154 120000      E     LCALL   ?C?SLDIV
1157 A804              MOV     R0,AR4
1159 A905              MOV     R1,AR5
115B AA06              MOV     R2,AR6
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 90  

115D AB07              MOV     R3,AR7
115F 900000      E     MOV     DPTR,#dev_pwm_limit
1162 E0                MOVX    A,@DPTR
1163 FF                MOV     R7,A
1164 E4                CLR     A
1165 FC                MOV     R4,A
1166 FD                MOV     R5,A
1167 FE                MOV     R6,A
1168 120000      E     LCALL   ?C?LMUL
116B 780A              MOV     R0,#0AH
116D 120000      E     LCALL   ?C?SLSHR
1170 8F00        R     MOV     pwm_input+03H,R7
1172 8E00        R     MOV     pwm_input+02H,R6
1174 8D00        R     MOV     pwm_input+01H,R5
1176 8C00        R     MOV     pwm_input,R4
1178         ?C0153:
                                           ; SOURCE LINE # 879
1178 E4                CLR     A
1179 FF                MOV     R7,A
117A FE                MOV     R6,A
117B FD                MOV     R5,A
117C FC                MOV     R4,A
117D AB00        R     MOV     R3,pwm_input+03H
117F AA00        R     MOV     R2,pwm_input+02H
1181 A900        R     MOV     R1,pwm_input+01H
1183 A800        R     MOV     R0,pwm_input
1185 C3                CLR     C
1186 120000      E     LCALL   ?C?SLCMP
1189 4004              JC      ?C0154
118B 7F01              MOV     R7,#01H
118D 8002              SJMP    ?C0155
118F         ?C0154:
118F 7FFF              MOV     R7,#0FFH
1191         ?C0155:
1191 900000      E     MOV     DPTR,#pwm_sign
1194 EF                MOV     A,R7
1195 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 881
1196 300007            JNB     motor_dir,?C0156
                                           ; SOURCE LINE # 882
1199 7F01              MOV     R7,#01H
119B 120000      E     LCALL   _MOTOR_DIR_Write
119E 8005              SJMP    ?C0157
11A0         ?C0156:
                                           ; SOURCE LINE # 884
11A0 E4                CLR     A
11A1 FF                MOV     R7,A
11A2 120000      E     LCALL   _MOTOR_DIR_Write
11A5         ?C0157:
                                           ; SOURCE LINE # 886
11A5 AE00        R     MOV     R6,pwm_input+02H
11A7 AF00        R     MOV     R7,pwm_input+03H
11A9 120000      E     LCALL   _abs
11AC 120000      E     LCALL   _PWM_MOTORS_WriteCompare1
                                           ; SOURCE LINE # 887
11AF 22                RET     
             ; FUNCTION motor_control (END)

             ; FUNCTION _encoder_reading (BEGIN)
                                           ; SOURCE LINE # 893
;---- Variable 'idx' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 895
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 91  

0000 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 922
0002 E500        R     MOV     A,index
0004 C3                CLR     C
0005 9403              SUBB    A,#03H
0007 4003              JC      $ + 5H
0009 020000      R     LJMP    ?C0160
000C         ?C0159:
                                           ; SOURCE LINE # 925
000C 300022            JNB     reset_last_value_flag,?C0161
                                           ; SOURCE LINE # 926
;---- Variable 'jj' assigned to Register 'R3' ----
000F 7B03              MOV     R3,#03H
0011         ?C0162:
0011 AF03              MOV     R7,AR3
0013 1B                DEC     R3
0014 EF                MOV     A,R7
0015 6018              JZ      ?C0163
                                           ; SOURCE LINE # 927
0017 E4                CLR     A
0018 FF                MOV     R7,A
0019 FE                MOV     R6,A
001A FD                MOV     R5,A
001B FC                MOV     R4,A
001C EB                MOV     A,R3
001D 25E0              ADD     A,ACC
001F 25E0              ADD     A,ACC
0021 2400        R     ADD     A,#LOW last_value_encoder
0023 F582              MOV     DPL,A
0025 E4                CLR     A
0026 3400        R     ADDC    A,#HIGH last_value_encoder
0028 F583              MOV     DPH,A
002A 120000      E     LCALL   ?C?LSTXDATA
002D 80E2              SJMP    ?C0162
002F         ?C0163:
                                           ; SOURCE LINE # 929
002F C200        E     CLR     reset_last_value_flag
                                           ; SOURCE LINE # 930
0031         ?C0161:
                                           ; SOURCE LINE # 934
0031 E500        R     MOV     A,index
0033 7018              JNZ     ?C0164
                                           ; SOURCE LINE # 935
0035 120000      E     LCALL   SHIFTREG_ENC_1_ReadData
0038 7801              MOV     R0,#01H
003A 120000      E     LCALL   ?C?ULSHR
003D EF                MOV     A,R7
003E EE                MOV     A,R6
003F ED                MOV     A,R5
0040 5403              ANL     A,#03H
0042 FD                MOV     R5,A
0043 E4                CLR     A
0044 FC                MOV     R4,A
0045 900000      R     MOV     DPTR,#data_encoder
0048 120000      E     LCALL   ?C?LSTXDATA
004B 8033              SJMP    ?C0165
004D         ?C0164:
                                           ; SOURCE LINE # 936
                                           ; SOURCE LINE # 937
004D E500        R     MOV     A,index
004F B40118            CJNE    A,#01H,?C0166
                                           ; SOURCE LINE # 938
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 92  

0052 120000      E     LCALL   SHIFTREG_ENC_2_ReadData
0055 7801              MOV     R0,#01H
0057 120000      E     LCALL   ?C?ULSHR
005A EF                MOV     A,R7
005B EE                MOV     A,R6
005C ED                MOV     A,R5
005D 5403              ANL     A,#03H
005F FD                MOV     R5,A
0060 E4                CLR     A
0061 FC                MOV     R4,A
0062 900000      R     MOV     DPTR,#data_encoder
0065 120000      E     LCALL   ?C?LSTXDATA
0068 8016              SJMP    ?C0165
006A         ?C0166:
                                           ; SOURCE LINE # 940
006A 120000      E     LCALL   SHIFTREG_ENC_3_ReadData
006D 7801              MOV     R0,#01H
006F 120000      E     LCALL   ?C?ULSHR
0072 EF                MOV     A,R7
0073 EE                MOV     A,R6
0074 ED                MOV     A,R5
0075 5403              ANL     A,#03H
0077 FD                MOV     R5,A
0078 E4                CLR     A
0079 FC                MOV     R4,A
007A 900000      R     MOV     DPTR,#data_encoder
007D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 941
0080         ?C0165:
                                           ; SOURCE LINE # 944
0080 7B01              MOV     R3,#01H
0082 7A00        R     MOV     R2,#HIGH data_encoder
0084 7900        R     MOV     R1,#LOW data_encoder
0086 120000      E     LCALL   _check_enc_data
0089 4003              JC      $ + 5H
008B 020000      R     LJMP    ?C0168
                                           ; SOURCE LINE # 946
008E 900000      R     MOV     DPTR,#data_encoder
0091 E0                MOVX    A,@DPTR
0092 FC                MOV     R4,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FD                MOV     R5,A
0096 A3                INC     DPTR
0097 E0                MOVX    A,@DPTR
0098 FE                MOV     R6,A
0099 A3                INC     DPTR
009A E0                MOVX    A,@DPTR
009B 54C0              ANL     A,#0C0H
009D FF                MOV     R7,A
009E EE                MOV     A,R6
009F ED                MOV     A,R5
00A0 5403              ANL     A,#03H
00A2 FD                MOV     R5,A
00A3 E4                CLR     A
00A4 2F                ADD     A,R7
00A5 FF                MOV     R7,A
00A6 E4                CLR     A
00A7 3E                ADDC    A,R6
00A8 FE                MOV     R6,A
00A9 ED                MOV     A,R5
00AA 34FE              ADDC    A,#0FEH
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 93  

00AC FD                MOV     R5,A
00AD E4                CLR     A
00AE 34FF              ADDC    A,#0FFH
00B0 FC                MOV     R4,A
00B1 7802              MOV     R0,#02H
00B3 120000      E     LCALL   ?C?ULSHR
00B6 EE                MOV     A,R6
00B7 33                RLC     A
00B8 95E0              SUBB    A,ACC
00BA FD                MOV     R5,A
00BB FC                MOV     R4,A
00BC E500        R     MOV     A,index
00BE 25E0              ADD     A,ACC
00C0 25E0              ADD     A,ACC
00C2 2400        E     ADD     A,#LOW g_mem+038H
00C4 F582              MOV     DPL,A
00C6 E4                CLR     A
00C7 3400        E     ADDC    A,#HIGH g_mem+038H
00C9 F583              MOV     DPH,A
00CB E0                MOVX    A,@DPTR
00CC F8                MOV     R0,A
00CD A3                INC     DPTR
00CE E0                MOVX    A,@DPTR
00CF F9                MOV     R1,A
00D0 A3                INC     DPTR
00D1 E0                MOVX    A,@DPTR
00D2 FA                MOV     R2,A
00D3 A3                INC     DPTR
00D4 E0                MOVX    A,@DPTR
00D5 2F                ADD     A,R7
00D6 FF                MOV     R7,A
00D7 EA                MOV     A,R2
00D8 3E                ADDC    A,R6
00D9 FE                MOV     R6,A
00DA E9                MOV     A,R1
00DB 3D                ADDC    A,R5
00DC FD                MOV     R5,A
00DD E8                MOV     A,R0
00DE 3C                ADDC    A,R4
00DF FC                MOV     R4,A
00E0 900000      R     MOV     DPTR,#value_encoder
00E3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 953
00E6 300027            JNB     only_first_time,?C0169
                                           ; SOURCE LINE # 954
00E9 900000      R     MOV     DPTR,#value_encoder
00EC E0                MOVX    A,@DPTR
00ED FC                MOV     R4,A
00EE A3                INC     DPTR
00EF E0                MOVX    A,@DPTR
00F0 FD                MOV     R5,A
00F1 A3                INC     DPTR
00F2 E0                MOVX    A,@DPTR
00F3 FE                MOV     R6,A
00F4 A3                INC     DPTR
00F5 E0                MOVX    A,@DPTR
00F6 FF                MOV     R7,A
00F7 E500        R     MOV     A,index
00F9 25E0              ADD     A,ACC
00FB 25E0              ADD     A,ACC
00FD 2400        R     ADD     A,#LOW last_value_encoder
00FF F582              MOV     DPL,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 94  

0101 E4                CLR     A
0102 3400        R     ADDC    A,#HIGH last_value_encoder
0104 F583              MOV     DPH,A
0106 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 955
0109 E500        R     MOV     A,index
010B B40202            CJNE    A,#02H,?C0169
                                           ; SOURCE LINE # 956
010E C200        R     CLR     only_first_time
                                           ; SOURCE LINE # 957
0110         ?C0169:
                                           ; SOURCE LINE # 960
0110 E500        R     MOV     A,index
0112 25E0              ADD     A,ACC
0114 25E0              ADD     A,ACC
0116 2400        R     ADD     A,#LOW last_value_encoder
0118 F582              MOV     DPL,A
011A E4                CLR     A
011B 3400        R     ADDC    A,#HIGH last_value_encoder
011D F583              MOV     DPH,A
011F E0                MOVX    A,@DPTR
0120 F8                MOV     R0,A
0121 A3                INC     DPTR
0122 E0                MOVX    A,@DPTR
0123 F9                MOV     R1,A
0124 A3                INC     DPTR
0125 E0                MOVX    A,@DPTR
0126 FA                MOV     R2,A
0127 A3                INC     DPTR
0128 E0                MOVX    A,@DPTR
0129 FB                MOV     R3,A
012A 900000      R     MOV     DPTR,#value_encoder
012D E0                MOVX    A,@DPTR
012E FC                MOV     R4,A
012F A3                INC     DPTR
0130 E0                MOVX    A,@DPTR
0131 FD                MOV     R5,A
0132 A3                INC     DPTR
0133 E0                MOVX    A,@DPTR
0134 FE                MOV     R6,A
0135 A3                INC     DPTR
0136 E0                MOVX    A,@DPTR
0137 C3                CLR     C
0138 9B                SUBB    A,R3
0139 FF                MOV     R7,A
013A EE                MOV     A,R6
013B 9A                SUBB    A,R2
013C FE                MOV     R6,A
013D ED                MOV     A,R5
013E 99                SUBB    A,R1
013F FD                MOV     R5,A
0140 EC                MOV     A,R4
0141 98                SUBB    A,R0
0142 FC                MOV     R4,A
0143 900000      R     MOV     DPTR,#aux
0146 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 980
0149 E4                CLR     A
014A FF                MOV     R7,A
014B 7EC0              MOV     R6,#0C0H
014D FD                MOV     R5,A
014E FC                MOV     R4,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 95  

014F 900000      R     MOV     DPTR,#aux
0152 E0                MOVX    A,@DPTR
0153 F8                MOV     R0,A
0154 A3                INC     DPTR
0155 E0                MOVX    A,@DPTR
0156 F9                MOV     R1,A
0157 A3                INC     DPTR
0158 E0                MOVX    A,@DPTR
0159 FA                MOV     R2,A
015A A3                INC     DPTR
015B E0                MOVX    A,@DPTR
015C FB                MOV     R3,A
015D D3                SETB    C
015E 120000      E     LCALL   ?C?SLCMP
0161 4010              JC      ?C0171
                                           ; SOURCE LINE # 981
0163 7400        E     MOV     A,#LOW g_meas+014H
0165 2500        R     ADD     A,index
0167 F582              MOV     DPL,A
0169 E4                CLR     A
016A 3400        E     ADDC    A,#HIGH g_meas+014H
016C F583              MOV     DPH,A
016E E0                MOVX    A,@DPTR
016F 14                DEC     A
0170 F0                MOVX    @DPTR,A
0171 8068              SJMP    ?C0172
0173         ?C0171:
                                           ; SOURCE LINE # 982
                                           ; SOURCE LINE # 983
0173 7F00              MOV     R7,#00H
0175 7E40              MOV     R6,#040H
0177 7DFF              MOV     R5,#0FFH
0179 7CFF              MOV     R4,#0FFH
017B 900000      R     MOV     DPTR,#aux
017E E0                MOVX    A,@DPTR
017F F8                MOV     R0,A
0180 A3                INC     DPTR
0181 E0                MOVX    A,@DPTR
0182 F9                MOV     R1,A
0183 A3                INC     DPTR
0184 E0                MOVX    A,@DPTR
0185 FA                MOV     R2,A
0186 A3                INC     DPTR
0187 E0                MOVX    A,@DPTR
0188 FB                MOV     R3,A
0189 C3                CLR     C
018A 120000      E     LCALL   ?C?SLCMP
018D 5010              JNC     ?C0173
                                           ; SOURCE LINE # 984
018F 7400        E     MOV     A,#LOW g_meas+014H
0191 2500        R     ADD     A,index
0193 F582              MOV     DPL,A
0195 E4                CLR     A
0196 3400        E     ADDC    A,#HIGH g_meas+014H
0198 F583              MOV     DPH,A
019A E0                MOVX    A,@DPTR
019B 04                INC     A
019C F0                MOVX    @DPTR,A
019D 803C              SJMP    ?C0172
019F         ?C0173:
                                           ; SOURCE LINE # 985
                                           ; SOURCE LINE # 986
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 96  

019F 900000      R     MOV     DPTR,#aux
01A2 E0                MOVX    A,@DPTR
01A3 A3                INC     DPTR
01A4 E0                MOVX    A,@DPTR
01A5 A3                INC     DPTR
01A6 E0                MOVX    A,@DPTR
01A7 FE                MOV     R6,A
01A8 A3                INC     DPTR
01A9 E0                MOVX    A,@DPTR
01AA FF                MOV     R7,A
01AB 120000      E     LCALL   _abs
01AE D3                SETB    C
01AF EF                MOV     A,R7
01B0 9400              SUBB    A,#00H
01B2 EE                MOV     A,R6
01B3 6480              XRL     A,#080H
01B5 94C0              SUBB    A,#0C0H
01B7 4022              JC      ?C0172
                                           ; SOURCE LINE # 987
01B9 7400        R     MOV     A,#LOW error
01BB 2500        R     ADD     A,index
01BD F582              MOV     DPL,A
01BF E4                CLR     A
01C0 3400        R     ADDC    A,#HIGH error
01C2 F583              MOV     DPH,A
01C4 E0                MOVX    A,@DPTR
01C5 04                INC     A
01C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 988
01C7 7400        R     MOV     A,#LOW error
01C9 2500        R     ADD     A,index
01CB F582              MOV     DPL,A
01CD E4                CLR     A
01CE 3400        R     ADDC    A,#HIGH error
01D0 F583              MOV     DPH,A
01D2 E0                MOVX    A,@DPTR
01D3 C3                CLR     C
01D4 940A              SUBB    A,#0AH
01D6 5003              JNC     $ + 5H
01D8 020000      R     LJMP    ?C0160
01DB         ?C0176:
                                           ; SOURCE LINE # 991
                                           ; SOURCE LINE # 992
                                           ; SOURCE LINE # 993
01DB         ?C0172:
                                           ; SOURCE LINE # 995
01DB 7400        R     MOV     A,#LOW error
01DD 2500        R     ADD     A,index
01DF F582              MOV     DPL,A
01E1 E4                CLR     A
01E2 3400        R     ADDC    A,#HIGH error
01E4 F583              MOV     DPH,A
01E6 E4                CLR     A
01E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 997
01E8 900000      R     MOV     DPTR,#value_encoder
01EB E0                MOVX    A,@DPTR
01EC FC                MOV     R4,A
01ED A3                INC     DPTR
01EE E0                MOVX    A,@DPTR
01EF FD                MOV     R5,A
01F0 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 97  

01F1 E0                MOVX    A,@DPTR
01F2 FE                MOV     R6,A
01F3 A3                INC     DPTR
01F4 E0                MOVX    A,@DPTR
01F5 FF                MOV     R7,A
01F6 E500        R     MOV     A,index
01F8 25E0              ADD     A,ACC
01FA 25E0              ADD     A,ACC
01FC 2400        R     ADD     A,#LOW last_value_encoder
01FE F582              MOV     DPL,A
0200 E4                CLR     A
0201 3400        R     ADDC    A,#HIGH last_value_encoder
0203 F583              MOV     DPH,A
0205 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 999
0208 900000      R     MOV     DPTR,#value_encoder
020B E0                MOVX    A,@DPTR
020C F8                MOV     R0,A
020D A3                INC     DPTR
020E E0                MOVX    A,@DPTR
020F F9                MOV     R1,A
0210 A3                INC     DPTR
0211 E0                MOVX    A,@DPTR
0212 FA                MOV     R2,A
0213 A3                INC     DPTR
0214 E0                MOVX    A,@DPTR
0215 FB                MOV     R3,A
0216 C000              PUSH    AR0
0218 7400        E     MOV     A,#LOW g_meas+014H
021A 2500        R     ADD     A,index
021C F582              MOV     DPL,A
021E E4                CLR     A
021F 3400        E     ADDC    A,#HIGH g_meas+014H
0221 F583              MOV     DPH,A
0223 E0                MOVX    A,@DPTR
0224 FF                MOV     R7,A
0225 33                RLC     A
0226 95E0              SUBB    A,ACC
0228 FE                MOV     R6,A
0229 FD                MOV     R5,A
022A FC                MOV     R4,A
022B 7810              MOV     R0,#010H
022D 120000      E     LCALL   ?C?LSHL
0230 D000              POP     AR0
0232 EB                MOV     A,R3
0233 2F                ADD     A,R7
0234 FF                MOV     R7,A
0235 EA                MOV     A,R2
0236 3E                ADDC    A,R6
0237 FE                MOV     R6,A
0238 E9                MOV     A,R1
0239 3D                ADDC    A,R5
023A FD                MOV     R5,A
023B E8                MOV     A,R0
023C 3C                ADDC    A,R4
023D FC                MOV     R4,A
023E 900000      R     MOV     DPTR,#value_encoder
0241 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1001
0244 E500        R     MOV     A,index
0246 25E0              ADD     A,ACC
0248 25E0              ADD     A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 98  

024A 2400        E     ADD     A,#LOW c_mem+044H
024C F582              MOV     DPL,A
024E E4                CLR     A
024F 3400        E     ADDC    A,#HIGH c_mem+044H
0251 F583              MOV     DPH,A
0253 E0                MOVX    A,@DPTR
0254 FC                MOV     R4,A
0255 A3                INC     DPTR
0256 E0                MOVX    A,@DPTR
0257 FD                MOV     R5,A
0258 A3                INC     DPTR
0259 E0                MOVX    A,@DPTR
025A FE                MOV     R6,A
025B A3                INC     DPTR
025C E0                MOVX    A,@DPTR
025D FF                MOV     R7,A
025E E4                CLR     A
025F FB                MOV     R3,A
0260 FA                MOV     R2,A
0261 7980              MOV     R1,#080H
0263 783F              MOV     R0,#03FH
0265 120000      E     LCALL   ?C?FPCMP3
0268 6038              JZ      ?C0177
                                           ; SOURCE LINE # 1002
026A 900000      R     MOV     DPTR,#value_encoder
026D E0                MOVX    A,@DPTR
026E FC                MOV     R4,A
026F A3                INC     DPTR
0270 E0                MOVX    A,@DPTR
0271 FD                MOV     R5,A
0272 A3                INC     DPTR
0273 E0                MOVX    A,@DPTR
0274 FE                MOV     R6,A
0275 A3                INC     DPTR
0276 E0                MOVX    A,@DPTR
0277 FF                MOV     R7,A
0278 EC                MOV     A,R4
0279 120000      E     LCALL   ?C?FCASTL
027C E500        R     MOV     A,index
027E 25E0              ADD     A,ACC
0280 25E0              ADD     A,ACC
0282 2400        E     ADD     A,#LOW c_mem+044H
0284 F582              MOV     DPL,A
0286 E4                CLR     A
0287 3400        E     ADDC    A,#HIGH c_mem+044H
0289 F583              MOV     DPH,A
028B E0                MOVX    A,@DPTR
028C F8                MOV     R0,A
028D A3                INC     DPTR
028E E0                MOVX    A,@DPTR
028F F9                MOV     R1,A
0290 A3                INC     DPTR
0291 E0                MOVX    A,@DPTR
0292 FA                MOV     R2,A
0293 A3                INC     DPTR
0294 E0                MOVX    A,@DPTR
0295 FB                MOV     R3,A
0296 120000      E     LCALL   ?C?FPMUL
0299 120000      E     LCALL   ?C?CASTF
029C 900000      R     MOV     DPTR,#value_encoder
029F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1003
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 99  

02A2         ?C0177:
                                           ; SOURCE LINE # 1005
02A2 900000      R     MOV     DPTR,#value_encoder
02A5 E0                MOVX    A,@DPTR
02A6 FC                MOV     R4,A
02A7 A3                INC     DPTR
02A8 E0                MOVX    A,@DPTR
02A9 FD                MOV     R5,A
02AA A3                INC     DPTR
02AB E0                MOVX    A,@DPTR
02AC FE                MOV     R6,A
02AD A3                INC     DPTR
02AE E0                MOVX    A,@DPTR
02AF FF                MOV     R7,A
02B0 E500        R     MOV     A,index
02B2 25E0              ADD     A,ACC
02B4 25E0              ADD     A,ACC
02B6 2400        E     ADD     A,#LOW g_meas
02B8 F582              MOV     DPL,A
02BA E4                CLR     A
02BB 3400        E     ADDC    A,#HIGH g_meas
02BD F583              MOV     DPH,A
02BF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1006
02C2         ?C0168:
                                           ; SOURCE LINE # 1008
02C2 E500        R     MOV     A,index
02C4 14                DEC     A
02C5 7003              JNZ     $ + 5H
02C7 020000      R     LJMP    ?C0180
02CA 14                DEC     A
02CB 7003              JNZ     $ + 5H
02CD 020000      R     LJMP    ?C0181
02D0 2402              ADD     A,#02H
02D2 6003              JZ      $ + 5H
02D4 020000      R     LJMP    ?C0178
                                           ; SOURCE LINE # 1009
02D7         ?C0179:
                                           ; SOURCE LINE # 1010
02D7 E4                CLR     A
02D8 7F03              MOV     R7,#03H
02DA FE                MOV     R6,A
02DB FD                MOV     R5,A
02DC FC                MOV     R4,A
02DD 900000      R     MOV     DPTR,#value_encoder
02E0 E0                MOVX    A,@DPTR
02E1 F8                MOV     R0,A
02E2 A3                INC     DPTR
02E3 E0                MOVX    A,@DPTR
02E4 F9                MOV     R1,A
02E5 A3                INC     DPTR
02E6 E0                MOVX    A,@DPTR
02E7 FA                MOV     R2,A
02E8 A3                INC     DPTR
02E9 E0                MOVX    A,@DPTR
02EA FB                MOV     R3,A
02EB 120000      E     LCALL   ?C?LMUL
02EE 900000      R     MOV     DPTR,#v_value
02F1 E0                MOVX    A,@DPTR
02F2 F8                MOV     R0,A
02F3 A3                INC     DPTR
02F4 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 100 

02F5 F9                MOV     R1,A
02F6 A3                INC     DPTR
02F7 E0                MOVX    A,@DPTR
02F8 FA                MOV     R2,A
02F9 A3                INC     DPTR
02FA E0                MOVX    A,@DPTR
02FB 2F                ADD     A,R7
02FC FF                MOV     R7,A
02FD EA                MOV     A,R2
02FE 3E                ADDC    A,R6
02FF FE                MOV     R6,A
0300 E9                MOV     A,R1
0301 3D                ADDC    A,R5
0302 FD                MOV     R5,A
0303 E8                MOV     A,R0
0304 3C                ADDC    A,R4
0305 FC                MOV     R4,A
0306 900000      R     MOV     DPTR,#vv_value
0309 E0                MOVX    A,@DPTR
030A F8                MOV     R0,A
030B A3                INC     DPTR
030C E0                MOVX    A,@DPTR
030D F9                MOV     R1,A
030E A3                INC     DPTR
030F E0                MOVX    A,@DPTR
0310 FA                MOV     R2,A
0311 A3                INC     DPTR
0312 E0                MOVX    A,@DPTR
0313 FB                MOV     R3,A
0314 C3                CLR     C
0315 EF                MOV     A,R7
0316 9B                SUBB    A,R3
0317 FF                MOV     R7,A
0318 EE                MOV     A,R6
0319 9A                SUBB    A,R2
031A FE                MOV     R6,A
031B ED                MOV     A,R5
031C 99                SUBB    A,R1
031D FD                MOV     R5,A
031E EC                MOV     A,R4
031F 98                SUBB    A,R0
0320 FC                MOV     R4,A
0321 C004              PUSH    AR4
0323 C005              PUSH    AR5
0325 C006              PUSH    AR6
0327 C007              PUSH    AR7
0329 E4                CLR     A
032A 7F03              MOV     R7,#03H
032C FE                MOV     R6,A
032D FD                MOV     R5,A
032E FC                MOV     R4,A
032F 900000      R     MOV     DPTR,#vvv_value
0332 E0                MOVX    A,@DPTR
0333 F8                MOV     R0,A
0334 A3                INC     DPTR
0335 E0                MOVX    A,@DPTR
0336 F9                MOV     R1,A
0337 A3                INC     DPTR
0338 E0                MOVX    A,@DPTR
0339 FA                MOV     R2,A
033A A3                INC     DPTR
033B E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 101 

033C FB                MOV     R3,A
033D 120000      E     LCALL   ?C?LMUL
0340 A804              MOV     R0,AR4
0342 A905              MOV     R1,AR5
0344 AA06              MOV     R2,AR6
0346 AB07              MOV     R3,AR7
0348 D007              POP     AR7
034A D006              POP     AR6
034C D005              POP     AR5
034E D004              POP     AR4
0350 C3                CLR     C
0351 EF                MOV     A,R7
0352 9B                SUBB    A,R3
0353 FF                MOV     R7,A
0354 EE                MOV     A,R6
0355 9A                SUBB    A,R2
0356 FE                MOV     R6,A
0357 ED                MOV     A,R5
0358 99                SUBB    A,R1
0359 FD                MOV     R5,A
035A EC                MOV     A,R4
035B 98                SUBB    A,R0
035C FC                MOV     R4,A
035D E4                CLR     A
035E 7B0A              MOV     R3,#0AH
0360 FA                MOV     R2,A
0361 F9                MOV     R1,A
0362 F8                MOV     R0,A
0363 120000      E     LCALL   ?C?LMUL
0366 120000      E     LCALL   _filter_vel_1
0369 EE                MOV     A,R6
036A 33                RLC     A
036B 95E0              SUBB    A,ACC
036D FD                MOV     R5,A
036E FC                MOV     R4,A
036F 900000      R     MOV     DPTR,#speed_encoder
0372 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1011
0375 020000      R     LJMP    ?C0178
                                           ; SOURCE LINE # 1012
                                           ; SOURCE LINE # 1013
0378         ?C0180:
                                           ; SOURCE LINE # 1014
0378 E4                CLR     A
0379 7F03              MOV     R7,#03H
037B FE                MOV     R6,A
037C FD                MOV     R5,A
037D FC                MOV     R4,A
037E 900000      R     MOV     DPTR,#value_encoder
0381 E0                MOVX    A,@DPTR
0382 F8                MOV     R0,A
0383 A3                INC     DPTR
0384 E0                MOVX    A,@DPTR
0385 F9                MOV     R1,A
0386 A3                INC     DPTR
0387 E0                MOVX    A,@DPTR
0388 FA                MOV     R2,A
0389 A3                INC     DPTR
038A E0                MOVX    A,@DPTR
038B FB                MOV     R3,A
038C 120000      E     LCALL   ?C?LMUL
038F 900000      R     MOV     DPTR,#v_value+04H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 102 

0392 E0                MOVX    A,@DPTR
0393 F8                MOV     R0,A
0394 A3                INC     DPTR
0395 E0                MOVX    A,@DPTR
0396 F9                MOV     R1,A
0397 A3                INC     DPTR
0398 E0                MOVX    A,@DPTR
0399 FA                MOV     R2,A
039A A3                INC     DPTR
039B E0                MOVX    A,@DPTR
039C 2F                ADD     A,R7
039D FF                MOV     R7,A
039E EA                MOV     A,R2
039F 3E                ADDC    A,R6
03A0 FE                MOV     R6,A
03A1 E9                MOV     A,R1
03A2 3D                ADDC    A,R5
03A3 FD                MOV     R5,A
03A4 E8                MOV     A,R0
03A5 3C                ADDC    A,R4
03A6 FC                MOV     R4,A
03A7 900000      R     MOV     DPTR,#vv_value+04H
03AA E0                MOVX    A,@DPTR
03AB F8                MOV     R0,A
03AC A3                INC     DPTR
03AD E0                MOVX    A,@DPTR
03AE F9                MOV     R1,A
03AF A3                INC     DPTR
03B0 E0                MOVX    A,@DPTR
03B1 FA                MOV     R2,A
03B2 A3                INC     DPTR
03B3 E0                MOVX    A,@DPTR
03B4 FB                MOV     R3,A
03B5 C3                CLR     C
03B6 EF                MOV     A,R7
03B7 9B                SUBB    A,R3
03B8 FF                MOV     R7,A
03B9 EE                MOV     A,R6
03BA 9A                SUBB    A,R2
03BB FE                MOV     R6,A
03BC ED                MOV     A,R5
03BD 99                SUBB    A,R1
03BE FD                MOV     R5,A
03BF EC                MOV     A,R4
03C0 98                SUBB    A,R0
03C1 FC                MOV     R4,A
03C2 C004              PUSH    AR4
03C4 C005              PUSH    AR5
03C6 C006              PUSH    AR6
03C8 C007              PUSH    AR7
03CA E4                CLR     A
03CB 7F03              MOV     R7,#03H
03CD FE                MOV     R6,A
03CE FD                MOV     R5,A
03CF FC                MOV     R4,A
03D0 900000      R     MOV     DPTR,#vvv_value+04H
03D3 E0                MOVX    A,@DPTR
03D4 F8                MOV     R0,A
03D5 A3                INC     DPTR
03D6 E0                MOVX    A,@DPTR
03D7 F9                MOV     R1,A
03D8 A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 103 

03D9 E0                MOVX    A,@DPTR
03DA FA                MOV     R2,A
03DB A3                INC     DPTR
03DC E0                MOVX    A,@DPTR
03DD FB                MOV     R3,A
03DE 120000      E     LCALL   ?C?LMUL
03E1 A804              MOV     R0,AR4
03E3 A905              MOV     R1,AR5
03E5 AA06              MOV     R2,AR6
03E7 AB07              MOV     R3,AR7
03E9 D007              POP     AR7
03EB D006              POP     AR6
03ED D005              POP     AR5
03EF D004              POP     AR4
03F1 C3                CLR     C
03F2 EF                MOV     A,R7
03F3 9B                SUBB    A,R3
03F4 FF                MOV     R7,A
03F5 EE                MOV     A,R6
03F6 9A                SUBB    A,R2
03F7 FE                MOV     R6,A
03F8 ED                MOV     A,R5
03F9 99                SUBB    A,R1
03FA FD                MOV     R5,A
03FB EC                MOV     A,R4
03FC 98                SUBB    A,R0
03FD FC                MOV     R4,A
03FE E4                CLR     A
03FF 7B0A              MOV     R3,#0AH
0401 FA                MOV     R2,A
0402 F9                MOV     R1,A
0403 F8                MOV     R0,A
0404 120000      E     LCALL   ?C?LMUL
0407 120000      E     LCALL   _filter_vel_2
040A EE                MOV     A,R6
040B 33                RLC     A
040C 95E0              SUBB    A,ACC
040E FD                MOV     R5,A
040F FC                MOV     R4,A
0410 900000      R     MOV     DPTR,#speed_encoder
0413 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1015
0416 020000      R     LJMP    ?C0178
                                           ; SOURCE LINE # 1016
                                           ; SOURCE LINE # 1017
0419         ?C0181:
                                           ; SOURCE LINE # 1018
0419 E4                CLR     A
041A 7F03              MOV     R7,#03H
041C FE                MOV     R6,A
041D FD                MOV     R5,A
041E FC                MOV     R4,A
041F 900000      R     MOV     DPTR,#value_encoder
0422 E0                MOVX    A,@DPTR
0423 F8                MOV     R0,A
0424 A3                INC     DPTR
0425 E0                MOVX    A,@DPTR
0426 F9                MOV     R1,A
0427 A3                INC     DPTR
0428 E0                MOVX    A,@DPTR
0429 FA                MOV     R2,A
042A A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 104 

042B E0                MOVX    A,@DPTR
042C FB                MOV     R3,A
042D 120000      E     LCALL   ?C?LMUL
0430 900000      R     MOV     DPTR,#v_value+08H
0433 E0                MOVX    A,@DPTR
0434 F8                MOV     R0,A
0435 A3                INC     DPTR
0436 E0                MOVX    A,@DPTR
0437 F9                MOV     R1,A
0438 A3                INC     DPTR
0439 E0                MOVX    A,@DPTR
043A FA                MOV     R2,A
043B A3                INC     DPTR
043C E0                MOVX    A,@DPTR
043D 2F                ADD     A,R7
043E FF                MOV     R7,A
043F EA                MOV     A,R2
0440 3E                ADDC    A,R6
0441 FE                MOV     R6,A
0442 E9                MOV     A,R1
0443 3D                ADDC    A,R5
0444 FD                MOV     R5,A
0445 E8                MOV     A,R0
0446 3C                ADDC    A,R4
0447 FC                MOV     R4,A
0448 900000      R     MOV     DPTR,#vv_value+08H
044B E0                MOVX    A,@DPTR
044C F8                MOV     R0,A
044D A3                INC     DPTR
044E E0                MOVX    A,@DPTR
044F F9                MOV     R1,A
0450 A3                INC     DPTR
0451 E0                MOVX    A,@DPTR
0452 FA                MOV     R2,A
0453 A3                INC     DPTR
0454 E0                MOVX    A,@DPTR
0455 FB                MOV     R3,A
0456 C3                CLR     C
0457 EF                MOV     A,R7
0458 9B                SUBB    A,R3
0459 FF                MOV     R7,A
045A EE                MOV     A,R6
045B 9A                SUBB    A,R2
045C FE                MOV     R6,A
045D ED                MOV     A,R5
045E 99                SUBB    A,R1
045F FD                MOV     R5,A
0460 EC                MOV     A,R4
0461 98                SUBB    A,R0
0462 FC                MOV     R4,A
0463 C004              PUSH    AR4
0465 C005              PUSH    AR5
0467 C006              PUSH    AR6
0469 C007              PUSH    AR7
046B E4                CLR     A
046C 7F03              MOV     R7,#03H
046E FE                MOV     R6,A
046F FD                MOV     R5,A
0470 FC                MOV     R4,A
0471 900000      R     MOV     DPTR,#vvv_value+08H
0474 E0                MOVX    A,@DPTR
0475 F8                MOV     R0,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 105 

0476 A3                INC     DPTR
0477 E0                MOVX    A,@DPTR
0478 F9                MOV     R1,A
0479 A3                INC     DPTR
047A E0                MOVX    A,@DPTR
047B FA                MOV     R2,A
047C A3                INC     DPTR
047D E0                MOVX    A,@DPTR
047E FB                MOV     R3,A
047F 120000      E     LCALL   ?C?LMUL
0482 A804              MOV     R0,AR4
0484 A905              MOV     R1,AR5
0486 AA06              MOV     R2,AR6
0488 AB07              MOV     R3,AR7
048A D007              POP     AR7
048C D006              POP     AR6
048E D005              POP     AR5
0490 D004              POP     AR4
0492 C3                CLR     C
0493 EF                MOV     A,R7
0494 9B                SUBB    A,R3
0495 FF                MOV     R7,A
0496 EE                MOV     A,R6
0497 9A                SUBB    A,R2
0498 FE                MOV     R6,A
0499 ED                MOV     A,R5
049A 99                SUBB    A,R1
049B FD                MOV     R5,A
049C EC                MOV     A,R4
049D 98                SUBB    A,R0
049E FC                MOV     R4,A
049F E4                CLR     A
04A0 7B0A              MOV     R3,#0AH
04A2 FA                MOV     R2,A
04A3 F9                MOV     R1,A
04A4 F8                MOV     R0,A
04A5 120000      E     LCALL   ?C?LMUL
04A8 120000      E     LCALL   _filter_vel_3
04AB EE                MOV     A,R6
04AC 33                RLC     A
04AD 95E0              SUBB    A,ACC
04AF FD                MOV     R5,A
04B0 FC                MOV     R4,A
04B1 900000      R     MOV     DPTR,#speed_encoder
04B4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1019
                                           ; SOURCE LINE # 1020
                                           ; SOURCE LINE # 1021
04B7         ?C0178:
                                           ; SOURCE LINE # 1023
04B7 900000      R     MOV     DPTR,#speed_encoder
04BA E0                MOVX    A,@DPTR
04BB FC                MOV     R4,A
04BC A3                INC     DPTR
04BD E0                MOVX    A,@DPTR
04BE FD                MOV     R5,A
04BF A3                INC     DPTR
04C0 E0                MOVX    A,@DPTR
04C1 FE                MOV     R6,A
04C2 A3                INC     DPTR
04C3 E0                MOVX    A,@DPTR
04C4 FF                MOV     R7,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 106 

04C5 E500        R     MOV     A,index
04C7 25E0              ADD     A,ACC
04C9 25E0              ADD     A,ACC
04CB 2400        E     ADD     A,#LOW g_meas+01FH
04CD F582              MOV     DPL,A
04CF E4                CLR     A
04D0 3400        E     ADDC    A,#HIGH g_meas+01FH
04D2 F583              MOV     DPH,A
04D4 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1026
04D7 E500        R     MOV     A,index
04D9 14                DEC     A
04DA 7003              JNZ     $ + 5H
04DC 020000      R     LJMP    ?C0184
04DF 14                DEC     A
04E0 7003              JNZ     $ + 5H
04E2 020000      R     LJMP    ?C0185
04E5 2402              ADD     A,#02H
04E7 6003              JZ      $ + 5H
04E9 020000      R     LJMP    ?C0182
                                           ; SOURCE LINE # 1027
04EC         ?C0183:
                                           ; SOURCE LINE # 1028
04EC E4                CLR     A
04ED 7F03              MOV     R7,#03H
04EF FE                MOV     R6,A
04F0 FD                MOV     R5,A
04F1 FC                MOV     R4,A
04F2 900000      R     MOV     DPTR,#speed_encoder
04F5 E0                MOVX    A,@DPTR
04F6 F8                MOV     R0,A
04F7 A3                INC     DPTR
04F8 E0                MOVX    A,@DPTR
04F9 F9                MOV     R1,A
04FA A3                INC     DPTR
04FB E0                MOVX    A,@DPTR
04FC FA                MOV     R2,A
04FD A3                INC     DPTR
04FE E0                MOVX    A,@DPTR
04FF FB                MOV     R3,A
0500 120000      E     LCALL   ?C?LMUL
0503 900000      R     MOV     DPTR,#a_value
0506 E0                MOVX    A,@DPTR
0507 F8                MOV     R0,A
0508 A3                INC     DPTR
0509 E0                MOVX    A,@DPTR
050A F9                MOV     R1,A
050B A3                INC     DPTR
050C E0                MOVX    A,@DPTR
050D FA                MOV     R2,A
050E A3                INC     DPTR
050F E0                MOVX    A,@DPTR
0510 2F                ADD     A,R7
0511 FF                MOV     R7,A
0512 EA                MOV     A,R2
0513 3E                ADDC    A,R6
0514 FE                MOV     R6,A
0515 E9                MOV     A,R1
0516 3D                ADDC    A,R5
0517 FD                MOV     R5,A
0518 E8                MOV     A,R0
0519 3C                ADDC    A,R4
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 107 

051A FC                MOV     R4,A
051B 900000      R     MOV     DPTR,#aa_value
051E E0                MOVX    A,@DPTR
051F F8                MOV     R0,A
0520 A3                INC     DPTR
0521 E0                MOVX    A,@DPTR
0522 F9                MOV     R1,A
0523 A3                INC     DPTR
0524 E0                MOVX    A,@DPTR
0525 FA                MOV     R2,A
0526 A3                INC     DPTR
0527 E0                MOVX    A,@DPTR
0528 FB                MOV     R3,A
0529 C3                CLR     C
052A EF                MOV     A,R7
052B 9B                SUBB    A,R3
052C FF                MOV     R7,A
052D EE                MOV     A,R6
052E 9A                SUBB    A,R2
052F FE                MOV     R6,A
0530 ED                MOV     A,R5
0531 99                SUBB    A,R1
0532 FD                MOV     R5,A
0533 EC                MOV     A,R4
0534 98                SUBB    A,R0
0535 FC                MOV     R4,A
0536 C004              PUSH    AR4
0538 C005              PUSH    AR5
053A C006              PUSH    AR6
053C C007              PUSH    AR7
053E E4                CLR     A
053F 7F03              MOV     R7,#03H
0541 FE                MOV     R6,A
0542 FD                MOV     R5,A
0543 FC                MOV     R4,A
0544 900000      R     MOV     DPTR,#aaa_value
0547 E0                MOVX    A,@DPTR
0548 F8                MOV     R0,A
0549 A3                INC     DPTR
054A E0                MOVX    A,@DPTR
054B F9                MOV     R1,A
054C A3                INC     DPTR
054D E0                MOVX    A,@DPTR
054E FA                MOV     R2,A
054F A3                INC     DPTR
0550 E0                MOVX    A,@DPTR
0551 FB                MOV     R3,A
0552 120000      E     LCALL   ?C?LMUL
0555 A804              MOV     R0,AR4
0557 A905              MOV     R1,AR5
0559 AA06              MOV     R2,AR6
055B AB07              MOV     R3,AR7
055D D007              POP     AR7
055F D006              POP     AR6
0561 D005              POP     AR5
0563 D004              POP     AR4
0565 C3                CLR     C
0566 EF                MOV     A,R7
0567 9B                SUBB    A,R3
0568 FF                MOV     R7,A
0569 EE                MOV     A,R6
056A 9A                SUBB    A,R2
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 108 

056B FE                MOV     R6,A
056C ED                MOV     A,R5
056D 99                SUBB    A,R1
056E FD                MOV     R5,A
056F EC                MOV     A,R4
0570 98                SUBB    A,R0
0571 FC                MOV     R4,A
0572 E4                CLR     A
0573 7B0A              MOV     R3,#0AH
0575 FA                MOV     R2,A
0576 F9                MOV     R1,A
0577 F8                MOV     R0,A
0578 120000      E     LCALL   ?C?LMUL
057B 120000      E     LCALL   _filter_acc_1
057E EE                MOV     A,R6
057F 33                RLC     A
0580 95E0              SUBB    A,ACC
0582 FD                MOV     R5,A
0583 FC                MOV     R4,A
0584 900000      R     MOV     DPTR,#accel_encoder
0587 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1029
058A 020000      R     LJMP    ?C0182
                                           ; SOURCE LINE # 1031
058D         ?C0184:
                                           ; SOURCE LINE # 1032
058D E4                CLR     A
058E 7F03              MOV     R7,#03H
0590 FE                MOV     R6,A
0591 FD                MOV     R5,A
0592 FC                MOV     R4,A
0593 900000      R     MOV     DPTR,#speed_encoder
0596 E0                MOVX    A,@DPTR
0597 F8                MOV     R0,A
0598 A3                INC     DPTR
0599 E0                MOVX    A,@DPTR
059A F9                MOV     R1,A
059B A3                INC     DPTR
059C E0                MOVX    A,@DPTR
059D FA                MOV     R2,A
059E A3                INC     DPTR
059F E0                MOVX    A,@DPTR
05A0 FB                MOV     R3,A
05A1 120000      E     LCALL   ?C?LMUL
05A4 900000      R     MOV     DPTR,#a_value+04H
05A7 E0                MOVX    A,@DPTR
05A8 F8                MOV     R0,A
05A9 A3                INC     DPTR
05AA E0                MOVX    A,@DPTR
05AB F9                MOV     R1,A
05AC A3                INC     DPTR
05AD E0                MOVX    A,@DPTR
05AE FA                MOV     R2,A
05AF A3                INC     DPTR
05B0 E0                MOVX    A,@DPTR
05B1 2F                ADD     A,R7
05B2 FF                MOV     R7,A
05B3 EA                MOV     A,R2
05B4 3E                ADDC    A,R6
05B5 FE                MOV     R6,A
05B6 E9                MOV     A,R1
05B7 3D                ADDC    A,R5
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 109 

05B8 FD                MOV     R5,A
05B9 E8                MOV     A,R0
05BA 3C                ADDC    A,R4
05BB FC                MOV     R4,A
05BC 900000      R     MOV     DPTR,#aa_value+04H
05BF E0                MOVX    A,@DPTR
05C0 F8                MOV     R0,A
05C1 A3                INC     DPTR
05C2 E0                MOVX    A,@DPTR
05C3 F9                MOV     R1,A
05C4 A3                INC     DPTR
05C5 E0                MOVX    A,@DPTR
05C6 FA                MOV     R2,A
05C7 A3                INC     DPTR
05C8 E0                MOVX    A,@DPTR
05C9 FB                MOV     R3,A
05CA C3                CLR     C
05CB EF                MOV     A,R7
05CC 9B                SUBB    A,R3
05CD FF                MOV     R7,A
05CE EE                MOV     A,R6
05CF 9A                SUBB    A,R2
05D0 FE                MOV     R6,A
05D1 ED                MOV     A,R5
05D2 99                SUBB    A,R1
05D3 FD                MOV     R5,A
05D4 EC                MOV     A,R4
05D5 98                SUBB    A,R0
05D6 FC                MOV     R4,A
05D7 C004              PUSH    AR4
05D9 C005              PUSH    AR5
05DB C006              PUSH    AR6
05DD C007              PUSH    AR7
05DF E4                CLR     A
05E0 7F03              MOV     R7,#03H
05E2 FE                MOV     R6,A
05E3 FD                MOV     R5,A
05E4 FC                MOV     R4,A
05E5 900000      R     MOV     DPTR,#aaa_value+04H
05E8 E0                MOVX    A,@DPTR
05E9 F8                MOV     R0,A
05EA A3                INC     DPTR
05EB E0                MOVX    A,@DPTR
05EC F9                MOV     R1,A
05ED A3                INC     DPTR
05EE E0                MOVX    A,@DPTR
05EF FA                MOV     R2,A
05F0 A3                INC     DPTR
05F1 E0                MOVX    A,@DPTR
05F2 FB                MOV     R3,A
05F3 120000      E     LCALL   ?C?LMUL
05F6 A804              MOV     R0,AR4
05F8 A905              MOV     R1,AR5
05FA AA06              MOV     R2,AR6
05FC AB07              MOV     R3,AR7
05FE D007              POP     AR7
0600 D006              POP     AR6
0602 D005              POP     AR5
0604 D004              POP     AR4
0606 C3                CLR     C
0607 EF                MOV     A,R7
0608 9B                SUBB    A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 110 

0609 FF                MOV     R7,A
060A EE                MOV     A,R6
060B 9A                SUBB    A,R2
060C FE                MOV     R6,A
060D ED                MOV     A,R5
060E 99                SUBB    A,R1
060F FD                MOV     R5,A
0610 EC                MOV     A,R4
0611 98                SUBB    A,R0
0612 FC                MOV     R4,A
0613 E4                CLR     A
0614 7B0A              MOV     R3,#0AH
0616 FA                MOV     R2,A
0617 F9                MOV     R1,A
0618 F8                MOV     R0,A
0619 120000      E     LCALL   ?C?LMUL
061C 120000      E     LCALL   _filter_acc_2
061F EE                MOV     A,R6
0620 33                RLC     A
0621 95E0              SUBB    A,ACC
0623 FD                MOV     R5,A
0624 FC                MOV     R4,A
0625 900000      R     MOV     DPTR,#accel_encoder
0628 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1033
062B 020000      R     LJMP    ?C0182
                                           ; SOURCE LINE # 1035
062E         ?C0185:
                                           ; SOURCE LINE # 1036
062E E4                CLR     A
062F 7F03              MOV     R7,#03H
0631 FE                MOV     R6,A
0632 FD                MOV     R5,A
0633 FC                MOV     R4,A
0634 900000      R     MOV     DPTR,#speed_encoder
0637 E0                MOVX    A,@DPTR
0638 F8                MOV     R0,A
0639 A3                INC     DPTR
063A E0                MOVX    A,@DPTR
063B F9                MOV     R1,A
063C A3                INC     DPTR
063D E0                MOVX    A,@DPTR
063E FA                MOV     R2,A
063F A3                INC     DPTR
0640 E0                MOVX    A,@DPTR
0641 FB                MOV     R3,A
0642 120000      E     LCALL   ?C?LMUL
0645 900000      R     MOV     DPTR,#a_value+08H
0648 E0                MOVX    A,@DPTR
0649 F8                MOV     R0,A
064A A3                INC     DPTR
064B E0                MOVX    A,@DPTR
064C F9                MOV     R1,A
064D A3                INC     DPTR
064E E0                MOVX    A,@DPTR
064F FA                MOV     R2,A
0650 A3                INC     DPTR
0651 E0                MOVX    A,@DPTR
0652 2F                ADD     A,R7
0653 FF                MOV     R7,A
0654 EA                MOV     A,R2
0655 3E                ADDC    A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 111 

0656 FE                MOV     R6,A
0657 E9                MOV     A,R1
0658 3D                ADDC    A,R5
0659 FD                MOV     R5,A
065A E8                MOV     A,R0
065B 3C                ADDC    A,R4
065C FC                MOV     R4,A
065D 900000      R     MOV     DPTR,#aa_value+08H
0660 E0                MOVX    A,@DPTR
0661 F8                MOV     R0,A
0662 A3                INC     DPTR
0663 E0                MOVX    A,@DPTR
0664 F9                MOV     R1,A
0665 A3                INC     DPTR
0666 E0                MOVX    A,@DPTR
0667 FA                MOV     R2,A
0668 A3                INC     DPTR
0669 E0                MOVX    A,@DPTR
066A FB                MOV     R3,A
066B C3                CLR     C
066C EF                MOV     A,R7
066D 9B                SUBB    A,R3
066E FF                MOV     R7,A
066F EE                MOV     A,R6
0670 9A                SUBB    A,R2
0671 FE                MOV     R6,A
0672 ED                MOV     A,R5
0673 99                SUBB    A,R1
0674 FD                MOV     R5,A
0675 EC                MOV     A,R4
0676 98                SUBB    A,R0
0677 FC                MOV     R4,A
0678 C004              PUSH    AR4
067A C005              PUSH    AR5
067C C006              PUSH    AR6
067E C007              PUSH    AR7
0680 E4                CLR     A
0681 7F03              MOV     R7,#03H
0683 FE                MOV     R6,A
0684 FD                MOV     R5,A
0685 FC                MOV     R4,A
0686 900000      R     MOV     DPTR,#aaa_value+08H
0689 E0                MOVX    A,@DPTR
068A F8                MOV     R0,A
068B A3                INC     DPTR
068C E0                MOVX    A,@DPTR
068D F9                MOV     R1,A
068E A3                INC     DPTR
068F E0                MOVX    A,@DPTR
0690 FA                MOV     R2,A
0691 A3                INC     DPTR
0692 E0                MOVX    A,@DPTR
0693 FB                MOV     R3,A
0694 120000      E     LCALL   ?C?LMUL
0697 A804              MOV     R0,AR4
0699 A905              MOV     R1,AR5
069B AA06              MOV     R2,AR6
069D AB07              MOV     R3,AR7
069F D007              POP     AR7
06A1 D006              POP     AR6
06A3 D005              POP     AR5
06A5 D004              POP     AR4
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 112 

06A7 C3                CLR     C
06A8 EF                MOV     A,R7
06A9 9B                SUBB    A,R3
06AA FF                MOV     R7,A
06AB EE                MOV     A,R6
06AC 9A                SUBB    A,R2
06AD FE                MOV     R6,A
06AE ED                MOV     A,R5
06AF 99                SUBB    A,R1
06B0 FD                MOV     R5,A
06B1 EC                MOV     A,R4
06B2 98                SUBB    A,R0
06B3 FC                MOV     R4,A
06B4 E4                CLR     A
06B5 7B0A              MOV     R3,#0AH
06B7 FA                MOV     R2,A
06B8 F9                MOV     R1,A
06B9 F8                MOV     R0,A
06BA 120000      E     LCALL   ?C?LMUL
06BD 120000      E     LCALL   _filter_acc_3
06C0 EE                MOV     A,R6
06C1 33                RLC     A
06C2 95E0              SUBB    A,ACC
06C4 FD                MOV     R5,A
06C5 FC                MOV     R4,A
06C6 900000      R     MOV     DPTR,#accel_encoder
06C9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1037
                                           ; SOURCE LINE # 1038
06CC         ?C0182:
                                           ; SOURCE LINE # 1040
06CC 900000      R     MOV     DPTR,#accel_encoder
06CF E0                MOVX    A,@DPTR
06D0 FC                MOV     R4,A
06D1 A3                INC     DPTR
06D2 E0                MOVX    A,@DPTR
06D3 FD                MOV     R5,A
06D4 A3                INC     DPTR
06D5 E0                MOVX    A,@DPTR
06D6 FE                MOV     R6,A
06D7 A3                INC     DPTR
06D8 E0                MOVX    A,@DPTR
06D9 FF                MOV     R7,A
06DA E500        R     MOV     A,index
06DC 25E0              ADD     A,ACC
06DE 25E0              ADD     A,ACC
06E0 2400        E     ADD     A,#LOW g_meas+02BH
06E2 F582              MOV     DPL,A
06E4 E4                CLR     A
06E5 3400        E     ADDC    A,#HIGH g_meas+02BH
06E7 F583              MOV     DPH,A
06E9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1043
06EC E500        R     MOV     A,index
06EE 25E0              ADD     A,ACC
06F0 25E0              ADD     A,ACC
06F2 2400        R     ADD     A,#LOW vv_value
06F4 F582              MOV     DPL,A
06F6 E4                CLR     A
06F7 3400        R     ADDC    A,#HIGH vv_value
06F9 F583              MOV     DPH,A
06FB E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 113 

06FC FC                MOV     R4,A
06FD A3                INC     DPTR
06FE E0                MOVX    A,@DPTR
06FF FD                MOV     R5,A
0700 A3                INC     DPTR
0701 E0                MOVX    A,@DPTR
0702 FE                MOV     R6,A
0703 A3                INC     DPTR
0704 E0                MOVX    A,@DPTR
0705 FF                MOV     R7,A
0706 E500        R     MOV     A,index
0708 25E0              ADD     A,ACC
070A 25E0              ADD     A,ACC
070C 2400        R     ADD     A,#LOW vvv_value
070E F582              MOV     DPL,A
0710 E4                CLR     A
0711 3400        R     ADDC    A,#HIGH vvv_value
0713 F583              MOV     DPH,A
0715 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1044
0718 E500        R     MOV     A,index
071A 25E0              ADD     A,ACC
071C 25E0              ADD     A,ACC
071E 2400        R     ADD     A,#LOW v_value
0720 F582              MOV     DPL,A
0722 E4                CLR     A
0723 3400        R     ADDC    A,#HIGH v_value
0725 F583              MOV     DPH,A
0727 E0                MOVX    A,@DPTR
0728 FC                MOV     R4,A
0729 A3                INC     DPTR
072A E0                MOVX    A,@DPTR
072B FD                MOV     R5,A
072C A3                INC     DPTR
072D E0                MOVX    A,@DPTR
072E FE                MOV     R6,A
072F A3                INC     DPTR
0730 E0                MOVX    A,@DPTR
0731 FF                MOV     R7,A
0732 E500        R     MOV     A,index
0734 25E0              ADD     A,ACC
0736 25E0              ADD     A,ACC
0738 2400        R     ADD     A,#LOW vv_value
073A F582              MOV     DPL,A
073C E4                CLR     A
073D 3400        R     ADDC    A,#HIGH vv_value
073F F583              MOV     DPH,A
0741 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1045
0744 900000      R     MOV     DPTR,#value_encoder
0747 E0                MOVX    A,@DPTR
0748 FC                MOV     R4,A
0749 A3                INC     DPTR
074A E0                MOVX    A,@DPTR
074B FD                MOV     R5,A
074C A3                INC     DPTR
074D E0                MOVX    A,@DPTR
074E FE                MOV     R6,A
074F A3                INC     DPTR
0750 E0                MOVX    A,@DPTR
0751 FF                MOV     R7,A
0752 E500        R     MOV     A,index
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 114 

0754 25E0              ADD     A,ACC
0756 25E0              ADD     A,ACC
0758 2400        R     ADD     A,#LOW v_value
075A F582              MOV     DPL,A
075C E4                CLR     A
075D 3400        R     ADDC    A,#HIGH v_value
075F F583              MOV     DPH,A
0761 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1047
0764 E500        R     MOV     A,index
0766 25E0              ADD     A,ACC
0768 25E0              ADD     A,ACC
076A 2400        R     ADD     A,#LOW aa_value
076C F582              MOV     DPL,A
076E E4                CLR     A
076F 3400        R     ADDC    A,#HIGH aa_value
0771 F583              MOV     DPH,A
0773 E0                MOVX    A,@DPTR
0774 FC                MOV     R4,A
0775 A3                INC     DPTR
0776 E0                MOVX    A,@DPTR
0777 FD                MOV     R5,A
0778 A3                INC     DPTR
0779 E0                MOVX    A,@DPTR
077A FE                MOV     R6,A
077B A3                INC     DPTR
077C E0                MOVX    A,@DPTR
077D FF                MOV     R7,A
077E E500        R     MOV     A,index
0780 25E0              ADD     A,ACC
0782 25E0              ADD     A,ACC
0784 2400        R     ADD     A,#LOW aaa_value
0786 F582              MOV     DPL,A
0788 E4                CLR     A
0789 3400        R     ADDC    A,#HIGH aaa_value
078B F583              MOV     DPH,A
078D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1048
0790 E500        R     MOV     A,index
0792 25E0              ADD     A,ACC
0794 25E0              ADD     A,ACC
0796 2400        R     ADD     A,#LOW a_value
0798 F582              MOV     DPL,A
079A E4                CLR     A
079B 3400        R     ADDC    A,#HIGH a_value
079D F583              MOV     DPH,A
079F E0                MOVX    A,@DPTR
07A0 FC                MOV     R4,A
07A1 A3                INC     DPTR
07A2 E0                MOVX    A,@DPTR
07A3 FD                MOV     R5,A
07A4 A3                INC     DPTR
07A5 E0                MOVX    A,@DPTR
07A6 FE                MOV     R6,A
07A7 A3                INC     DPTR
07A8 E0                MOVX    A,@DPTR
07A9 FF                MOV     R7,A
07AA E500        R     MOV     A,index
07AC 25E0              ADD     A,ACC
07AE 25E0              ADD     A,ACC
07B0 2400        R     ADD     A,#LOW aa_value
07B2 F582              MOV     DPL,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 115 

07B4 E4                CLR     A
07B5 3400        R     ADDC    A,#HIGH aa_value
07B7 F583              MOV     DPH,A
07B9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1049
07BC 900000      R     MOV     DPTR,#speed_encoder
07BF E0                MOVX    A,@DPTR
07C0 FC                MOV     R4,A
07C1 A3                INC     DPTR
07C2 E0                MOVX    A,@DPTR
07C3 FD                MOV     R5,A
07C4 A3                INC     DPTR
07C5 E0                MOVX    A,@DPTR
07C6 FE                MOV     R6,A
07C7 A3                INC     DPTR
07C8 E0                MOVX    A,@DPTR
07C9 FF                MOV     R7,A
07CA E500        R     MOV     A,index
07CC 25E0              ADD     A,ACC
07CE 25E0              ADD     A,ACC
07D0 2400        R     ADD     A,#LOW a_value
07D2 F582              MOV     DPL,A
07D4 E4                CLR     A
07D5 3400        R     ADDC    A,#HIGH a_value
07D7 F583              MOV     DPH,A
07D9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1053
07DC 300003      R     JNB     pos_reconstruct,$ + 6H
07DF 020000      R     LJMP    ?C0160
                                           ; SOURCE LINE # 1054
07E2 900000      R     MOV     DPTR,#one_time_execute
07E5 E0                MOVX    A,@DPTR
07E6 C3                CLR     C
07E7 9422              SUBB    A,#022H
07E9 5004              JNC     ?C0187
                                           ; SOURCE LINE # 1055
07EB E0                MOVX    A,@DPTR
07EC 04                INC     A
07ED F0                MOVX    @DPTR,A
07EE 22                RET     
07EF         ?C0187:
                                           ; SOURCE LINE # 1056
                                           ; SOURCE LINE # 1058
07EF 900000      E     MOV     DPTR,#c_mem+079H
07F2 E0                MOVX    A,@DPTR
07F3 602A              JZ      ?C0189
                                           ; SOURCE LINE # 1059
07F5 900000      E     MOV     DPTR,#g_meas+04H
07F8 E0                MOVX    A,@DPTR
07F9 FC                MOV     R4,A
07FA A3                INC     DPTR
07FB E0                MOVX    A,@DPTR
07FC FD                MOV     R5,A
07FD A3                INC     DPTR
07FE E0                MOVX    A,@DPTR
07FF FE                MOV     R6,A
0800 A3                INC     DPTR
0801 E0                MOVX    A,@DPTR
0802 FF                MOV     R7,A
0803 900000      E     MOV     DPTR,#?_calc_turns_fcn?BYTE+04H
0806 120000      E     LCALL   ?C?LSTXDATA
0809 900000      E     MOV     DPTR,#g_meas
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 116 

080C E0                MOVX    A,@DPTR
080D FC                MOV     R4,A
080E A3                INC     DPTR
080F E0                MOVX    A,@DPTR
0810 FD                MOV     R5,A
0811 A3                INC     DPTR
0812 E0                MOVX    A,@DPTR
0813 FE                MOV     R6,A
0814 A3                INC     DPTR
0815 E0                MOVX    A,@DPTR
0816 FF                MOV     R7,A
0817 120000      E     LCALL   _calc_turns_fcn
081A 900000      E     MOV     DPTR,#g_meas+014H
081D EF                MOV     A,R7
081E F0                MOVX    @DPTR,A
081F         ?C0189:
                                           ; SOURCE LINE # 1061
081F 900000      E     MOV     DPTR,#g_meas
0822 E0                MOVX    A,@DPTR
0823 F8                MOV     R0,A
0824 A3                INC     DPTR
0825 E0                MOVX    A,@DPTR
0826 F9                MOV     R1,A
0827 A3                INC     DPTR
0828 E0                MOVX    A,@DPTR
0829 FA                MOV     R2,A
082A A3                INC     DPTR
082B E0                MOVX    A,@DPTR
082C FB                MOV     R3,A
082D C000              PUSH    AR0
082F 900000      E     MOV     DPTR,#g_meas+014H
0832 E0                MOVX    A,@DPTR
0833 FF                MOV     R7,A
0834 33                RLC     A
0835 95E0              SUBB    A,ACC
0837 FE                MOV     R6,A
0838 FD                MOV     R5,A
0839 FC                MOV     R4,A
083A 7810              MOV     R0,#010H
083C 120000      E     LCALL   ?C?LSHL
083F D000              POP     AR0
0841 EB                MOV     A,R3
0842 2F                ADD     A,R7
0843 FF                MOV     R7,A
0844 EA                MOV     A,R2
0845 3E                ADDC    A,R6
0846 FE                MOV     R6,A
0847 E9                MOV     A,R1
0848 3D                ADDC    A,R5
0849 FD                MOV     R5,A
084A E8                MOV     A,R0
084B 3C                ADDC    A,R4
084C FC                MOV     R4,A
084D 900000      E     MOV     DPTR,#g_meas
0850 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1064
0853 900000      E     MOV     DPTR,#g_meas
0856 E0                MOVX    A,@DPTR
0857 FC                MOV     R4,A
0858 A3                INC     DPTR
0859 E0                MOVX    A,@DPTR
085A FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 117 

085B A3                INC     DPTR
085C E0                MOVX    A,@DPTR
085D FE                MOV     R6,A
085E A3                INC     DPTR
085F E0                MOVX    A,@DPTR
0860 FF                MOV     R7,A
0861 900000      E     MOV     DPTR,#g_refNew
0864 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1066
0867 900000      E     MOV     DPTR,#g_ref+018H
086A E0                MOVX    A,@DPTR
086B FF                MOV     R7,A
086C 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1068
086F D200        R     SETB    pos_reconstruct
                                           ; SOURCE LINE # 1069
                                           ; SOURCE LINE # 1070
                                           ; SOURCE LINE # 1071
0871         ?C0160:
0871 22                RET     
             ; FUNCTION _encoder_reading (END)

             ; FUNCTION analog_read_end (BEGIN)
                                           ; SOURCE LINE # 1077
0000         ?C0190:
                                           ; SOURCE LINE # 1120
0000 120000      E     LCALL   ADC_STATUS_Read
0003 EF                MOV     A,R7
0004 700A              JNZ     ?C0191
                                           ; SOURCE LINE # 1121
0006 3000F7            JNB     interrupt_flag,?C0190
                                           ; SOURCE LINE # 1122
0009 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1123
000B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1124
                                           ; SOURCE LINE # 1125
000E 80F0              SJMP    ?C0190
0010         ?C0191:
                                           ; SOURCE LINE # 1128
0010 900000      E     MOV     DPTR,#ADC_buf+01H
0013 E0                MOVX    A,@DPTR
0014 249A              ADD     A,#09AH
0016 FF                MOV     R7,A
0017 900000      E     MOV     DPTR,#ADC_buf
001A E0                MOVX    A,@DPTR
001B 34F9              ADDC    A,#0F9H
001D FE                MOV     R6,A
001E 33                RLC     A
001F 95E0              SUBB    A,ACC
0021 FD                MOV     R5,A
0022 FC                MOV     R4,A
0023 E4                CLR     A
0024 7BA0              MOV     R3,#0A0H
0026 7A07              MOV     R2,#07H
0028 F9                MOV     R1,A
0029 F8                MOV     R0,A
002A 120000      E     LCALL   ?C?LMUL
002D 7807              MOV     R0,#07H
002F 120000      E     LCALL   ?C?SLSHR
0032 900000      E     MOV     DPTR,#dev_tension
0035 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 118 

                                           ; SOURCE LINE # 1130
0038 300005            JNB     interrupt_flag,?C0193
                                           ; SOURCE LINE # 1131
003B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1132
003D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1133
0040         ?C0193:
                                           ; SOURCE LINE # 1135
0040 900000      E     MOV     DPTR,#first_tension_valid
0043 E0                MOVX    A,@DPTR
0044 6077              JZ      ?C0194
0046 300074            JNB     tension_valid,?C0194
                                           ; SOURCE LINE # 1136
0049 900000      R     MOV     DPTR,#count
004C E0                MOVX    A,@DPTR
004D 04                INC     A
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1138
004F E0                MOVX    A,@DPTR
0050 64E8              XRL     A,#0E8H
0052 7002              JNZ     ?C0317
0054 7403              MOV     A,#03H
0056         ?C0317:
0056 7065              JNZ     ?C0194
                                           ; SOURCE LINE # 1139
0058 7F28              MOV     R7,#028H
005A 7E23              MOV     R6,#023H
005C FD                MOV     R5,A
005D FC                MOV     R4,A
005E 900000      E     MOV     DPTR,#dev_tension
0061 E0                MOVX    A,@DPTR
0062 F8                MOV     R0,A
0063 A3                INC     DPTR
0064 E0                MOVX    A,@DPTR
0065 F9                MOV     R1,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FA                MOV     R2,A
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B FB                MOV     R3,A
006C C3                CLR     C
006D 120000      E     LCALL   ?C?SLCMP
0070 500F              JNC     ?C0196
                                           ; SOURCE LINE # 1140
0072 E4                CLR     A
0073 7F40              MOV     R7,#040H
0075 7E1F              MOV     R6,#01FH
0077 FD                MOV     R5,A
0078 FC                MOV     R4,A
0079 900000      E     MOV     DPTR,#pow_tension
007C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1141
007F 8037              SJMP    ?C0197
0081         ?C0196:
                                           ; SOURCE LINE # 1142
                                           ; SOURCE LINE # 1143
0081 E4                CLR     A
0082 7FC8              MOV     R7,#0C8H
0084 7E32              MOV     R6,#032H
0086 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 119 

0087 FC                MOV     R4,A
0088 900000      E     MOV     DPTR,#dev_tension
008B E0                MOVX    A,@DPTR
008C F8                MOV     R0,A
008D A3                INC     DPTR
008E E0                MOVX    A,@DPTR
008F F9                MOV     R1,A
0090 A3                INC     DPTR
0091 E0                MOVX    A,@DPTR
0092 FA                MOV     R2,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
0095 FB                MOV     R3,A
0096 C3                CLR     C
0097 120000      E     LCALL   ?C?SLCMP
009A 500F              JNC     ?C0198
                                           ; SOURCE LINE # 1144
009C E4                CLR     A
009D 7FE0              MOV     R7,#0E0H
009F 7E2E              MOV     R6,#02EH
00A1 FD                MOV     R5,A
00A2 FC                MOV     R4,A
00A3 900000      E     MOV     DPTR,#pow_tension
00A6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1145
00A9 800D              SJMP    ?C0197
00AB         ?C0198:
                                           ; SOURCE LINE # 1147
00AB E4                CLR     A
00AC 7FC0              MOV     R7,#0C0H
00AE 7E5D              MOV     R6,#05DH
00B0 FD                MOV     R5,A
00B1 FC                MOV     R4,A
00B2 900000      E     MOV     DPTR,#pow_tension
00B5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1148
00B8         ?C0197:
                                           ; SOURCE LINE # 1150
00B8 E4                CLR     A
00B9 900000      E     MOV     DPTR,#first_tension_valid
00BC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1151
                                           ; SOURCE LINE # 1152
00BD         ?C0194:
                                           ; SOURCE LINE # 1156
00BD E4                CLR     A
00BE 7F58              MOV     R7,#058H
00C0 7E1B              MOV     R6,#01BH
00C2 FD                MOV     R5,A
00C3 FC                MOV     R4,A
00C4 900000      E     MOV     DPTR,#dev_tension
00C7 E0                MOVX    A,@DPTR
00C8 F8                MOV     R0,A
00C9 A3                INC     DPTR
00CA E0                MOVX    A,@DPTR
00CB F9                MOV     R1,A
00CC A3                INC     DPTR
00CD E0                MOVX    A,@DPTR
00CE FA                MOV     R2,A
00CF A3                INC     DPTR
00D0 E0                MOVX    A,@DPTR
00D1 FB                MOV     R3,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 120 

00D2 D3                SETB    C
00D3 120000      E     LCALL   ?C?SLCMP
00D6 5003              JNC     $ + 5H
00D8 020000      R     LJMP    ?C0200
                                           ; SOURCE LINE # 1159
00DB E4                CLR     A
00DC 7FE8              MOV     R7,#0E8H
00DE 7E03              MOV     R6,#03H
00E0 FD                MOV     R5,A
00E1 FC                MOV     R4,A
00E2 900000      R     MOV     DPTR,#count2
00E5 E0                MOVX    A,@DPTR
00E6 F8                MOV     R0,A
00E7 A3                INC     DPTR
00E8 E0                MOVX    A,@DPTR
00E9 F9                MOV     R1,A
00EA A3                INC     DPTR
00EB E0                MOVX    A,@DPTR
00EC FA                MOV     R2,A
00ED A3                INC     DPTR
00EE E0                MOVX    A,@DPTR
00EF FB                MOV     R3,A
00F0 120000      E     LCALL   ?C?ULCMP
00F3 7004              JNZ     ?C0201
                                           ; SOURCE LINE # 1160
00F5 D200        E     SETB    tension_valid
                                           ; SOURCE LINE # 1161
00F7 8036              SJMP    ?C0202
00F9         ?C0201:
                                           ; SOURCE LINE # 1162
                                           ; SOURCE LINE # 1163
00F9 900000      R     MOV     DPTR,#count2
00FC E0                MOVX    A,@DPTR
00FD FC                MOV     R4,A
00FE A3                INC     DPTR
00FF E0                MOVX    A,@DPTR
0100 FD                MOV     R5,A
0101 A3                INC     DPTR
0102 E0                MOVX    A,@DPTR
0103 FE                MOV     R6,A
0104 A3                INC     DPTR
0105 E0                MOVX    A,@DPTR
0106 2401              ADD     A,#01H
0108 FF                MOV     R7,A
0109 E4                CLR     A
010A 3E                ADDC    A,R6
010B FE                MOV     R6,A
010C E4                CLR     A
010D 3D                ADDC    A,R5
010E FD                MOV     R5,A
010F E4                CLR     A
0110 3C                ADDC    A,R4
0111 FC                MOV     R4,A
0112 900000      R     MOV     DPTR,#count2
0115 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1164
0118 900000      E     MOV     DPTR,#dev_tension
011B E0                MOVX    A,@DPTR
011C FC                MOV     R4,A
011D A3                INC     DPTR
011E E0                MOVX    A,@DPTR
011F FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 121 

0120 A3                INC     DPTR
0121 E0                MOVX    A,@DPTR
0122 FE                MOV     R6,A
0123 A3                INC     DPTR
0124 E0                MOVX    A,@DPTR
0125 FF                MOV     R7,A
0126 120000      E     LCALL   _filter_voltage
0129 900000      E     MOV     DPTR,#dev_tension_f
012C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1165
012F         ?C0202:
                                           ; SOURCE LINE # 1167
012F 900000      E     MOV     DPTR,#g_mem+07BH
0132 E0                MOVX    A,@DPTR
0133 6003              JZ      ?C0203
                                           ; SOURCE LINE # 1168
0135 120000      R     LCALL   pwm_limit_search
0138         ?C0203:
                                           ; SOURCE LINE # 1171
0138 900000      E     MOV     DPTR,#ADC_buf+03H
013B E0                MOVX    A,@DPTR
013C 249A              ADD     A,#09AH
013E FF                MOV     R7,A
013F 900000      E     MOV     DPTR,#ADC_buf+02H
0142 E0                MOVX    A,@DPTR
0143 34F9              ADDC    A,#0F9H
0145 FE                MOV     R6,A
0146 33                RLC     A
0147 95E0              SUBB    A,ACC
0149 FD                MOV     R5,A
014A FC                MOV     R4,A
014B E4                CLR     A
014C 7BAB              MOV     R3,#0ABH
014E 7A64              MOV     R2,#064H
0150 F9                MOV     R1,A
0151 F8                MOV     R0,A
0152 120000      E     LCALL   ?C?LMUL
0155 780D              MOV     R0,#0DH
0157 120000      E     LCALL   ?C?SLSHR
015A 900000      E     MOV     DPTR,#pwm_sign
015D E0                MOVX    A,@DPTR
015E FD                MOV     R5,A
015F 33                RLC     A
0160 95E0              SUBB    A,ACC
0162 FC                MOV     R4,A
0163 120000      E     LCALL   ?C?IMUL
0166 EE                MOV     A,R6
0167 33                RLC     A
0168 95E0              SUBB    A,ACC
016A FD                MOV     R5,A
016B FC                MOV     R4,A
016C 120000      E     LCALL   _filter_i1
016F 900000      E     MOV     DPTR,#g_meas+0CH
0172 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1175
0175 300005            JNB     interrupt_flag,?C0204
                                           ; SOURCE LINE # 1176
0178 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1177
017A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1178
017D         ?C0204:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 122 

                                           ; SOURCE LINE # 1181
017D 900000      E     MOV     DPTR,#g_mem+06FH
0180 E0                MOVX    A,@DPTR
0181 7004              JNZ     ?C0205
                                           ; SOURCE LINE # 1182
0183 F500        R     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1183
0185 F500        R     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1184
0187         ?C0205:
                                           ; SOURCE LINE # 1187
0187 900000      E     MOV     DPTR,#c_mem+033H
018A E0                MOVX    A,@DPTR
018B 6406              XRL     A,#06H
018D 6003              JZ      $ + 5H
018F 020000      R     LJMP    ?C0206
                                           ; SOURCE LINE # 1191
0192 E500        R     MOV     A,UD_status
0194 14                DEC     A
0195 7003              JNZ     $ + 5H
0197 020000      R     LJMP    ?C0213
019A 14                DEC     A
019B 7003              JNZ     $ + 5H
019D 020000      R     LJMP    ?C0214
01A0 14                DEC     A
01A1 7003              JNZ     $ + 5H
01A3 020000      R     LJMP    ?C0217
01A6 14                DEC     A
01A7 7003              JNZ     $ + 5H
01A9 020000      R     LJMP    ?C0221
01AC 2404              ADD     A,#04H
01AE 6003              JZ      $ + 5H
01B0 020000      R     LJMP    ?C0207
                                           ; SOURCE LINE # 1192
01B3         ?C0208:
                                           ; SOURCE LINE # 1193
01B3 900000      E     MOV     DPTR,#ADC_buf+04H
01B6 E0                MOVX    A,@DPTR
01B7 FE                MOV     R6,A
01B8 A3                INC     DPTR
01B9 E0                MOVX    A,@DPTR
01BA FF                MOV     R7,A
01BB EE                MOV     A,R6
01BC 33                RLC     A
01BD 95E0              SUBB    A,ACC
01BF 8F00        R     MOV     i_aux+03H,R7
01C1 8E00        R     MOV     i_aux+02H,R6
01C3 F500        R     MOV     i_aux+01H,A
01C5 F500        R     MOV     i_aux,A
                                           ; SOURCE LINE # 1195
01C7 C3                CLR     C
01C8 E500        R     MOV     A,i_aux+03H
01CA 9500        R     SUBB    A,UD_mean_value+03H
01CC FF                MOV     R7,A
01CD E500        R     MOV     A,i_aux+02H
01CF 9500        R     SUBB    A,UD_mean_value+02H
01D1 FE                MOV     R6,A
01D2 E500        R     MOV     A,i_aux+01H
01D4 9500        R     SUBB    A,UD_mean_value+01H
01D6 FD                MOV     R5,A
01D7 E500        R     MOV     A,i_aux
01D9 9500        R     SUBB    A,UD_mean_value
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 123 

01DB FC                MOV     R4,A
01DC 120000      E     LCALL   ?C?FCASTL
01DF C004              PUSH    AR4
01E1 C005              PUSH    AR5
01E3 C006              PUSH    AR6
01E5 C007              PUSH    AR7
01E7 AF00        R     MOV     R7,UD_mean_value+03H
01E9 AE00        R     MOV     R6,UD_mean_value+02H
01EB AD00        R     MOV     R5,UD_mean_value+01H
01ED AC00        R     MOV     R4,UD_mean_value
01EF EC                MOV     A,R4
01F0 120000      E     LCALL   ?C?FCASTL
01F3 A804              MOV     R0,AR4
01F5 A905              MOV     R1,AR5
01F7 AA06              MOV     R2,AR6
01F9 AB07              MOV     R3,AR7
01FB D007              POP     AR7
01FD D006              POP     AR6
01FF D005              POP     AR5
0201 D004              POP     AR4
0203 120000      E     LCALL   ?C?FPDIV
0206 C004              PUSH    AR4
0208 C005              PUSH    AR5
020A C006              PUSH    AR6
020C C007              PUSH    AR7
020E 900000      E     MOV     DPTR,#g_mem+0BFH
0211 E0                MOVX    A,@DPTR
0212 FC                MOV     R4,A
0213 A3                INC     DPTR
0214 E0                MOVX    A,@DPTR
0215 FD                MOV     R5,A
0216 E4                CLR     A
0217 120000      E     LCALL   ?C?FCASTI
021A D003              POP     AR3
021C D002              POP     AR2
021E D001              POP     AR1
0220 D000              POP     AR0
0222 120000      E     LCALL   ?C?FPMUL
0225 120000      E     LCALL   ?C?CASTF
0228 8F00        R     MOV     i_aux+03H,R7
022A 8E00        R     MOV     i_aux+02H,R6
022C 8D00        R     MOV     i_aux+01H,R5
022E 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1197
0230 300005            JNB     interrupt_flag,?C0209
                                           ; SOURCE LINE # 1198
0233 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1199
0235 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1200
0238         ?C0209:
                                           ; SOURCE LINE # 1203
0238 7F00              MOV     R7,#00H
023A 7EFC              MOV     R6,#0FCH
023C 7DFF              MOV     R5,#0FFH
023E 7CFF              MOV     R4,#0FFH
0240 AB00        R     MOV     R3,i_aux+03H
0242 AA00        R     MOV     R2,i_aux+02H
0244 A900        R     MOV     R1,i_aux+01H
0246 A800        R     MOV     R0,i_aux
0248 C3                CLR     C
0249 120000      E     LCALL   ?C?SLCMP
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 124 

024C 500C              JNC     ?C0210
                                           ; SOURCE LINE # 1204
024E 750000      R     MOV     i_aux+03H,#00H
0251 7500FC      R     MOV     i_aux+02H,#0FCH
0254 7500FF      R     MOV     i_aux+01H,#0FFH
0257 7500FF      R     MOV     i_aux,#0FFH
025A         ?C0210:
                                           ; SOURCE LINE # 1205
025A E4                CLR     A
025B FF                MOV     R7,A
025C 7E04              MOV     R6,#04H
025E FD                MOV     R5,A
025F FC                MOV     R4,A
0260 AB00        R     MOV     R3,i_aux+03H
0262 AA00        R     MOV     R2,i_aux+02H
0264 A900        R     MOV     R1,i_aux+01H
0266 A800        R     MOV     R0,i_aux
0268 D3                SETB    C
0269 120000      E     LCALL   ?C?SLCMP
026C 400A              JC      ?C0211
                                           ; SOURCE LINE # 1206
026E E4                CLR     A
026F F500        R     MOV     i_aux+03H,A
0271 750004      R     MOV     i_aux+02H,#04H
0274 F500        R     MOV     i_aux+01H,A
0276 F500        R     MOV     i_aux,A
0278         ?C0211:
                                           ; SOURCE LINE # 1208
0278 900000      E     MOV     DPTR,#g_meas+039H
027B E500        R     MOV     A,i_aux+02H
027D F0                MOVX    @DPTR,A
027E A3                INC     DPTR
027F E500        R     MOV     A,i_aux+03H
0281 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1210
0282 200003      E     JB      interrupt_flag,$ + 6H
0285 020000      R     LJMP    ?C0207
                                           ; SOURCE LINE # 1211
0288 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1212
028A 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1213
                                           ; SOURCE LINE # 1215
028D 020000      R     LJMP    ?C0207
                                           ; SOURCE LINE # 1217
0290         ?C0213:
                                           ; SOURCE LINE # 1218
0290 E4                CLR     A
0291 F500        R     MOV     UD_counter,A
0293 F500        R     MOV     UD_counter+01H,A
                                           ; SOURCE LINE # 1219
0295 F500        R     MOV     UD_mean_value+03H,A
0297 F500        R     MOV     UD_mean_value+02H,A
0299 F500        R     MOV     UD_mean_value+01H,A
029B F500        R     MOV     UD_mean_value,A
                                           ; SOURCE LINE # 1220
029D 750004      R     MOV     UD_status,#04H
                                           ; SOURCE LINE # 1222
02A0 020000      R     LJMP    ?C0207
                                           ; SOURCE LINE # 1224
02A3         ?C0214:
                                           ; SOURCE LINE # 1225
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 125 

02A3 0500        R     INC     UD_counter+01H
02A5 E500        R     MOV     A,UD_counter+01H
02A7 7002              JNZ     ?C0318
02A9 0500        R     INC     UD_counter
02AB         ?C0318:
                                           ; SOURCE LINE # 1226
02AB 6464              XRL     A,#064H
02AD 4500        R     ORL     A,UD_counter
02AF 707F              JNZ     ?C0207
                                           ; SOURCE LINE # 1227
02B1 F500        R     MOV     UD_counter,A
02B3 F500        R     MOV     UD_counter+01H,A
                                           ; SOURCE LINE # 1229
02B5 300005            JNB     interrupt_flag,?C0216
                                           ; SOURCE LINE # 1230
02B8 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1231
02BA 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1232
02BD         ?C0216:
                                           ; SOURCE LINE # 1234
02BD 750003      R     MOV     UD_status,#03H
                                           ; SOURCE LINE # 1235
                                           ; SOURCE LINE # 1237
02C0 806E              SJMP    ?C0207
                                           ; SOURCE LINE # 1239
02C2         ?C0217:
                                           ; SOURCE LINE # 1241
02C2 0500        R     INC     UD_counter+01H
02C4 E500        R     MOV     A,UD_counter+01H
02C6 7002              JNZ     ?C0319
02C8 0500        R     INC     UD_counter
02CA         ?C0319:
                                           ; SOURCE LINE # 1242
02CA 900000      E     MOV     DPTR,#ADC_buf+04H
02CD E0                MOVX    A,@DPTR
02CE FE                MOV     R6,A
02CF A3                INC     DPTR
02D0 E0                MOVX    A,@DPTR
02D1 FF                MOV     R7,A
02D2 EE                MOV     A,R6
02D3 33                RLC     A
02D4 95E0              SUBB    A,ACC
02D6 FD                MOV     R5,A
02D7 FC                MOV     R4,A
02D8 E500        R     MOV     A,UD_mean_value+03H
02DA 2F                ADD     A,R7
02DB F500        R     MOV     UD_mean_value+03H,A
02DD E500        R     MOV     A,UD_mean_value+02H
02DF 3E                ADDC    A,R6
02E0 F500        R     MOV     UD_mean_value+02H,A
02E2 E500        R     MOV     A,UD_mean_value+01H
02E4 3D                ADDC    A,R5
02E5 F500        R     MOV     UD_mean_value+01H,A
02E7 E500        R     MOV     A,UD_mean_value
02E9 3C                ADDC    A,R4
02EA F500        R     MOV     UD_mean_value,A
                                           ; SOURCE LINE # 1244
02EC 300005            JNB     interrupt_flag,?C0218
                                           ; SOURCE LINE # 1245
02EF C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1246
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 126 

02F1 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1247
02F4         ?C0218:
                                           ; SOURCE LINE # 1249
02F4 E500        R     MOV     A,UD_counter+01H
02F6 64C8              XRL     A,#0C8H
02F8 4500        R     ORL     A,UD_counter
02FA 7034              JNZ     ?C0207
                                           ; SOURCE LINE # 1250
02FC AF00        R     MOV     R7,UD_mean_value+03H
02FE AE00        R     MOV     R6,UD_mean_value+02H
0300 AD00        R     MOV     R5,UD_mean_value+01H
0302 AC00        R     MOV     R4,UD_mean_value
0304 7BC8              MOV     R3,#0C8H
0306 FA                MOV     R2,A
0307 F9                MOV     R1,A
0308 F8                MOV     R0,A
0309 120000      E     LCALL   ?C?SLDIV
030C 8F00        R     MOV     UD_mean_value+03H,R7
030E 8E00        R     MOV     UD_mean_value+02H,R6
0310 8D00        R     MOV     UD_mean_value+01H,R5
0312 8C00        R     MOV     UD_mean_value,R4
                                           ; SOURCE LINE # 1252
0314 300005            JNB     interrupt_flag,?C0220
                                           ; SOURCE LINE # 1253
0317 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1254
0319 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1255
031C         ?C0220:
                                           ; SOURCE LINE # 1257
031C E4                CLR     A
031D F500        R     MOV     UD_counter,A
031F F500        R     MOV     UD_counter+01H,A
                                           ; SOURCE LINE # 1258
0321 F500        R     MOV     UD_status,A
                                           ; SOURCE LINE # 1259
                                           ; SOURCE LINE # 1260
0323 800B              SJMP    ?C0207
                                           ; SOURCE LINE # 1262
0325         ?C0221:
                                           ; SOURCE LINE # 1263
0325 E500        R     MOV     A,emg_1_status
0327 7007              JNZ     ?C0207
0329 E500        R     MOV     A,emg_2_status
032B 7003              JNZ     ?C0207
                                           ; SOURCE LINE # 1264
032D 750002      R     MOV     UD_status,#02H
                                           ; SOURCE LINE # 1265
                                           ; SOURCE LINE # 1266
0330         ?C0207:
                                           ; SOURCE LINE # 1268
0330 300005            JNB     interrupt_flag,?C0223
                                           ; SOURCE LINE # 1269
0333 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1270
0335 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1271
0338         ?C0223:
                                           ; SOURCE LINE # 1273
0338 E500        R     MOV     A,LR_status
033A 14                DEC     A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 127 

033B 7003              JNZ     $ + 5H
033D 020000      R     LJMP    ?C0230
0340 14                DEC     A
0341 7003              JNZ     $ + 5H
0343 020000      R     LJMP    ?C0231
0346 14                DEC     A
0347 7003              JNZ     $ + 5H
0349 020000      R     LJMP    ?C0234
034C 14                DEC     A
034D 7003              JNZ     $ + 5H
034F 020000      R     LJMP    ?C0237
0352 2404              ADD     A,#04H
0354 6003              JZ      $ + 5H
0356 020000      R     LJMP    ?C0224
                                           ; SOURCE LINE # 1274
0359         ?C0225:
                                           ; SOURCE LINE # 1275
0359 900000      E     MOV     DPTR,#ADC_buf+06H
035C E0                MOVX    A,@DPTR
035D FE                MOV     R6,A
035E A3                INC     DPTR
035F E0                MOVX    A,@DPTR
0360 FF                MOV     R7,A
0361 EE                MOV     A,R6
0362 33                RLC     A
0363 95E0              SUBB    A,ACC
0365 8F00        R     MOV     i_aux+03H,R7
0367 8E00        R     MOV     i_aux+02H,R6
0369 F500        R     MOV     i_aux+01H,A
036B F500        R     MOV     i_aux,A
                                           ; SOURCE LINE # 1277
036D C3                CLR     C
036E E500        R     MOV     A,i_aux+03H
0370 9500        R     SUBB    A,LR_mean_value+03H
0372 FF                MOV     R7,A
0373 E500        R     MOV     A,i_aux+02H
0375 9500        R     SUBB    A,LR_mean_value+02H
0377 FE                MOV     R6,A
0378 E500        R     MOV     A,i_aux+01H
037A 9500        R     SUBB    A,LR_mean_value+01H
037C FD                MOV     R5,A
037D E500        R     MOV     A,i_aux
037F 9500        R     SUBB    A,LR_mean_value
0381 FC                MOV     R4,A
0382 120000      E     LCALL   ?C?FCASTL
0385 C004              PUSH    AR4
0387 C005              PUSH    AR5
0389 C006              PUSH    AR6
038B C007              PUSH    AR7
038D AF00        R     MOV     R7,LR_mean_value+03H
038F AE00        R     MOV     R6,LR_mean_value+02H
0391 AD00        R     MOV     R5,LR_mean_value+01H
0393 AC00        R     MOV     R4,LR_mean_value
0395 EC                MOV     A,R4
0396 120000      E     LCALL   ?C?FCASTL
0399 A804              MOV     R0,AR4
039B A905              MOV     R1,AR5
039D AA06              MOV     R2,AR6
039F AB07              MOV     R3,AR7
03A1 D007              POP     AR7
03A3 D006              POP     AR6
03A5 D005              POP     AR5
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 128 

03A7 D004              POP     AR4
03A9 120000      E     LCALL   ?C?FPDIV
03AC C004              PUSH    AR4
03AE C005              PUSH    AR5
03B0 C006              PUSH    AR6
03B2 C007              PUSH    AR7
03B4 900000      E     MOV     DPTR,#g_mem+0BFH
03B7 E0                MOVX    A,@DPTR
03B8 FC                MOV     R4,A
03B9 A3                INC     DPTR
03BA E0                MOVX    A,@DPTR
03BB FD                MOV     R5,A
03BC E4                CLR     A
03BD 120000      E     LCALL   ?C?FCASTI
03C0 D003              POP     AR3
03C2 D002              POP     AR2
03C4 D001              POP     AR1
03C6 D000              POP     AR0
03C8 120000      E     LCALL   ?C?FPMUL
03CB 120000      E     LCALL   ?C?CASTF
03CE 8F00        R     MOV     i_aux+03H,R7
03D0 8E00        R     MOV     i_aux+02H,R6
03D2 8D00        R     MOV     i_aux+01H,R5
03D4 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1279
03D6 300005            JNB     interrupt_flag,?C0226
                                           ; SOURCE LINE # 1280
03D9 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1281
03DB 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1282
03DE         ?C0226:
                                           ; SOURCE LINE # 1285
03DE 7F00              MOV     R7,#00H
03E0 7EFC              MOV     R6,#0FCH
03E2 7DFF              MOV     R5,#0FFH
03E4 7CFF              MOV     R4,#0FFH
03E6 AB00        R     MOV     R3,i_aux+03H
03E8 AA00        R     MOV     R2,i_aux+02H
03EA A900        R     MOV     R1,i_aux+01H
03EC A800        R     MOV     R0,i_aux
03EE C3                CLR     C
03EF 120000      E     LCALL   ?C?SLCMP
03F2 500C              JNC     ?C0227
                                           ; SOURCE LINE # 1286
03F4 750000      R     MOV     i_aux+03H,#00H
03F7 7500FC      R     MOV     i_aux+02H,#0FCH
03FA 7500FF      R     MOV     i_aux+01H,#0FFH
03FD 7500FF      R     MOV     i_aux,#0FFH
0400         ?C0227:
                                           ; SOURCE LINE # 1287
0400 E4                CLR     A
0401 FF                MOV     R7,A
0402 7E04              MOV     R6,#04H
0404 FD                MOV     R5,A
0405 FC                MOV     R4,A
0406 AB00        R     MOV     R3,i_aux+03H
0408 AA00        R     MOV     R2,i_aux+02H
040A A900        R     MOV     R1,i_aux+01H
040C A800        R     MOV     R0,i_aux
040E D3                SETB    C
040F 120000      E     LCALL   ?C?SLCMP
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 129 

0412 400A              JC      ?C0228
                                           ; SOURCE LINE # 1288
0414 E4                CLR     A
0415 F500        R     MOV     i_aux+03H,A
0417 750004      R     MOV     i_aux+02H,#04H
041A F500        R     MOV     i_aux+01H,A
041C F500        R     MOV     i_aux,A
041E         ?C0228:
                                           ; SOURCE LINE # 1290
041E 300005            JNB     interrupt_flag,?C0229
                                           ; SOURCE LINE # 1291
0421 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1292
0423 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1293
0426         ?C0229:
                                           ; SOURCE LINE # 1295
0426 900000      E     MOV     DPTR,#g_meas+037H
0429 E500        R     MOV     A,i_aux+02H
042B F0                MOVX    @DPTR,A
042C A3                INC     DPTR
042D E500        R     MOV     A,i_aux+03H
042F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1297
0430 020000      R     LJMP    ?C0224
                                           ; SOURCE LINE # 1299
0433         ?C0230:
                                           ; SOURCE LINE # 1300
0433 E4                CLR     A
0434 F500        R     MOV     LR_counter,A
0436 F500        R     MOV     LR_counter+01H,A
                                           ; SOURCE LINE # 1301
0438 F500        R     MOV     LR_mean_value+03H,A
043A F500        R     MOV     LR_mean_value+02H,A
043C F500        R     MOV     LR_mean_value+01H,A
043E F500        R     MOV     LR_mean_value,A
                                           ; SOURCE LINE # 1302
0440 750004      R     MOV     LR_status,#04H
                                           ; SOURCE LINE # 1303
0443 020000      R     LJMP    ?C0224
                                           ; SOURCE LINE # 1305
0446         ?C0231:
                                           ; SOURCE LINE # 1306
0446 0500        R     INC     LR_counter+01H
0448 E500        R     MOV     A,LR_counter+01H
044A 7002              JNZ     ?C0320
044C 0500        R     INC     LR_counter
044E         ?C0320:
                                           ; SOURCE LINE # 1307
044E 6464              XRL     A,#064H
0450 4500        R     ORL     A,LR_counter
0452 707B              JNZ     ?C0224
                                           ; SOURCE LINE # 1308
0454 F500        R     MOV     LR_counter,A
0456 F500        R     MOV     LR_counter+01H,A
                                           ; SOURCE LINE # 1310
0458 300005            JNB     interrupt_flag,?C0233
                                           ; SOURCE LINE # 1311
045B C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1312
045D 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1313
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 130 

0460         ?C0233:
                                           ; SOURCE LINE # 1315
0460 750003      R     MOV     LR_status,#03H
                                           ; SOURCE LINE # 1316
                                           ; SOURCE LINE # 1317
0463 806A              SJMP    ?C0224
                                           ; SOURCE LINE # 1319
0465         ?C0234:
                                           ; SOURCE LINE # 1321
0465 0500        R     INC     LR_counter+01H
0467 E500        R     MOV     A,LR_counter+01H
0469 7002              JNZ     ?C0321
046B 0500        R     INC     LR_counter
046D         ?C0321:
                                           ; SOURCE LINE # 1322
046D 900000      E     MOV     DPTR,#ADC_buf+06H
0470 E0                MOVX    A,@DPTR
0471 FE                MOV     R6,A
0472 A3                INC     DPTR
0473 E0                MOVX    A,@DPTR
0474 FF                MOV     R7,A
0475 EE                MOV     A,R6
0476 33                RLC     A
0477 95E0              SUBB    A,ACC
0479 FD                MOV     R5,A
047A FC                MOV     R4,A
047B E500        R     MOV     A,LR_mean_value+03H
047D 2F                ADD     A,R7
047E F500        R     MOV     LR_mean_value+03H,A
0480 E500        R     MOV     A,LR_mean_value+02H
0482 3E                ADDC    A,R6
0483 F500        R     MOV     LR_mean_value+02H,A
0485 E500        R     MOV     A,LR_mean_value+01H
0487 3D                ADDC    A,R5
0488 F500        R     MOV     LR_mean_value+01H,A
048A E500        R     MOV     A,LR_mean_value
048C 3C                ADDC    A,R4
048D F500        R     MOV     LR_mean_value,A
                                           ; SOURCE LINE # 1323
048F E500        R     MOV     A,LR_counter+01H
0491 64C8              XRL     A,#0C8H
0493 4500        R     ORL     A,LR_counter
0495 7038              JNZ     ?C0224
                                           ; SOURCE LINE # 1324
0497 AF00        R     MOV     R7,LR_mean_value+03H
0499 AE00        R     MOV     R6,LR_mean_value+02H
049B AD00        R     MOV     R5,LR_mean_value+01H
049D AC00        R     MOV     R4,LR_mean_value
049F 7BC8              MOV     R3,#0C8H
04A1 FA                MOV     R2,A
04A2 F9                MOV     R1,A
04A3 F8                MOV     R0,A
04A4 120000      E     LCALL   ?C?SLDIV
04A7 8F00        R     MOV     LR_mean_value+03H,R7
04A9 8E00        R     MOV     LR_mean_value+02H,R6
04AB 8D00        R     MOV     LR_mean_value+01H,R5
04AD 8C00        R     MOV     LR_mean_value,R4
                                           ; SOURCE LINE # 1326
04AF 300005            JNB     interrupt_flag,?C0236
                                           ; SOURCE LINE # 1327
04B2 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1328
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 131 

04B4 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1329
04B7         ?C0236:
                                           ; SOURCE LINE # 1331
04B7 E4                CLR     A
04B8 F500        R     MOV     LR_counter,A
04BA F500        R     MOV     LR_counter+01H,A
                                           ; SOURCE LINE # 1332
04BC F500        R     MOV     LR_status,A
                                           ; SOURCE LINE # 1333
                                           ; SOURCE LINE # 1334
04BE 800F              SJMP    ?C0224
                                           ; SOURCE LINE # 1336
04C0         ?C0237:
                                           ; SOURCE LINE # 1337
04C0 E500        R     MOV     A,emg_1_status
04C2 700B              JNZ     ?C0224
04C4 E500        R     MOV     A,emg_2_status
04C6 7007              JNZ     ?C0224
04C8 E500        R     MOV     A,UD_status
04CA 7003              JNZ     ?C0224
                                           ; SOURCE LINE # 1338
04CC 750002      R     MOV     LR_status,#02H
                                           ; SOURCE LINE # 1339
                                           ; SOURCE LINE # 1340
04CF         ?C0224:
                                           ; SOURCE LINE # 1342
04CF 200003      E     JB      interrupt_flag,$ + 6H
04D2 020000      R     LJMP    ?C0287
                                           ; SOURCE LINE # 1343
04D5 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1344
04D7 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1345
                                           ; SOURCE LINE # 1347
04DA 020000      R     LJMP    ?C0287
04DD         ?C0206:
                                           ; SOURCE LINE # 1348
                                           ; SOURCE LINE # 1354
04DD E500        R     MOV     A,emg_1_status
04DF 14                DEC     A
04E0 7003              JNZ     $ + 5H
04E2 020000      R     LJMP    ?C0249
04E5 14                DEC     A
04E6 7003              JNZ     $ + 5H
04E8 020000      R     LJMP    ?C0250
04EB 14                DEC     A
04EC 7003              JNZ     $ + 5H
04EE 020000      R     LJMP    ?C0253
04F1 2403              ADD     A,#03H
04F3 6003              JZ      $ + 5H
04F5 020000      R     LJMP    ?C0241
                                           ; SOURCE LINE # 1355
04F8         ?C0242:
                                           ; SOURCE LINE # 1356
04F8 900000      E     MOV     DPTR,#ADC_buf+04H
04FB E0                MOVX    A,@DPTR
04FC FE                MOV     R6,A
04FD A3                INC     DPTR
04FE E0                MOVX    A,@DPTR
04FF FF                MOV     R7,A
0500 EE                MOV     A,R6
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 132 

0501 33                RLC     A
0502 95E0              SUBB    A,ACC
0504 8F00        R     MOV     i_aux+03H,R7
0506 8E00        R     MOV     i_aux+02H,R6
0508 F500        R     MOV     i_aux+01H,A
050A F500        R     MOV     i_aux,A
                                           ; SOURCE LINE # 1357
050C E4                CLR     A
050D FF                MOV     R7,A
050E FE                MOV     R6,A
050F FD                MOV     R5,A
0510 FC                MOV     R4,A
0511 AB00        R     MOV     R3,i_aux+03H
0513 AA00        R     MOV     R2,i_aux+02H
0515 A900        R     MOV     R1,i_aux+01H
0517 A800        R     MOV     R0,i_aux
0519 C3                CLR     C
051A 120000      E     LCALL   ?C?SLCMP
051D 5009              JNC     ?C0243
                                           ; SOURCE LINE # 1358
051F E4                CLR     A
0520 F500        R     MOV     i_aux+03H,A
0522 F500        R     MOV     i_aux+02H,A
0524 F500        R     MOV     i_aux+01H,A
0526 F500        R     MOV     i_aux,A
0528         ?C0243:
                                           ; SOURCE LINE # 1359
0528 AF00        R     MOV     R7,i_aux+03H
052A AE00        R     MOV     R6,i_aux+02H
052C AD00        R     MOV     R5,i_aux+01H
052E AC00        R     MOV     R4,i_aux
0530 120000      E     LCALL   _filter_ch1
0533 8F00        R     MOV     i_aux+03H,R7
0535 8E00        R     MOV     i_aux+02H,R6
0537 8D00        R     MOV     i_aux+01H,R5
0539 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1360
053B 780A              MOV     R0,#0AH
053D 120000      E     LCALL   ?C?LSHL
0540 900000      E     MOV     DPTR,#g_mem+070H
0543 E0                MOVX    A,@DPTR
0544 F8                MOV     R0,A
0545 A3                INC     DPTR
0546 E0                MOVX    A,@DPTR
0547 F9                MOV     R1,A
0548 A3                INC     DPTR
0549 E0                MOVX    A,@DPTR
054A FA                MOV     R2,A
054B A3                INC     DPTR
054C E0                MOVX    A,@DPTR
054D FB                MOV     R3,A
054E 120000      E     LCALL   ?C?ULDIV
0551 8F00        R     MOV     i_aux+03H,R7
0553 8E00        R     MOV     i_aux+02H,R6
0555 8D00        R     MOV     i_aux+01H,R5
0557 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1362
0559 300005            JNB     interrupt_flag,?C0244
                                           ; SOURCE LINE # 1363
055C C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1364
055E 120000      R     LCALL   interrupt_manager
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 133 

                                           ; SOURCE LINE # 1365
0561         ?C0244:
                                           ; SOURCE LINE # 1367
0561 E4                CLR     A
0562 FF                MOV     R7,A
0563 FE                MOV     R6,A
0564 FD                MOV     R5,A
0565 FC                MOV     R4,A
0566 AB00        R     MOV     R3,i_aux+03H
0568 AA00        R     MOV     R2,i_aux+02H
056A A900        R     MOV     R1,i_aux+01H
056C A800        R     MOV     R0,i_aux
056E C3                CLR     C
056F 120000      E     LCALL   ?C?SLCMP
0572 500B              JNC     ?C0245
                                           ; SOURCE LINE # 1368
0574 E4                CLR     A
0575 F500        R     MOV     i_aux+03H,A
0577 F500        R     MOV     i_aux+02H,A
0579 F500        R     MOV     i_aux+01H,A
057B F500        R     MOV     i_aux,A
057D 801E              SJMP    ?C0246
057F         ?C0245:
                                           ; SOURCE LINE # 1370
057F E4                CLR     A
0580 FF                MOV     R7,A
0581 7E04              MOV     R6,#04H
0583 FD                MOV     R5,A
0584 FC                MOV     R4,A
0585 AB00        R     MOV     R3,i_aux+03H
0587 AA00        R     MOV     R2,i_aux+02H
0589 A900        R     MOV     R1,i_aux+01H
058B A800        R     MOV     R0,i_aux
058D D3                SETB    C
058E 120000      E     LCALL   ?C?SLCMP
0591 400A              JC      ?C0246
                                           ; SOURCE LINE # 1371
0593 E4                CLR     A
0594 F500        R     MOV     i_aux+03H,A
0596 750004      R     MOV     i_aux+02H,#04H
0599 F500        R     MOV     i_aux+01H,A
059B F500        R     MOV     i_aux,A
059D         ?C0246:
                                           ; SOURCE LINE # 1373
059D AF00        R     MOV     R7,i_aux+03H
059F AE00        R     MOV     R6,i_aux+02H
05A1 AD00        R     MOV     R5,i_aux+01H
05A3 AC00        R     MOV     R4,i_aux
05A5 900000      E     MOV     DPTR,#g_meas+017H
05A8 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1375
05AB 200003      E     JB      interrupt_flag,$ + 6H
05AE 020000      R     LJMP    ?C0241
                                           ; SOURCE LINE # 1376
05B1 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1377
05B3 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1378
                                           ; SOURCE LINE # 1380
05B6 020000      R     LJMP    ?C0241
                                           ; SOURCE LINE # 1382
05B9         ?C0249:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 134 

                                           ; SOURCE LINE # 1383
05B9 E4                CLR     A
05BA 900000      R     MOV     DPTR,#emg_counter_1
05BD F0                MOVX    @DPTR,A
05BE A3                INC     DPTR
05BF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1384
05C0 FF                MOV     R7,A
05C1 FE                MOV     R6,A
05C2 FD                MOV     R5,A
05C3 FC                MOV     R4,A
05C4 900000      E     MOV     DPTR,#g_mem+070H
05C7 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1385
05CA 750002      R     MOV     emg_1_status,#02H
                                           ; SOURCE LINE # 1387
05CD 020000      R     LJMP    ?C0241
                                           ; SOURCE LINE # 1389
05D0         ?C0250:
                                           ; SOURCE LINE # 1390
05D0 900000      R     MOV     DPTR,#emg_counter_1+01H
05D3 E0                MOVX    A,@DPTR
05D4 04                INC     A
05D5 F0                MOVX    @DPTR,A
05D6 7006              JNZ     ?C0322
05D8 900000      R     MOV     DPTR,#emg_counter_1
05DB E0                MOVX    A,@DPTR
05DC 04                INC     A
05DD F0                MOVX    @DPTR,A
05DE         ?C0322:
                                           ; SOURCE LINE # 1391
05DE 900000      R     MOV     DPTR,#emg_counter_1
05E1 E0                MOVX    A,@DPTR
05E2 6401              XRL     A,#01H
05E4 7004              JNZ     ?C0323
05E6 A3                INC     DPTR
05E7 E0                MOVX    A,@DPTR
05E8 64F4              XRL     A,#0F4H
05EA         ?C0323:
05EA 6003              JZ      $ + 5H
05EC 020000      R     LJMP    ?C0241
                                           ; SOURCE LINE # 1392
05EF 900000      R     MOV     DPTR,#emg_counter_1
05F2 F0                MOVX    @DPTR,A
05F3 A3                INC     DPTR
05F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1394
05F5 7F01              MOV     R7,#01H
05F7 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1395
05FA E4                CLR     A
05FB FF                MOV     R7,A
05FC 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1397
05FF 300005            JNB     interrupt_flag,?C0252
                                           ; SOURCE LINE # 1398
0602 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1399
0604 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1400
0607         ?C0252:
                                           ; SOURCE LINE # 1402
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 135 

0607 750003      R     MOV     emg_1_status,#03H
                                           ; SOURCE LINE # 1403
                                           ; SOURCE LINE # 1404
060A 020000      R     LJMP    ?C0241
                                           ; SOURCE LINE # 1406
060D         ?C0253:
                                           ; SOURCE LINE # 1408
060D 900000      R     MOV     DPTR,#emg_counter_1+01H
0610 E0                MOVX    A,@DPTR
0611 04                INC     A
0612 F0                MOVX    @DPTR,A
0613 7006              JNZ     ?C0324
0615 900000      R     MOV     DPTR,#emg_counter_1
0618 E0                MOVX    A,@DPTR
0619 04                INC     A
061A F0                MOVX    @DPTR,A
061B         ?C0324:
                                           ; SOURCE LINE # 1409
061B C3                CLR     C
061C 900000      E     MOV     DPTR,#ADC_buf+04H
061F E0                MOVX    A,@DPTR
0620 6480              XRL     A,#080H
0622 9480              SUBB    A,#080H
0624 5004              JNC     ?C0254
                                           ; SOURCE LINE # 1410
0626 E4                CLR     A
0627 F0                MOVX    @DPTR,A
0628 A3                INC     DPTR
0629 F0                MOVX    @DPTR,A
062A         ?C0254:
                                           ; SOURCE LINE # 1411
062A 900000      E     MOV     DPTR,#g_mem+070H
062D E0                MOVX    A,@DPTR
062E F8                MOV     R0,A
062F A3                INC     DPTR
0630 E0                MOVX    A,@DPTR
0631 F9                MOV     R1,A
0632 A3                INC     DPTR
0633 E0                MOVX    A,@DPTR
0634 FA                MOV     R2,A
0635 A3                INC     DPTR
0636 E0                MOVX    A,@DPTR
0637 FB                MOV     R3,A
0638 C000              PUSH    AR0
063A C001              PUSH    AR1
063C C002              PUSH    AR2
063E C003              PUSH    AR3
0640 900000      E     MOV     DPTR,#ADC_buf+04H
0643 E0                MOVX    A,@DPTR
0644 FE                MOV     R6,A
0645 A3                INC     DPTR
0646 E0                MOVX    A,@DPTR
0647 FF                MOV     R7,A
0648 EE                MOV     A,R6
0649 33                RLC     A
064A 95E0              SUBB    A,ACC
064C FD                MOV     R5,A
064D FC                MOV     R4,A
064E 120000      E     LCALL   _filter_ch1
0651 D003              POP     AR3
0653 D002              POP     AR2
0655 D001              POP     AR1
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 136 

0657 D000              POP     AR0
0659 EB                MOV     A,R3
065A 2F                ADD     A,R7
065B FF                MOV     R7,A
065C EA                MOV     A,R2
065D 3E                ADDC    A,R6
065E FE                MOV     R6,A
065F E9                MOV     A,R1
0660 3D                ADDC    A,R5
0661 FD                MOV     R5,A
0662 E8                MOV     A,R0
0663 3C                ADDC    A,R4
0664 FC                MOV     R4,A
0665 900000      E     MOV     DPTR,#g_mem+070H
0668 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1413
066B 300005            JNB     interrupt_flag,?C0255
                                           ; SOURCE LINE # 1414
066E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1415
0670 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1416
0673         ?C0255:
                                           ; SOURCE LINE # 1418
0673 900000      R     MOV     DPTR,#emg_counter_1
0676 E0                MOVX    A,@DPTR
0677 6403              XRL     A,#03H
0679 7004              JNZ     ?C0325
067B A3                INC     DPTR
067C E0                MOVX    A,@DPTR
067D 64E8              XRL     A,#0E8H
067F         ?C0325:
067F 7039              JNZ     ?C0241
                                           ; SOURCE LINE # 1419
0681 900000      E     MOV     DPTR,#g_mem+070H
0684 E0                MOVX    A,@DPTR
0685 FC                MOV     R4,A
0686 A3                INC     DPTR
0687 E0                MOVX    A,@DPTR
0688 FD                MOV     R5,A
0689 A3                INC     DPTR
068A E0                MOVX    A,@DPTR
068B FE                MOV     R6,A
068C A3                INC     DPTR
068D E0                MOVX    A,@DPTR
068E FF                MOV     R7,A
068F E4                CLR     A
0690 7BE8              MOV     R3,#0E8H
0692 7A03              MOV     R2,#03H
0694 F9                MOV     R1,A
0695 F8                MOV     R0,A
0696 120000      E     LCALL   ?C?ULDIV
0699 900000      E     MOV     DPTR,#g_mem+070H
069C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1421
069F 300005            JNB     interrupt_flag,?C0257
                                           ; SOURCE LINE # 1422
06A2 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1423
06A4 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1424
06A7         ?C0257:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 137 

                                           ; SOURCE LINE # 1426
06A7 E4                CLR     A
06A8 FF                MOV     R7,A
06A9 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1427
06AC E4                CLR     A
06AD FF                MOV     R7,A
06AE 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1429
06B1 E4                CLR     A
06B2 900000      R     MOV     DPTR,#emg_counter_1
06B5 F0                MOVX    @DPTR,A
06B6 A3                INC     DPTR
06B7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1431
06B8 F500        R     MOV     emg_1_status,A
                                           ; SOURCE LINE # 1432
                                           ; SOURCE LINE # 1433
                                           ; SOURCE LINE # 1435
                                           ; SOURCE LINE # 1436
                                           ; SOURCE LINE # 1437
06BA         ?C0241:
                                           ; SOURCE LINE # 1439
06BA 300005            JNB     interrupt_flag,?C0259
                                           ; SOURCE LINE # 1440
06BD C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1441
06BF 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1442
06C2         ?C0259:
                                           ; SOURCE LINE # 1444
06C2 E500        R     MOV     A,emg_2_status
06C4 14                DEC     A
06C5 7003              JNZ     $ + 5H
06C7 020000      R     LJMP    ?C0267
06CA 14                DEC     A
06CB 7003              JNZ     $ + 5H
06CD 020000      R     LJMP    ?C0269
06D0 14                DEC     A
06D1 7003              JNZ     $ + 5H
06D3 020000      R     LJMP    ?C0272
06D6 14                DEC     A
06D7 7003              JNZ     $ + 5H
06D9 020000      R     LJMP    ?C0277
06DC 14                DEC     A
06DD 7003              JNZ     $ + 5H
06DF 020000      R     LJMP    ?C0279
06E2 2405              ADD     A,#05H
06E4 6003              JZ      $ + 5H
06E6 020000      R     LJMP    ?C0260
                                           ; SOURCE LINE # 1445
06E9         ?C0261:
                                           ; SOURCE LINE # 1446
06E9 900000      E     MOV     DPTR,#ADC_buf+06H
06EC E0                MOVX    A,@DPTR
06ED FE                MOV     R6,A
06EE A3                INC     DPTR
06EF E0                MOVX    A,@DPTR
06F0 FF                MOV     R7,A
06F1 EE                MOV     A,R6
06F2 33                RLC     A
06F3 95E0              SUBB    A,ACC
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 138 

06F5 8F00        R     MOV     i_aux+03H,R7
06F7 8E00        R     MOV     i_aux+02H,R6
06F9 F500        R     MOV     i_aux+01H,A
06FB F500        R     MOV     i_aux,A
                                           ; SOURCE LINE # 1447
06FD E4                CLR     A
06FE FF                MOV     R7,A
06FF FE                MOV     R6,A
0700 FD                MOV     R5,A
0701 FC                MOV     R4,A
0702 AB00        R     MOV     R3,i_aux+03H
0704 AA00        R     MOV     R2,i_aux+02H
0706 A900        R     MOV     R1,i_aux+01H
0708 A800        R     MOV     R0,i_aux
070A C3                CLR     C
070B 120000      E     LCALL   ?C?SLCMP
070E 5009              JNC     ?C0262
                                           ; SOURCE LINE # 1448
0710 E4                CLR     A
0711 F500        R     MOV     i_aux+03H,A
0713 F500        R     MOV     i_aux+02H,A
0715 F500        R     MOV     i_aux+01H,A
0717 F500        R     MOV     i_aux,A
0719         ?C0262:
                                           ; SOURCE LINE # 1449
0719 AF00        R     MOV     R7,i_aux+03H
071B AE00        R     MOV     R6,i_aux+02H
071D AD00        R     MOV     R5,i_aux+01H
071F AC00        R     MOV     R4,i_aux
0721 120000      E     LCALL   _filter_ch2
0724 8F00        R     MOV     i_aux+03H,R7
0726 8E00        R     MOV     i_aux+02H,R6
0728 8D00        R     MOV     i_aux+01H,R5
072A 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1450
072C 780A              MOV     R0,#0AH
072E 120000      E     LCALL   ?C?LSHL
0731 900000      E     MOV     DPTR,#g_mem+074H
0734 E0                MOVX    A,@DPTR
0735 F8                MOV     R0,A
0736 A3                INC     DPTR
0737 E0                MOVX    A,@DPTR
0738 F9                MOV     R1,A
0739 A3                INC     DPTR
073A E0                MOVX    A,@DPTR
073B FA                MOV     R2,A
073C A3                INC     DPTR
073D E0                MOVX    A,@DPTR
073E FB                MOV     R3,A
073F 120000      E     LCALL   ?C?ULDIV
0742 8F00        R     MOV     i_aux+03H,R7
0744 8E00        R     MOV     i_aux+02H,R6
0746 8D00        R     MOV     i_aux+01H,R5
0748 8C00        R     MOV     i_aux,R4
                                           ; SOURCE LINE # 1452
074A 300005            JNB     interrupt_flag,?C0263
                                           ; SOURCE LINE # 1453
074D C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1454
074F 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1455
0752         ?C0263:
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 139 

                                           ; SOURCE LINE # 1457
0752 E4                CLR     A
0753 FF                MOV     R7,A
0754 FE                MOV     R6,A
0755 FD                MOV     R5,A
0756 FC                MOV     R4,A
0757 AB00        R     MOV     R3,i_aux+03H
0759 AA00        R     MOV     R2,i_aux+02H
075B A900        R     MOV     R1,i_aux+01H
075D A800        R     MOV     R0,i_aux
075F C3                CLR     C
0760 120000      E     LCALL   ?C?SLCMP
0763 500B              JNC     ?C0264
                                           ; SOURCE LINE # 1458
0765 E4                CLR     A
0766 F500        R     MOV     i_aux+03H,A
0768 F500        R     MOV     i_aux+02H,A
076A F500        R     MOV     i_aux+01H,A
076C F500        R     MOV     i_aux,A
076E 801E              SJMP    ?C0265
0770         ?C0264:
                                           ; SOURCE LINE # 1460
0770 E4                CLR     A
0771 FF                MOV     R7,A
0772 7E04              MOV     R6,#04H
0774 FD                MOV     R5,A
0775 FC                MOV     R4,A
0776 AB00        R     MOV     R3,i_aux+03H
0778 AA00        R     MOV     R2,i_aux+02H
077A A900        R     MOV     R1,i_aux+01H
077C A800        R     MOV     R0,i_aux
077E D3                SETB    C
077F 120000      E     LCALL   ?C?SLCMP
0782 400A              JC      ?C0265
                                           ; SOURCE LINE # 1461
0784 E4                CLR     A
0785 F500        R     MOV     i_aux+03H,A
0787 750004      R     MOV     i_aux+02H,#04H
078A F500        R     MOV     i_aux+01H,A
078C F500        R     MOV     i_aux,A
078E         ?C0265:
                                           ; SOURCE LINE # 1463
078E AF00        R     MOV     R7,i_aux+03H
0790 AE00        R     MOV     R6,i_aux+02H
0792 AD00        R     MOV     R5,i_aux+01H
0794 AC00        R     MOV     R4,i_aux
0796 900000      E     MOV     DPTR,#g_meas+01BH
0799 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1465
079C 020000      R     LJMP    ?C0260
                                           ; SOURCE LINE # 1467
079F         ?C0267:
                                           ; SOURCE LINE # 1468
079F E4                CLR     A
07A0 900000      R     MOV     DPTR,#emg_counter_2
07A3 F0                MOVX    @DPTR,A
07A4 A3                INC     DPTR
07A5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1469
07A6 FF                MOV     R7,A
07A7 FE                MOV     R6,A
07A8 FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 140 

07A9 FC                MOV     R4,A
07AA 900000      E     MOV     DPTR,#g_mem+074H
07AD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1471
07B0 300005            JNB     interrupt_flag,?C0268
                                           ; SOURCE LINE # 1472
07B3 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1473
07B5 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1474
07B8         ?C0268:
                                           ; SOURCE LINE # 1476
07B8 750004      R     MOV     emg_2_status,#04H
                                           ; SOURCE LINE # 1477
07BB 020000      R     LJMP    ?C0260
                                           ; SOURCE LINE # 1479
07BE         ?C0269:
                                           ; SOURCE LINE # 1480
07BE 900000      R     MOV     DPTR,#emg_counter_2+01H
07C1 E0                MOVX    A,@DPTR
07C2 04                INC     A
07C3 F0                MOVX    @DPTR,A
07C4 7006              JNZ     ?C0326
07C6 900000      R     MOV     DPTR,#emg_counter_2
07C9 E0                MOVX    A,@DPTR
07CA 04                INC     A
07CB F0                MOVX    @DPTR,A
07CC         ?C0326:
                                           ; SOURCE LINE # 1481
07CC 900000      R     MOV     DPTR,#emg_counter_2
07CF E0                MOVX    A,@DPTR
07D0 6401              XRL     A,#01H
07D2 7004              JNZ     ?C0327
07D4 A3                INC     DPTR
07D5 E0                MOVX    A,@DPTR
07D6 64F4              XRL     A,#0F4H
07D8         ?C0327:
07D8 6003              JZ      $ + 5H
07DA 020000      R     LJMP    ?C0260
                                           ; SOURCE LINE # 1482
07DD 900000      R     MOV     DPTR,#emg_counter_2
07E0 F0                MOVX    @DPTR,A
07E1 A3                INC     DPTR
07E2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1484
07E3 7F01              MOV     R7,#01H
07E5 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1485
07E8 E4                CLR     A
07E9 FF                MOV     R7,A
07EA 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1487
07ED 300005            JNB     interrupt_flag,?C0271
                                           ; SOURCE LINE # 1488
07F0 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1489
07F2 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1490
07F5         ?C0271:
                                           ; SOURCE LINE # 1492
07F5 750003      R     MOV     emg_2_status,#03H
                                           ; SOURCE LINE # 1493
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 141 

                                           ; SOURCE LINE # 1494
07F8 020000      R     LJMP    ?C0260
                                           ; SOURCE LINE # 1496
07FB         ?C0272:
                                           ; SOURCE LINE # 1498
07FB 900000      R     MOV     DPTR,#emg_counter_2+01H
07FE E0                MOVX    A,@DPTR
07FF 04                INC     A
0800 F0                MOVX    @DPTR,A
0801 7006              JNZ     ?C0328
0803 900000      R     MOV     DPTR,#emg_counter_2
0806 E0                MOVX    A,@DPTR
0807 04                INC     A
0808 F0                MOVX    @DPTR,A
0809         ?C0328:
                                           ; SOURCE LINE # 1499
0809 C3                CLR     C
080A 900000      E     MOV     DPTR,#ADC_buf+06H
080D E0                MOVX    A,@DPTR
080E 6480              XRL     A,#080H
0810 9480              SUBB    A,#080H
0812 5004              JNC     ?C0273
                                           ; SOURCE LINE # 1500
0814 E4                CLR     A
0815 F0                MOVX    @DPTR,A
0816 A3                INC     DPTR
0817 F0                MOVX    @DPTR,A
0818         ?C0273:
                                           ; SOURCE LINE # 1501
0818 900000      E     MOV     DPTR,#g_mem+074H
081B E0                MOVX    A,@DPTR
081C F8                MOV     R0,A
081D A3                INC     DPTR
081E E0                MOVX    A,@DPTR
081F F9                MOV     R1,A
0820 A3                INC     DPTR
0821 E0                MOVX    A,@DPTR
0822 FA                MOV     R2,A
0823 A3                INC     DPTR
0824 E0                MOVX    A,@DPTR
0825 FB                MOV     R3,A
0826 C000              PUSH    AR0
0828 C001              PUSH    AR1
082A C002              PUSH    AR2
082C C003              PUSH    AR3
082E 900000      E     MOV     DPTR,#ADC_buf+06H
0831 E0                MOVX    A,@DPTR
0832 FE                MOV     R6,A
0833 A3                INC     DPTR
0834 E0                MOVX    A,@DPTR
0835 FF                MOV     R7,A
0836 EE                MOV     A,R6
0837 33                RLC     A
0838 95E0              SUBB    A,ACC
083A FD                MOV     R5,A
083B FC                MOV     R4,A
083C 120000      E     LCALL   _filter_ch2
083F D003              POP     AR3
0841 D002              POP     AR2
0843 D001              POP     AR1
0845 D000              POP     AR0
0847 EB                MOV     A,R3
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 142 

0848 2F                ADD     A,R7
0849 FF                MOV     R7,A
084A EA                MOV     A,R2
084B 3E                ADDC    A,R6
084C FE                MOV     R6,A
084D E9                MOV     A,R1
084E 3D                ADDC    A,R5
084F FD                MOV     R5,A
0850 E8                MOV     A,R0
0851 3C                ADDC    A,R4
0852 FC                MOV     R4,A
0853 900000      E     MOV     DPTR,#g_mem+074H
0856 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1503
0859 300005            JNB     interrupt_flag,?C0274
                                           ; SOURCE LINE # 1504
085C C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1505
085E 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1506
0861         ?C0274:
                                           ; SOURCE LINE # 1508
0861 900000      R     MOV     DPTR,#emg_counter_2
0864 E0                MOVX    A,@DPTR
0865 6403              XRL     A,#03H
0867 7004              JNZ     ?C0329
0869 A3                INC     DPTR
086A E0                MOVX    A,@DPTR
086B 64E8              XRL     A,#0E8H
086D         ?C0329:
086D 6003              JZ      $ + 5H
086F 020000      R     LJMP    ?C0260
                                           ; SOURCE LINE # 1509
0872 900000      E     MOV     DPTR,#g_mem+074H
0875 E0                MOVX    A,@DPTR
0876 FC                MOV     R4,A
0877 A3                INC     DPTR
0878 E0                MOVX    A,@DPTR
0879 FD                MOV     R5,A
087A A3                INC     DPTR
087B E0                MOVX    A,@DPTR
087C FE                MOV     R6,A
087D A3                INC     DPTR
087E E0                MOVX    A,@DPTR
087F FF                MOV     R7,A
0880 E4                CLR     A
0881 7BE8              MOV     R3,#0E8H
0883 7A03              MOV     R2,#03H
0885 F9                MOV     R1,A
0886 F8                MOV     R0,A
0887 120000      E     LCALL   ?C?ULDIV
088A 900000      E     MOV     DPTR,#g_mem+074H
088D 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1511
0890 E4                CLR     A
0891 FF                MOV     R7,A
0892 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1512
0895 E4                CLR     A
0896 FF                MOV     R7,A
0897 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1514
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 143 

089A E4                CLR     A
089B 900000      R     MOV     DPTR,#emg_counter_2
089E F0                MOVX    @DPTR,A
089F A3                INC     DPTR
08A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1516
08A1 300005            JNB     interrupt_flag,?C0276
                                           ; SOURCE LINE # 1517
08A4 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1518
08A6 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1519
08A9         ?C0276:
                                           ; SOURCE LINE # 1521
08A9 750005      R     MOV     emg_2_status,#05H
                                           ; SOURCE LINE # 1522
                                           ; SOURCE LINE # 1523
08AC 020000      R     LJMP    ?C0260
                                           ; SOURCE LINE # 1525
08AF         ?C0277:
                                           ; SOURCE LINE # 1526
08AF E500        R     MOV     A,emg_1_status
08B1 6003              JZ      $ + 5H
08B3 020000      R     LJMP    ?C0260
                                           ; SOURCE LINE # 1527
08B6 750002      R     MOV     emg_2_status,#02H
                                           ; SOURCE LINE # 1528
08B9 807E              SJMP    ?C0260
                                           ; SOURCE LINE # 1530
08BB         ?C0279:
                                           ; SOURCE LINE # 1531
08BB 900000      R     MOV     DPTR,#emg_counter_2+01H
08BE E0                MOVX    A,@DPTR
08BF 04                INC     A
08C0 F0                MOVX    @DPTR,A
08C1 7006              JNZ     ?C0330
08C3 900000      R     MOV     DPTR,#emg_counter_2
08C6 E0                MOVX    A,@DPTR
08C7 04                INC     A
08C8 F0                MOVX    @DPTR,A
08C9         ?C0330:
                                           ; SOURCE LINE # 1532
08C9 900000      R     MOV     DPTR,#emg_counter_2
08CC E0                MOVX    A,@DPTR
08CD 6401              XRL     A,#01H
08CF 7004              JNZ     ?C0331
08D1 A3                INC     DPTR
08D2 E0                MOVX    A,@DPTR
08D3 64F4              XRL     A,#0F4H
08D5         ?C0331:
08D5 7062              JNZ     ?C0260
                                           ; SOURCE LINE # 1533
08D7 900000      R     MOV     DPTR,#emg_counter_2
08DA F0                MOVX    @DPTR,A
08DB A3                INC     DPTR
08DC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1535
08DD 300005            JNB     interrupt_flag,?C0281
                                           ; SOURCE LINE # 1536
08E0 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1537
08E2 120000      R     LCALL   interrupt_manager
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 144 

                                           ; SOURCE LINE # 1538
08E5         ?C0281:
                                           ; SOURCE LINE # 1541
08E5 900000      E     MOV     DPTR,#c_mem+033H
08E8 E0                MOVX    A,@DPTR
08E9 FF                MOV     R7,A
08EA 6402              XRL     A,#02H
08EC 600E              JZ      ?C0283
08EE EF                MOV     A,R7
08EF 6403              XRL     A,#03H
08F1 6009              JZ      ?C0283
08F3 EF                MOV     A,R7
08F4 6404              XRL     A,#04H
08F6 6004              JZ      ?C0283
08F8 EF                MOV     A,R7
08F9 B4053A            CJNE    A,#05H,?C0282
08FC         ?C0283:
                                           ; SOURCE LINE # 1544
                                           ; SOURCE LINE # 1545
08FC 900000      E     MOV     DPTR,#c_mem+034H
08FF E0                MOVX    A,@DPTR
0900 7028              JNZ     ?C0284
                                           ; SOURCE LINE # 1546
0902 900000      E     MOV     DPTR,#g_meas
0905 E0                MOVX    A,@DPTR
0906 FC                MOV     R4,A
0907 A3                INC     DPTR
0908 E0                MOVX    A,@DPTR
0909 FD                MOV     R5,A
090A A3                INC     DPTR
090B E0                MOVX    A,@DPTR
090C FE                MOV     R6,A
090D A3                INC     DPTR
090E E0                MOVX    A,@DPTR
090F FF                MOV     R7,A
0910 900000      E     MOV     DPTR,#g_ref
0913 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1547
0916 900000      E     MOV     DPTR,#g_meas+04H
0919 E0                MOVX    A,@DPTR
091A FC                MOV     R4,A
091B A3                INC     DPTR
091C E0                MOVX    A,@DPTR
091D FD                MOV     R5,A
091E A3                INC     DPTR
091F E0                MOVX    A,@DPTR
0920 FE                MOV     R6,A
0921 A3                INC     DPTR
0922 E0                MOVX    A,@DPTR
0923 FF                MOV     R7,A
0924 900000      E     MOV     DPTR,#g_ref+04H
0927 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1548
092A         ?C0284:
                                           ; SOURCE LINE # 1549
092A 900000      E     MOV     DPTR,#c_mem+032H
092D E0                MOVX    A,@DPTR
092E FF                MOV     R7,A
092F 900000      E     MOV     DPTR,#g_ref+018H
0932 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1550
0933 120000      E     LCALL   _MOTOR_ON_OFF_Write
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 145 

                                           ; SOURCE LINE # 1551
0936         ?C0282:
                                           ; SOURCE LINE # 1553
0936 E4                CLR     A
0937 F500        R     MOV     emg_2_status,A
                                           ; SOURCE LINE # 1554
                                           ; SOURCE LINE # 1555
                                           ; SOURCE LINE # 1557
                                           ; SOURCE LINE # 1558
                                           ; SOURCE LINE # 1559
0939         ?C0260:
                                           ; SOURCE LINE # 1561
0939 300079            JNB     interrupt_flag,?C0287
                                           ; SOURCE LINE # 1562
093C C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1563
093E 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1564
                                           ; SOURCE LINE # 1565
                                           ; SOURCE LINE # 1566
0941 8072              SJMP    ?C0287
0943         ?C0200:
                                           ; SOURCE LINE # 1567
                                           ; SOURCE LINE # 1569
0943 750001      R     MOV     emg_1_status,#01H
                                           ; SOURCE LINE # 1570
0946 750001      R     MOV     emg_2_status,#01H
                                           ; SOURCE LINE # 1572
0949 750001      R     MOV     UD_status,#01H
                                           ; SOURCE LINE # 1573
094C 750001      R     MOV     LR_status,#01H
                                           ; SOURCE LINE # 1575
094F C200        E     CLR     tension_valid
                                           ; SOURCE LINE # 1578
0951 7F01              MOV     R7,#01H
0953 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1580
0956 E4                CLR     A
0957 FF                MOV     R7,A
0958 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1582
095B 300005            JNB     interrupt_flag,?C0288
                                           ; SOURCE LINE # 1583
095E C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1584
0960 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1585
0963         ?C0288:
                                           ; SOURCE LINE # 1587
0963 900000      E     MOV     DPTR,#c_mem+06FH
0966 E0                MOVX    A,@DPTR
0967 6020              JZ      ?C0289
                                           ; SOURCE LINE # 1588
0969 900000      E     MOV     DPTR,#c_mem+033H
096C E0                MOVX    A,@DPTR
096D FF                MOV     R7,A
096E 6402              XRL     A,#02H
0970 600E              JZ      ?C0291
0972 EF                MOV     A,R7
0973 6403              XRL     A,#03H
0975 6009              JZ      ?C0291
0977 EF                MOV     A,R7
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 146 

0978 6404              XRL     A,#04H
097A 6004              JZ      ?C0291
097C EF                MOV     A,R7
097D B40509            CJNE    A,#05H,?C0289
0980         ?C0291:
                                           ; SOURCE LINE # 1591
                                           ; SOURCE LINE # 1592
0980 E4                CLR     A
0981 900000      E     MOV     DPTR,#g_ref+018H
0984 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1593
0985 FF                MOV     R7,A
0986 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1594
                                           ; SOURCE LINE # 1595
0989         ?C0289:
                                           ; SOURCE LINE # 1598
0989 E4                CLR     A
098A FF                MOV     R7,A
098B FE                MOV     R6,A
098C FD                MOV     R5,A
098D FC                MOV     R4,A
098E 900000      E     MOV     DPTR,#g_meas+0CH
0991 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1601
0994 E4                CLR     A
0995 FF                MOV     R7,A
0996 FE                MOV     R6,A
0997 FD                MOV     R5,A
0998 FC                MOV     R4,A
0999 900000      E     MOV     DPTR,#g_meas+017H
099C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1602
099F E4                CLR     A
09A0 FF                MOV     R7,A
09A1 FE                MOV     R6,A
09A2 FD                MOV     R5,A
09A3 FC                MOV     R4,A
09A4 900000      E     MOV     DPTR,#g_meas+01BH
09A7 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1605
09AA E4                CLR     A
09AB 900000      E     MOV     DPTR,#g_meas+037H
09AE F0                MOVX    @DPTR,A
09AF A3                INC     DPTR
09B0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1606
09B1 A3                INC     DPTR
09B2 F0                MOVX    @DPTR,A
09B3 A3                INC     DPTR
09B4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1608
09B5         ?C0287:
                                           ; SOURCE LINE # 1611
09B5 900000      E     MOV     DPTR,#first_tension_valid
09B8 E0                MOVX    A,@DPTR
09B9 6003              JZ      $ + 5H
09BB 020000      R     LJMP    ?C0292
09BE 200003      E     JB      tension_valid,$ + 6H
09C1 020000      R     LJMP    ?C0292
09C4 E500        R     MOV     A,emg_1_status
09C6 6003              JZ      $ + 5H
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 147 

09C8 020000      R     LJMP    ?C0292
09CB E500        R     MOV     A,emg_2_status
09CD 6003              JZ      $ + 5H
09CF 020000      R     LJMP    ?C0292
                                           ; SOURCE LINE # 1612
09D2 900000      E     MOV     DPTR,#dev_tension
09D5 E0                MOVX    A,@DPTR
09D6 FC                MOV     R4,A
09D7 A3                INC     DPTR
09D8 E0                MOVX    A,@DPTR
09D9 FD                MOV     R5,A
09DA A3                INC     DPTR
09DB E0                MOVX    A,@DPTR
09DC FE                MOV     R6,A
09DD A3                INC     DPTR
09DE E0                MOVX    A,@DPTR
09DF FF                MOV     R7,A
09E0 120000      E     LCALL   _filter_voltage
09E3 900000      E     MOV     DPTR,#dev_tension_f
09E6 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1613
09E9 900000      E     MOV     DPTR,#pow_tension
09EC E0                MOVX    A,@DPTR
09ED FC                MOV     R4,A
09EE A3                INC     DPTR
09EF E0                MOVX    A,@DPTR
09F0 FD                MOV     R5,A
09F1 A3                INC     DPTR
09F2 E0                MOVX    A,@DPTR
09F3 FE                MOV     R6,A
09F4 A3                INC     DPTR
09F5 E0                MOVX    A,@DPTR
09F6 FF                MOV     R7,A
09F7 EC                MOV     A,R4
09F8 120000      E     LCALL   ?C?FCASTL
09FB 7B1F              MOV     R3,#01FH
09FD 7A85              MOV     R2,#085H
09FF 796B              MOV     R1,#06BH
0A01 783F              MOV     R0,#03FH
0A03 120000      E     LCALL   ?C?FPMUL
0A06 C004              PUSH    AR4
0A08 C005              PUSH    AR5
0A0A C006              PUSH    AR6
0A0C C007              PUSH    AR7
0A0E 900000      E     MOV     DPTR,#dev_tension_f
0A11 E0                MOVX    A,@DPTR
0A12 FC                MOV     R4,A
0A13 A3                INC     DPTR
0A14 E0                MOVX    A,@DPTR
0A15 FD                MOV     R5,A
0A16 A3                INC     DPTR
0A17 E0                MOVX    A,@DPTR
0A18 FE                MOV     R6,A
0A19 A3                INC     DPTR
0A1A E0                MOVX    A,@DPTR
0A1B FF                MOV     R7,A
0A1C EC                MOV     A,R4
0A1D 120000      E     LCALL   ?C?FCASTL
0A20 A804              MOV     R0,AR4
0A22 A905              MOV     R1,AR5
0A24 AA06              MOV     R2,AR6
0A26 AB07              MOV     R3,AR7
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 148 

0A28 D007              POP     AR7
0A2A D006              POP     AR6
0A2C D005              POP     AR5
0A2E D004              POP     AR4
0A30 120000      E     LCALL   ?C?FPCMP3
0A33 600E              JZ      ?C0293
0A35 400C              JC      ?C0293
                                           ; SOURCE LINE # 1615
0A37 7F01              MOV     R7,#01H
0A39 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1618
0A3C E4                CLR     A
0A3D FF                MOV     R7,A
0A3E 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1619
0A41 802B              SJMP    ?C0292
0A43         ?C0293:
                                           ; SOURCE LINE # 1620
                                           ; SOURCE LINE # 1622
0A43 E4                CLR     A
0A44 FF                MOV     R7,A
0A45 120000      E     LCALL   _LED_CTRL_Write
                                           ; SOURCE LINE # 1625
0A48 7F01              MOV     R7,#01H
0A4A 120000      E     LCALL   _LED_BLINK_EN_Write
                                           ; SOURCE LINE # 1628
0A4D 900000      E     MOV     DPTR,#master_mode
0A50 E0                MOVX    A,@DPTR
0A51 6012              JZ      ?C0295
                                           ; SOURCE LINE # 1629
0A53 120000      E     LCALL   deactivate_slaves
                                           ; SOURCE LINE # 1632
0A56 300005            JNB     interrupt_flag,?C0296
                                           ; SOURCE LINE # 1633
0A59 C200        E     CLR     interrupt_flag
                                           ; SOURCE LINE # 1634
0A5B 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1635
0A5E         ?C0296:
                                           ; SOURCE LINE # 1637
0A5E E4                CLR     A
0A5F 900000      E     MOV     DPTR,#master_mode
0A62 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1638
0A63 8009              SJMP    ?C0292
0A65         ?C0295:
                                           ; SOURCE LINE # 1639
                                           ; SOURCE LINE # 1640
0A65 E4                CLR     A
0A66 900000      E     MOV     DPTR,#g_refNew+018H
0A69 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1641
0A6A FF                MOV     R7,A
0A6B 120000      E     LCALL   _MOTOR_ON_OFF_Write
                                           ; SOURCE LINE # 1642
                                           ; SOURCE LINE # 1643
                                           ; SOURCE LINE # 1644
0A6E         ?C0292:
                                           ; SOURCE LINE # 1646
0A6E 300005            JNB     interrupt_flag,?C0299
                                           ; SOURCE LINE # 1647
0A71 C200        E     CLR     interrupt_flag
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 149 

                                           ; SOURCE LINE # 1648
0A73 120000      R     LCALL   interrupt_manager
                                           ; SOURCE LINE # 1649
                                           ; SOURCE LINE # 1650
0A76         ?C0299:
0A76 22                RET     
             ; FUNCTION analog_read_end (END)

             ; FUNCTION overcurrent_control (BEGIN)
                                           ; SOURCE LINE # 1656
                                           ; SOURCE LINE # 1657
0000 900000      E     MOV     DPTR,#c_mem+069H
0003 E0                MOVX    A,@DPTR
0004 FE                MOV     R6,A
0005 A3                INC     DPTR
0006 E0                MOVX    A,@DPTR
0007 FF                MOV     R7,A
0008 4E                ORL     A,R6
0009 6068              JZ      ?C0307
                                           ; SOURCE LINE # 1659
000B EE                MOV     A,R6
000C 33                RLC     A
000D 95E0              SUBB    A,ACC
000F FD                MOV     R5,A
0010 FC                MOV     R4,A
0011 900000      E     MOV     DPTR,#g_meas+0CH
0014 E0                MOVX    A,@DPTR
0015 F8                MOV     R0,A
0016 A3                INC     DPTR
0017 E0                MOVX    A,@DPTR
0018 F9                MOV     R1,A
0019 A3                INC     DPTR
001A E0                MOVX    A,@DPTR
001B FA                MOV     R2,A
001C A3                INC     DPTR
001D E0                MOVX    A,@DPTR
001E FB                MOV     R3,A
001F D3                SETB    C
0020 120000      E     LCALL   ?C?SLCMP
0023 4008              JC      ?C0301
                                           ; SOURCE LINE # 1661
0025 900000      E     MOV     DPTR,#dev_pwm_limit
0028 E0                MOVX    A,@DPTR
0029 14                DEC     A
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1663
002B 802D              SJMP    ?C0302
002D         ?C0301:
002D 900000      E     MOV     DPTR,#c_mem+06AH
0030 E0                MOVX    A,@DPTR
0031 24F6              ADD     A,#0F6H
0033 FF                MOV     R7,A
0034 900000      E     MOV     DPTR,#c_mem+069H
0037 E0                MOVX    A,@DPTR
0038 34FF              ADDC    A,#0FFH
003A FE                MOV     R6,A
003B 33                RLC     A
003C 95E0              SUBB    A,ACC
003E FD                MOV     R5,A
003F FC                MOV     R4,A
0040 900000      E     MOV     DPTR,#g_meas+0CH
0043 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 150 

0044 F8                MOV     R0,A
0045 A3                INC     DPTR
0046 E0                MOVX    A,@DPTR
0047 F9                MOV     R1,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FA                MOV     R2,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FB                MOV     R3,A
004E C3                CLR     C
004F 120000      E     LCALL   ?C?SLCMP
0052 5006              JNC     ?C0302
                                           ; SOURCE LINE # 1665
0054 900000      E     MOV     DPTR,#dev_pwm_limit
0057 E0                MOVX    A,@DPTR
0058 04                INC     A
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1666
005A         ?C0302:
                                           ; SOURCE LINE # 1669
005A 900000      E     MOV     DPTR,#dev_pwm_limit
005D E0                MOVX    A,@DPTR
005E FF                MOV     R7,A
005F C3                CLR     C
0060 9400              SUBB    A,#00H
0062 5003              JNC     ?C0304
                                           ; SOURCE LINE # 1670
0064 E4                CLR     A
0065 F0                MOVX    @DPTR,A
0066 22                RET     
0067         ?C0304:
                                           ; SOURCE LINE # 1672
0067 EF                MOV     A,R7
0068 D3                SETB    C
0069 9464              SUBB    A,#064H
006B 4006              JC      ?C0307
                                           ; SOURCE LINE # 1673
006D 900000      E     MOV     DPTR,#dev_pwm_limit
0070 7464              MOV     A,#064H
0072 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1674
                                           ; SOURCE LINE # 1675
0073         ?C0307:
0073 22                RET     
             ; FUNCTION overcurrent_control (END)

             ; FUNCTION pwm_limit_search (BEGIN)
                                           ; SOURCE LINE # 1681
                                           ; SOURCE LINE # 1685
0000 E4                CLR     A
0001 7F9C              MOV     R7,#09CH
0003 7E63              MOV     R6,#063H
0005 FD                MOV     R5,A
0006 FC                MOV     R4,A
0007 900000      E     MOV     DPTR,#dev_tension
000A E0                MOVX    A,@DPTR
000B F8                MOV     R0,A
000C A3                INC     DPTR
000D E0                MOVX    A,@DPTR
000E F9                MOV     R1,A
000F A3                INC     DPTR
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 151 

0010 E0                MOVX    A,@DPTR
0011 FA                MOV     R2,A
0012 A3                INC     DPTR
0013 E0                MOVX    A,@DPTR
0014 FB                MOV     R3,A
0015 D3                SETB    C
0016 120000      E     LCALL   ?C?SLCMP
0019 4006              JC      ?C0308
                                           ; SOURCE LINE # 1686
001B E4                CLR     A
001C 900000      E     MOV     DPTR,#dev_pwm_limit
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1687
0020 22                RET     
0021         ?C0308:
0021 E4                CLR     A
0022 7FEC              MOV     R7,#0ECH
0024 7E2C              MOV     R6,#02CH
0026 FD                MOV     R5,A
0027 FC                MOV     R4,A
0028 900000      E     MOV     DPTR,#dev_tension
002B E0                MOVX    A,@DPTR
002C F8                MOV     R0,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F F9                MOV     R1,A
0030 A3                INC     DPTR
0031 E0                MOVX    A,@DPTR
0032 FA                MOV     R2,A
0033 A3                INC     DPTR
0034 E0                MOVX    A,@DPTR
0035 FB                MOV     R3,A
0036 C3                CLR     C
0037 120000      E     LCALL   ?C?SLCMP
003A 5007              JNC     ?C0310
                                           ; SOURCE LINE # 1688
003C 900000      E     MOV     DPTR,#dev_pwm_limit
003F 7464              MOV     A,#064H
0041 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1689
0042 22                RET     
0043         ?C0310:
                                           ; SOURCE LINE # 1690
0043 900000      E     MOV     DPTR,#dev_tension
0046 E0                MOVX    A,@DPTR
0047 FC                MOV     R4,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FD                MOV     R5,A
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D FE                MOV     R6,A
004E A3                INC     DPTR
004F E0                MOVX    A,@DPTR
0050 2414              ADD     A,#014H
0052 FF                MOV     R7,A
0053 EE                MOV     A,R6
0054 34D3              ADDC    A,#0D3H
0056 FE                MOV     R6,A
0057 ED                MOV     A,R5
0058 34FF              ADDC    A,#0FFH
005A FD                MOV     R5,A
C51 COMPILER V9.51   INTERRUPTIONS                                                         04/13/2018 12:12:24 PAGE 152 

005B EC                MOV     A,R4
005C 34FF              ADDC    A,#0FFH
005E FC                MOV     R4,A
005F 7809              MOV     R0,#09H
0061 120000      E     LCALL   ?C?SLSHR
0064 8F00        R     MOV     index,R7
                                           ; SOURCE LINE # 1691
0066 7400        R     MOV     A,#LOW pwm_preload_values
0068 2F                ADD     A,R7
0069 F582              MOV     DPL,A
006B E4                CLR     A
006C 3400        R     ADDC    A,#HIGH pwm_preload_values
006E F583              MOV     DPH,A
0070 E0                MOVX    A,@DPTR
0071 900000      E     MOV     DPTR,#dev_pwm_limit
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1692
                                           ; SOURCE LINE # 1693
0075         ?C0312:
0075 22                RET     
             ; FUNCTION pwm_limit_search (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  10304    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    273      20
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     22      88
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
