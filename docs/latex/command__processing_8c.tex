\doxysection{command\+\_\+processing.\+c File Reference}
\label{command__processing_8c}\index{command\_processing.c@{command\_processing.c}}


Command processing functions.  


{\ttfamily \#include $<$command\+\_\+processing.\+h$>$}\newline
{\ttfamily \#include $<$interruptions.\+h$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$utils.\+h$>$}\newline
{\ttfamily \#include \char`\"{}commands.\+h\char`\"{}}\newline
Include dependency graph for command\+\_\+processing.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{command__processing_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \textbf{ comm\+Process} (void)
\item 
void \textbf{ info\+Send} (void)
\item 
void \textbf{ info\+Get} (uint16 info\+\_\+type)
\item 
void \textbf{ get\+\_\+param\+\_\+list} (uint16 index)
\item 
void \textbf{ set\+Zeros} ()
\item 
void \textbf{ info\+Prepare} (unsigned char $\ast$info\+\_\+string)
\item 
void \textbf{ comm\+Write\+\_\+old\+\_\+id} (uint8 $\ast$packet\+\_\+data, uint16 packet\+\_\+lenght, uint8 old\+\_\+id)
\item 
void \textbf{ comm\+Write} (uint8 $\ast$packet\+\_\+data, uint16 packet\+\_\+lenght)
\item 
int32 \textbf{ comm\+Read\+Meas\+From\+SH} ()
\item 
int16 \textbf{ comm\+Read\+Res\+Curr\+From\+SH} ()
\item 
void \textbf{ comm\+Write\+ID} (uint8 $\ast$packet\+\_\+data, uint16 packet\+\_\+lenght, uint8 id)
\item 
void \textbf{ drive\+\_\+\+SH} ()
\item 
\mbox{\label{command__processing_8c_ab0012a1625f6d6b10c506d1bed46d3ad}} 
void {\bfseries drive\+\_\+force\+\_\+fb} ()
\item 
\mbox{\label{command__processing_8c_a2462bf14f28fd28c364c8b846c3750d9}} 
void {\bfseries drive\+\_\+proprio\+\_\+fb} ()
\item 
\mbox{\label{command__processing_8c_ae389cdaaeca623a35dfa0db76bf4632f}} 
void {\bfseries drive\+\_\+force\+\_\+proprio\+\_\+fb} ()
\item 
\mbox{\label{command__processing_8c_ac01fba9f71bff7bafde0b998908fe74d}} 
void {\bfseries drive\+\_\+vibrotactile\+\_\+fb} ()
\item 
void \textbf{ deactivate\+\_\+slaves} ()
\item 
uint8 \textbf{ LCRChecksum} (uint8 $\ast$data\+\_\+array, uint8 data\+\_\+length)
\item 
void \textbf{ send\+Acknowledgment} (uint8 value)
\item 
uint8 \textbf{ mem\+Store} (int displacement)
\item 
void \textbf{ mem\+Recall} (void)
\item 
uint8 \textbf{ mem\+Restore} (void)
\item 
uint8 \textbf{ mem\+Init} (void)
\item 
void \textbf{ cmd\+\_\+get\+\_\+measurements} ()
\item 
void \textbf{ cmd\+\_\+set\+\_\+inputs} ()
\item 
void \textbf{ cmd\+\_\+activate} ()
\item 
void \textbf{ cmd\+\_\+get\+\_\+joystick} ()
\item 
void \textbf{ cmd\+\_\+set\+\_\+baudrate} ()
\item 
void \textbf{ cmd\+\_\+ping} ()
\item 
void \textbf{ cmd\+\_\+get\+\_\+inputs} ()
\item 
void \textbf{ cmd\+\_\+store\+\_\+params} ()
\item 
void \textbf{ cmd\+\_\+get\+\_\+emg} ()
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\label{command__processing_8c_aba5b9353e6d38cc61eb2bd363df61248}} 
reg8 $\ast$ {\bfseries EEPROM\+\_\+\+ADDR} = (reg8 $\ast$) CYDEV\+\_\+\+EE\+\_\+\+BASE
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Command processing functions. 

\begin{DoxyDate}{Date}
Feb 14th, 2023 
\end{DoxyDate}
\begin{DoxyAuthor}{Author}
{\itshape Centro \char`\"{}\+E.\+Piaggio\char`\"{}} 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
(C) 2012-\/2016 qbrobotics. All rights reserved. 

(C) 2017-\/2023 Centro \char`\"{}\+E.\+Piaggio\char`\"{}. All rights reserved. 
\end{DoxyCopyright}


\doxysubsection{Function Documentation}
\mbox{\label{command__processing_8c_a107fc9f2982f9a953bdd82aa07279499}} 
\index{command\_processing.c@{command\_processing.c}!cmd\_activate@{cmd\_activate}}
\index{cmd\_activate@{cmd\_activate}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{cmd\_activate()}
{\footnotesize\ttfamily void cmd\+\_\+activate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function activates the board \mbox{\label{command__processing_8c_ae579c6ac56fef33632f9c9f2c42b90a0}} 
\index{command\_processing.c@{command\_processing.c}!cmd\_get\_emg@{cmd\_get\_emg}}
\index{cmd\_get\_emg@{cmd\_get\_emg}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{cmd\_get\_emg()}
{\footnotesize\ttfamily void cmd\+\_\+get\+\_\+emg (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function gets the electromyographic sensors measurements and puts them in the package to be sent. \mbox{\label{command__processing_8c_a20db4694e8caa572ec479f73ce8b3b02}} 
\index{command\_processing.c@{command\_processing.c}!cmd\_get\_inputs@{cmd\_get\_inputs}}
\index{cmd\_get\_inputs@{cmd\_get\_inputs}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{cmd\_get\_inputs()}
{\footnotesize\ttfamily void cmd\+\_\+get\+\_\+inputs (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function gets the current motor reference inputs and puts them in the package to be sent. \mbox{\label{command__processing_8c_a09b189bd1592a8f95769a1907f44b555}} 
\index{command\_processing.c@{command\_processing.c}!cmd\_get\_joystick@{cmd\_get\_joystick}}
\index{cmd\_get\_joystick@{cmd\_get\_joystick}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{cmd\_get\_joystick()}
{\footnotesize\ttfamily void cmd\+\_\+get\+\_\+joystick (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function gets the joystick reference inputs and puts them in the package to be sent. \mbox{\label{command__processing_8c_af5ccd403f1d3e49c97bafd6e7713cff3}} 
\index{command\_processing.c@{command\_processing.c}!cmd\_get\_measurements@{cmd\_get\_measurements}}
\index{cmd\_get\_measurements@{cmd\_get\_measurements}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{cmd\_get\_measurements()}
{\footnotesize\ttfamily void cmd\+\_\+get\+\_\+measurements (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Bunch of functions used on request from UART communication \mbox{\label{command__processing_8c_a704f8c8cb0f4d75f243fc2b79bc34188}} 
\index{command\_processing.c@{command\_processing.c}!cmd\_ping@{cmd\_ping}}
\index{cmd\_ping@{cmd\_ping}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{cmd\_ping()}
{\footnotesize\ttfamily void cmd\+\_\+ping (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function is used to ping the device and see if is connected. \mbox{\label{command__processing_8c_aa86bf1f2fa69ab5927f7e4e40eb40581}} 
\index{command\_processing.c@{command\_processing.c}!cmd\_set\_baudrate@{cmd\_set\_baudrate}}
\index{cmd\_set\_baudrate@{cmd\_set\_baudrate}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{cmd\_set\_baudrate()}
{\footnotesize\ttfamily void cmd\+\_\+set\+\_\+baudrate (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function sets the desired communication baudrate. It is possible to select a value equal to 460800 or 2000000. \mbox{\label{command__processing_8c_a2d8a4542f55af960a27f875b00aad6a1}} 
\index{command\_processing.c@{command\_processing.c}!cmd\_set\_inputs@{cmd\_set\_inputs}}
\index{cmd\_set\_inputs@{cmd\_set\_inputs}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{cmd\_set\_inputs()}
{\footnotesize\ttfamily void cmd\+\_\+set\+\_\+inputs (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function gets the inputs from the received package and sets them as motor reference. \mbox{\label{command__processing_8c_a1a2493bfc2f30171d7e7a3bd5aebab14}} 
\index{command\_processing.c@{command\_processing.c}!cmd\_store\_params@{cmd\_store\_params}}
\index{cmd\_store\_params@{cmd\_store\_params}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{cmd\_store\_params()}
{\footnotesize\ttfamily void cmd\+\_\+store\+\_\+params (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function stores the parameters to the EEPROM memory \mbox{\label{command__processing_8c_a0c97206a61d782ebd9aa24bbb96f8aea}} 
\index{command\_processing.c@{command\_processing.c}!commProcess@{commProcess}}
\index{commProcess@{commProcess}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{commProcess()}
{\footnotesize\ttfamily void comm\+Process (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function unpacks the received package, depending on the command received. ~\newline
 \mbox{\label{command__processing_8c_a663425cf6d34a3fcec1c9b79014d3b90}} 
\index{command\_processing.c@{command\_processing.c}!commReadMeasFromSH@{commReadMeasFromSH}}
\index{commReadMeasFromSH@{commReadMeasFromSH}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{commReadMeasFromSH()}
{\footnotesize\ttfamily int32 comm\+Read\+Meas\+From\+SH (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function reads on the serial port the measurements package from SH. \mbox{\label{command__processing_8c_af37abb7623deb4ea3af0da3801ab3788}} 
\index{command\_processing.c@{command\_processing.c}!commReadResCurrFromSH@{commReadResCurrFromSH}}
\index{commReadResCurrFromSH@{commReadResCurrFromSH}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{commReadResCurrFromSH()}
{\footnotesize\ttfamily int16 comm\+Read\+Res\+Curr\+From\+SH (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function reads on the serial port the residual current from SH. \mbox{\label{command__processing_8c_af92ab4f3c1e0c0e8f5966bf2e2edeaba}} 
\index{command\_processing.c@{command\_processing.c}!commWrite@{commWrite}}
\index{commWrite@{commWrite}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{commWrite()}
{\footnotesize\ttfamily void comm\+Write (\begin{DoxyParamCaption}\item[{uint8 $\ast$}]{packet\+\_\+data,  }\item[{uint16}]{packet\+\_\+lenght }\end{DoxyParamCaption})}

This function writes on the serial port the package that needs to be sent to the user.


\begin{DoxyParams}{Parameters}
{\em packet\+\_\+data} & The array of data that must be written. \\
\hline
{\em packet\+\_\+lenght} & The lenght of the data array. \\
\hline
\end{DoxyParams}
\mbox{\label{command__processing_8c_a517f4c61166381d40767fce9011e3c96}} 
\index{command\_processing.c@{command\_processing.c}!commWrite\_old\_id@{commWrite\_old\_id}}
\index{commWrite\_old\_id@{commWrite\_old\_id}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{commWrite\_old\_id()}
{\footnotesize\ttfamily void comm\+Write\+\_\+old\+\_\+id (\begin{DoxyParamCaption}\item[{uint8 $\ast$}]{packet\+\_\+data,  }\item[{uint16}]{packet\+\_\+lenght,  }\item[{uint8}]{old\+\_\+id }\end{DoxyParamCaption})}

This function writes on the serial port the package that needs to be sent to the user. Is used only when a new is set, to communicate back to the APIs that the new ID setting went fine or there was an error.


\begin{DoxyParams}{Parameters}
{\em packet\+\_\+data} & The array of data that must be written. \\
\hline
{\em packet\+\_\+lenght} & The lenght of the data array. \\
\hline
{\em old\+\_\+id} & The previous id of the board, before setting a new one \\
\hline
\end{DoxyParams}
\mbox{\label{command__processing_8c_aed6a94cc62768fbec790b25a22eb3424}} 
\index{command\_processing.c@{command\_processing.c}!commWriteID@{commWriteID}}
\index{commWriteID@{commWriteID}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{commWriteID()}
{\footnotesize\ttfamily void comm\+Write\+ID (\begin{DoxyParamCaption}\item[{uint8 $\ast$}]{packet\+\_\+data,  }\item[{uint16}]{packet\+\_\+lenght,  }\item[{uint8}]{id }\end{DoxyParamCaption})}

This function writes on the serial port the package that needs to be sent to another board.


\begin{DoxyParams}{Parameters}
{\em packet\+\_\+data} & The array of data that must be written. \\
\hline
{\em packet\+\_\+lenght} & The lenght of the data array. \\
\hline
{\em device\+\_\+id} & The ID of slave device \\
\hline
\end{DoxyParams}
\mbox{\label{command__processing_8c_a22eb92c869daf62079d72a328c54aec7}} 
\index{command\_processing.c@{command\_processing.c}!deactivate\_slaves@{deactivate\_slaves}}
\index{deactivate\_slaves@{deactivate\_slaves}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{deactivate\_slaves()}
{\footnotesize\ttfamily void deactivate\+\_\+slaves (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function is used to create a package to deactivate motors on all the other devices. \mbox{\label{command__processing_8c_aa5e3df4f216e5d997a06db3d19887390}} 
\index{command\_processing.c@{command\_processing.c}!drive\_SH@{drive\_SH}}
\index{drive\_SH@{drive\_SH}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{drive\_SH()}
{\footnotesize\ttfamily void drive\+\_\+\+SH (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function is used to create a package and send it to another device, only if the actual board is in master mode. \mbox{\label{command__processing_8c_a5ef086c932682ca5f7549b74ead732aa}} 
\index{command\_processing.c@{command\_processing.c}!get\_param\_list@{get\_param\_list}}
\index{get\_param\_list@{get\_param\_list}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{get\_param\_list()}
{\footnotesize\ttfamily void get\+\_\+param\+\_\+list (\begin{DoxyParamCaption}\item[{uint16}]{index }\end{DoxyParamCaption})}

This function, depending on the \doxyref{Firmware}{p.}{index} received, gets the list of parameters with their values and sends them to user or sets a parameter from all the parameters of the device.


\begin{DoxyParams}{Parameters}
{\em index} & The index of the parameters to be setted. If 0 gets full parameters list. \\
\hline
\end{DoxyParams}
\mbox{\label{command__processing_8c_a525ccbc7ac3901d938dc352172ee2531}} 
\index{command\_processing.c@{command\_processing.c}!infoGet@{infoGet}}
\index{infoGet@{infoGet}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{infoGet()}
{\footnotesize\ttfamily void info\+Get (\begin{DoxyParamCaption}\item[{uint16}]{info\+\_\+type }\end{DoxyParamCaption})}

This function sends the firmware information prepared with \doxyref{info\+Prepare}{p.}{command__processing_8h_abacf855ed80e3052a5bb5b243a0d809e} through the serial port to the user interface. Is used when the ID is specified.


\begin{DoxyParams}{Parameters}
{\em info\+\_\+type} & The type of the information needed. \\
\hline
\end{DoxyParams}
\mbox{\label{command__processing_8c_abacf855ed80e3052a5bb5b243a0d809e}} 
\index{command\_processing.c@{command\_processing.c}!infoPrepare@{infoPrepare}}
\index{infoPrepare@{infoPrepare}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{infoPrepare()}
{\footnotesize\ttfamily void info\+Prepare (\begin{DoxyParamCaption}\item[{unsigned char $\ast$}]{info\+\_\+string }\end{DoxyParamCaption})}

This function is used to prepare the information string about the firmware of the device.


\begin{DoxyParams}{Parameters}
{\em info\+\_\+string} & An array of chars containing firmware informations. \\
\hline
\end{DoxyParams}
\mbox{\label{command__processing_8c_a0f8a936c0c43abd1e7ba5add8cbcbf70}} 
\index{command\_processing.c@{command\_processing.c}!infoSend@{infoSend}}
\index{infoSend@{infoSend}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{infoSend()}
{\footnotesize\ttfamily void info\+Send (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function sends the firmware information prepared with \doxyref{info\+Prepare}{p.}{command__processing_8h_abacf855ed80e3052a5bb5b243a0d809e} through the serial port to the user interface. Is used when no ID is specified. \mbox{\label{command__processing_8c_a6205a6e88f72f4cc321a7d8abca23e26}} 
\index{command\_processing.c@{command\_processing.c}!LCRChecksum@{LCRChecksum}}
\index{LCRChecksum@{LCRChecksum}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{LCRChecksum()}
{\footnotesize\ttfamily uint8 LCRChecksum (\begin{DoxyParamCaption}\item[{uint8 $\ast$}]{data\+\_\+array,  }\item[{uint8}]{data\+\_\+length }\end{DoxyParamCaption})}

This function calculates a checksum of the array to see if the received data is consistent.


\begin{DoxyParams}{Parameters}
{\em data\+\_\+array} & The array of data that must be checked. \\
\hline
{\em data\+\_\+lenght} & Lenght of the data array that must be checked.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The calculated checksum for the relative data\+\_\+array. 
\end{DoxyReturn}
\mbox{\label{command__processing_8c_a48f1d2aa212e255d0a3322e576fc8574}} 
\index{command\_processing.c@{command\_processing.c}!memInit@{memInit}}
\index{memInit@{memInit}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{memInit()}
{\footnotesize\ttfamily uint8 mem\+Init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This functions initializes the memory. It is used also to restore the the parameters to their default values.

\begin{DoxyReturn}{Returns}
A true value if the memory is correctly initialized, false otherwise. 
\end{DoxyReturn}
\mbox{\label{command__processing_8c_a494f1f72ae370f0057e5aa3db73ef6fb}} 
\index{command\_processing.c@{command\_processing.c}!memRecall@{memRecall}}
\index{memRecall@{memRecall}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{memRecall()}
{\footnotesize\ttfamily void mem\+Recall (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function loads user\textquotesingle{}s settings from the EEPROM. \mbox{\label{command__processing_8c_af67845c368ea7fefb79a1f0baa12134c}} 
\index{command\_processing.c@{command\_processing.c}!memRestore@{memRestore}}
\index{memRestore@{memRestore}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{memRestore()}
{\footnotesize\ttfamily uint8 mem\+Restore (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function loads default settings from the EEPROM.

\begin{DoxyReturn}{Returns}
A true value if the memory is correctly restored, false otherwise. 
\end{DoxyReturn}
\mbox{\label{command__processing_8c_a81e6b73c0ee52661736a97c08bdb262b}} 
\index{command\_processing.c@{command\_processing.c}!memStore@{memStore}}
\index{memStore@{memStore}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{memStore()}
{\footnotesize\ttfamily uint8 mem\+Store (\begin{DoxyParamCaption}\item[{int}]{displacement }\end{DoxyParamCaption})}

This function stores the setted parameters to the internal EEPROM memory. It is usually called, by the user, after a parameter is set.


\begin{DoxyParams}{Parameters}
{\em displacement} & The address where the parameters will be written.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A true value if the memory is correctly stored, false otherwise. 
\end{DoxyReturn}
\mbox{\label{command__processing_8c_a1a2eafee01079c42ca1fb14aa7331933}} 
\index{command\_processing.c@{command\_processing.c}!sendAcknowledgment@{sendAcknowledgment}}
\index{sendAcknowledgment@{sendAcknowledgment}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{sendAcknowledgment()}
{\footnotesize\ttfamily void send\+Acknowledgment (\begin{DoxyParamCaption}\item[{uint8}]{value }\end{DoxyParamCaption})}

This functions sends an acknowledgment to see if a command has been executed properly or not.


\begin{DoxyParams}{Parameters}
{\em value} & An ACK\+\_\+\+OK(1) or ACK\+\_\+\+ERROR(0) value. \\
\hline
\end{DoxyParams}
\mbox{\label{command__processing_8c_ac8969cb5fdb4916f259075029741e727}} 
\index{command\_processing.c@{command\_processing.c}!setZeros@{setZeros}}
\index{setZeros@{setZeros}!command\_processing.c@{command\_processing.c}}
\doxysubsubsection{setZeros()}
{\footnotesize\ttfamily void set\+Zeros (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function sets the encoders zero position. 
